const webVersion="v0.472b";var debugMode=!1,DeviceType={Serial:0,Network:1,Deo:2,Whirligig:3,Gamepad:4,XTPWeb:5,None:6},ConnectionStatus={Connected:0,Disconnected:1,Connecting:2,Error:3},ChannelType={None:0,Range:1,Switch:2,HalfRange:3};const ChannelTimeType={None:0,Interval:1,Speed:2},ChannelDimension={None:0,Heave:1,Surge:2,Sway:3,Pitch:4,Roll:5,Yaw:6};var settingChangeDebounce,wsUri,userAgent,remoteUserSettings,playingmediaItem,playingmediaItemNode,webSocket,deviceAddress,selectedInputDevice,selectedOutputDevice,deviceConnectionStatusInterval,serverRetryTimeout,videoStallTimeout,filterDebounce,MediaType={PlaylistInternal:0,Video:1,Audio:2,FunscriptType:3,VR:4,ExternalType:5},ScriptType={MAIN:0,ALTERNATE:1},ScriptContainerType={BASE:0,MFS:1,ZIP:2},Roles={DisplayRole:0,DecorationRole:1,EditRole:2,ToolTipRole:3,StatusTipRole:4,WhatsThisRole:5,FontRole:6,TextAlignmentRole:7,BackgroundRole:8,ForegroundRole:9},MediaActions={},mediaLoading=!1,debounceTracker={},websocket=null,xtpConnected=!1,xtpFormDirty=!1,mediaListGlobal=[],mediaListDisplayed=[],selectedMediaItemMetaData=null,selectedMediaItemAltScript=null,selectedMediaItemAltScriptCount=0,funscriptChannels=[],currentChannelIndex=0,outputConnectionStatus=ConnectionStatus.Disconnected,serverRetryTimeoutTries=0,userFilterCriteria="",userTagFilterCriteria=[],enableTextToSpeech=!0,systemVoices=[],speechNotInbrowser=!1,selectedVoiceIndex=0,speechPitch=5,speechRate=5,speechVolume=.5,rangeChangeAmount=100,shufflePlayMode=!1,shufflePlayModePlayedIndexed={};const tagCheckboxesName="TagCheckbox",metadataTagCheckboxesName="MetadataTagCheckbox",parseCookie=e=>e.split(";").map((e=>e.split("="))).reduce(((e,t)=>(t&&t[0].trim().length&&(e[decodeURIComponent(t[0].trim())]=decodeURIComponent(t[1].trim())),e)),{});function delete_cookie(e,t,n){get_cookie(e)&&(document.cookie=e+"="+(t?";path="+t:"")+(n?";domain="+n:"")+";expires=Thu, 01 Jan 1970 00:00:01 GMT")}function get_cookie(e){return document.cookie.split(";").some((t=>t.trim().startsWith(e+"=")))}document.addEventListener("keyup",keyboardShortcuts),document.addEventListener("click",destroyMediaContextNode);var cookies=parseCookie(document.cookie);cookies.sessionID||(document.getElementById("logoutSection").style.display="none",document.getElementById("logoutSectionSpacing").style.display="none",document.getElementById("sessionInfoTable").hidden=!0),getBrowserInformation();var userAgentIsDeo=-1!=userAgent.indexOf("Deo VR"),userAgentIsHereSphere=-1!=userAgent.indexOf("HereSphere"),userAgentIsMobile=-1!=userAgent.indexOf("Mobile");setDeoStyles(userAgentIsDeo);var settingsNode=document.getElementById("settingsModal");const mediaItemSettingsModalNode=document.getElementById("mediaItemSettingsModal"),metaDataTagsNode=document.getElementById("metaDataTags");var thumbsContainerNode=document.getElementById("thumbsContainer"),videoMediaName=document.getElementById("videoMediaName");const storedHash=window.localStorage.getItem("storedHash");var sortByGlobal=JSON.parse(window.localStorage.getItem("sortBy")),showGlobal=JSON.parse(window.localStorage.getItem("show"));null==showGlobal&&(window.localStorage.setItem("show",JSON.stringify("All")),showGlobal="All");var thumbSizeGlobal=JSON.parse(window.localStorage.getItem("thumbSize")),selectedSyncConnectionGlobal=JSON.parse(window.localStorage.getItem("selectedSyncConnection")),selectedOutputConnectionGlobal=JSON.parse(window.localStorage.getItem("selectedOutputConnection")),disableLazyLoad=JSON.parse(window.localStorage.getItem("disableLazyLoad"));toggleLazyLoad(disableLazyLoad,!1);var externalStreaming=JSON.parse(window.localStorage.getItem("externalStreaming"));toggleExternalStreaming(externalStreaming,!1);const skipToMoneyShotButton=document.getElementById("money-shot"),skipToNextActionButton=document.getElementById("next-action"),exitVideoButton=document.getElementById("exit-action");skipToMoneyShotButton.addEventListener("click",sendSkipToMoneyShot),skipToMoneyShotButton.addEventListener("click",onSkipToMoneyShotClick),skipToNextActionButton.addEventListener("click",sendSkipToNextActionClick),exitVideoButton.addEventListener("click",stopVideoClick);const playNextButton=document.getElementById("play-next");playNextButton.addEventListener("click",playNextVideoClick);const playPreviousButton=document.getElementById("play-previous");playPreviousButton.addEventListener("click",playPreviousVideoClick);const xtpWebVersionNode=document.getElementById("webVersion");xtpWebVersionNode.innerText="v0.472b";var saveStateNode=document.getElementById("saveState"),mediaReloadRequiredNode=document.getElementById("mediaReloadRequired"),metaDataSaveStateNode=document.getElementById("metaDataSaveState"),deviceConnectionStatusRetryButtonNodes=document.getElementsByName("deviceStatusRetryButton"),deviceConnectionStatusRetryButtonImageNodes=document.getElementsByName("connectionStatusIconImage"),devicePauseStatusIconButtonNodes=document.getElementsByName("devicePauseStatusButton"),devicePauseStatusIconButtonImageNodes=document.getElementsByName("devicePauseStatusIconImage"),progressNode=document.getElementById("statusOutput"),progressLabelNode=document.getElementById("statusOutputLabel"),filterInput=document.getElementById("filterInput");function debug(e){}function error(e){}function sendWebsocketMessage(e,t){var n;websocket&&xtpConnected&&(n=t?{command:e,message:t}:{command:e},websocket.send(JSON.stringify(n)))}function onInputDeviceConnectionChange(e,t){selectedInputDevice=t,sendInputDeviceConnectionChange(t,e.checked),window.localStorage.setItem("selectedSyncConnection",parseInt(t,10)),sendMediaState()}function onOutputDeviceConnectionChange(e,t){selectedOutputDevice=t,sendOutputDeviceConnectionChange(t,e.checked),window.localStorage.setItem("selectedOutputConnection",parseInt(t,10)),sendMediaState()}function startMetadataProcess(){showAlertWindow("Process metadata","This will set metadata using the algrorith on first scan.<br>Adding smart tags and mfs tags based on the scan.<br>It will not change any user tags set by you.",sendMetadataProcess)}function startMetadataCleanProcess(){showAlertWindow("Clean metadata","This will compare the metadata with the currently loaded libraries<br>and delete any that do not exist any more.<br><u><b>DO NOT RUN</b></u> unless you have all your media currently loaded!",sendMetadataCleanProcess)}function startThumbCleanupProcess(){showAlertWindow("Clean thumbs","This will go through the thumbs and remove any thumbs where the media<br>do not exist or they not have an image in the media directory.",sendCleanupThumbsProcess)}function startClean1024Process(){showAlertWindow("Reset 1024","This will go through all media items and<br>set offsets that are equal to 1024 to 0.<br><br>Continue?",sendClean1024Process)}function sendMetadataProcess(){sendWebsocketMessage("startMetadataProcess"),closeAlertWindow()}function sendMetadataCleanProcess(){sendWebsocketMessage("cleanupMetadata"),closeAlertWindow()}function sendCleanupThumbsProcess(){sendWebsocketMessage("cleanupThumbs"),closeAlertWindow()}function sendClean1024Process(){sendWebsocketMessage("clean1024"),closeAlertWindow()}function tcodeDeviceConnectRetry(){sendWebsocketMessage("connectOutputDevice",{deviceName:remoteUserSettings.connection.output.selectedDevice})}function sendTCode(e){sendWebsocketMessage("tcode",e)}function sendTCodeRange(e,t,n){sendWebsocketMessage("setChannelRange",{channelName:e,min:t,max:n})}function sendMediaAction(e){sendWebsocketMessage("mediaAction",e)}function sendInputDeviceConnectionChange(e,t){sendWebsocketMessage("connectInputDevice",{deviceName:e,enabled:t})}function sendOutputDeviceConnectionChange(e,t){sendWebsocketMessage("connectOutputDevice",{deviceName:e,enabled:t})}function sendSkipToNextActionClick(){sendSkipToNextAction()}function sendSkipToNextAction(){sendWebsocketMessage("skipToNextAction")}function sendSkipToMoneyShot(){sendWebsocketMessage("skipToMoneyShot")}function sendUpdateThumb(e){sendWebsocketMessage("saveSingleThumb",{itemID:e.id,pos:0})}function sendUpdateThumbAtPos(e){var t=videoNode.currentTime;sendWebsocketMessage("saveSingleThumb",{itemID:e.id,pos:t})}function sendUpdateMoneyShotAtPos(e){var t=videoNode.currentTime;sendWebsocketMessage("setMoneyShot",{itemID:e.id,pos:t})}function sendUpdateMetadata(e){sendWebsocketMessage("processMetadata",e)}function sendDeviceHome(){sendMediaAction(MediaActions.TCodeHomeAll)}function togglePauseAllDeviceActions(){sendMediaAction(MediaActions.TogglePauseAllDeviceActions)}function sendSwapScript(e){sendWebsocketMessage("swapScript",e)}function settingChange(e,t){settingChangeDebounce&&clearTimeout(settingChangeDebounce),settingChangeDebounce=setTimeout((function(){sendWebsocketMessage("settingChange",{key:e,value:t})}),500)}function setSaveState(e,t,n){e||(e=saveStateNode),e.innerText=t?"Saving settings...":"Save success!",n?(e.style.visibility="visible",e.style.opacity="1",e.style.color="red",e.innerText="Save fail",e.title=n):(t?e.style.color="white":(e.style.color="green",setTimeout((()=>{e.style.visibility="hidden",e.style.opacity="0"}),5e3)),e.style.visibility="visible",e.style.opacity="1")}function restartXTP(){showAlertWindow("Confirm","Are you sure you want restart XTP? \n\t\t"+(remoteUserSettings.hasLaunchPass?"\n\t\t\t<br><br>PLEASE NOTE: XTP is protected by a launch password.\n\t\t\t<br>You will need to go to the pc and enter the password manually for now.":""),(function(){sendWebsocketMessage("restartService"),closeAlertWindow(),closeSettings()}))}function refreshXTPLibrary(){sendWebsocketMessage("reloadLibrary"),mediaReloadRequiredNode.classList.add("hidden")}function initWebSocket(){try{debug("Connecting to web socket uri: "+(wsUri="ws://"+window.location.hostname+":"+remoteUserSettings.webSocketServerPort)),"function"==typeof MozWebSocket&&(WebSocket=MozWebSocket),websocket&&1==websocket.readyState&&websocket.close(),(websocket=new WebSocket(wsUri)).onopen=function(e){xtpConnected=!0,stopServerConnectionRetry(),serverRetryTimeoutTries=0,debug("CONNECTED"),updateSettingsUI(),sendMediaState()},websocket.onmessage=function(e){wsCallBackFunction(e),debug("MESSAGE RECIEVED: "+e.data)},websocket.onclose=function(e){debug("DISCONNECTED"),xtpConnected=!1,startServerConnectionRetry()},websocket.onerror=function(e){xtpConnected=!1,startServerConnectionRetry()}}catch(e){xtpConnected=!1,startServerConnectionRetry()}}function wsCallBackFunction(e){try{var t=JSON.parse(e.data);switch(t.command){case"userError":userError(t.message);break;case"userWarning":userWarning(t.message);break;case"systemError":systemError(t.message);break;case"systemWarning":systemWarning(t.message);break;case"settingChange":onSaveSuccess();case"stopAllMedia":stopVideo();break;case"outputDeviceStatus":setOutputConnectionStatus((n=t.message).deviceName,n.status,n.message);break;case"inputDeviceStatus":var n;setInputConnectionStatus((n=t.message).deviceName,n.status,n.message);break;case"mediaLoaded":onMediaLoaded();break;case"mediaLoading":setMediaLoading();break;case"mediaLoadingStatus":setMediaLoadingStatus(t.message);break;case"updateThumb":var a=t.message,o=document.getElementById(a.id);if(o){var i=o.getElementsByClassName("media-thumb-nail")[0],s="/thumb/"+a.thumb+"?"+(new Date).getTime();i.src.length>0?i.src=s:i.dataset.src=s,a.errorMessage&&(i.title=a.errorMessage);var r=mediaListGlobal.findIndex((e=>e.id===a.id));mediaListGlobal[r].relativeThumb="/thumb/"+a.thumb,mediaListGlobal[r].thumbFileExists=!0}break;case"updateItem":updateItem(d=(a=t.message).item,a.roles);break;case"addItem":var d=(a=t.message).item;a.roles;addItem(d);break;case"textToSpeech":onTextToSpeech(a=t.message);break;case"skipToNextAction":skipVideoTo(a=t.message);break;case"skipToMoneyShot":onSkipToMoneyShot();break;case"logout":logout();break;case"channelProfileChanged":getServerChannels();break;case"statusOutput":a=(y=t.message).message;var l=y.percentage;setStatusOutput(a,l);break;case"tagsUpdate":var c=(y=t.message).smartTags,u=y.userTags;remoteUserSettings.allTags=[],remoteUserSettings.allTags.push(...u,...c),remoteUserSettings.userTags=[],remoteUserSettings.userTags.push(...u),remoteUserSettings.smartTags=[],remoteUserSettings.smartTags.push(...c),setupSystemTags();break;case"channelPositionChange":var m=(y=t.message).channel,p=parseInt(y.position),g=parseInt(y.time),h=parseInt(y.timeType);setChannelStatus(m,p,g,h);break;case"mediaAction":t.message;break;case"scriptTogglePaused":var y=t.message;setPauseScriptStatus(y.isPaused),setDevicePauseStatus(y.isPaused);break;case"changePlayrate":y=t.message;break;case"metadataProcessingFinished":getServerLibrary();break}}catch(e){error("string"==typeof e?e:e.toString())}}function setStatusOutput(e,t){e||progressNode.classList.contains("hidden-visibility")?e&&progressNode.classList.contains("hidden-visibility")&&(progressNode.classList.remove("hidden-visibility"),progressLabelNode.classList.remove("hidden-visibility")):(progressNode.classList.add("hidden-visibility"),progressLabelNode.classList.add("hidden-visibility")),progressLabelNode.innerText=(e||"")+(t>-1?": "+t+"%":""),progressNode.value=t>-1?t:0}function setMediaLoading(){mediaLoading=!0,stopVideo(),clearMediaList(),document.getElementById("mediaLoading").style.display="flex";var e=document.getElementById("noMedia"),t=document.getElementsByName("mediaLoadingIcon");for(let e=0;e<t.length;e++){t[e].classList.remove("hidden")}e.hidden=!0;var n=document.getElementsByName("refreshXTPLibraryButton");for(let e=0;e<n.length;e++){n[e].disabled=!0}var a=document.getElementsByName("mediaLoadingStatus");for(let e=0;e<a.length;e++){const t=a[e];t.innerText="",t.classList.remove("hidden")}}function onMediaLoaded(){document.getElementById("mediaLoading").style.display="none",mediaLoading=!1;var e=document.getElementsByName("mediaLoadingIcon");for(let t=0;t<e.length;t++){e[t].classList.add("hidden")}var t=document.getElementsByName("refreshXTPLibraryButton");for(let e=0;e<t.length;e++){t[e].disabled=!1}var n=document.getElementsByName("mediaLoadingStatus");for(let e=0;e<n.length;e++){const t=n[e];t.innerText="",t.classList.add("hidden")}getServerLibrary()}function setMediaLoadingStatus(e){document.getElementById("loadingStatus").innerText=e;var t=document.getElementsByName("mediaLoadingStatus");for(let n=0;n<t.length;n++){t[n].innerText=e}}function onResizeVideo(){}function getBrowserInformation(){var e,t,n,a,o,i,s=navigator.userAgent;-1!=(o=s.indexOf("Opera"))?(e="Opera",t=s.substring(o+6),-1!=(o=s.indexOf("Version"))&&(t=s.substring(o+8))):-1!=(o=s.indexOf("MSIE"))?(e="Microsoft Internet Explorer",t=s.substring(o+5)):-1!=(o=s.indexOf("Chrome"))?(e="Chrome",t=s.substring(o+7)):-1!=(o=s.indexOf("Safari"))?(e="Safari",t=s.substring(o+7),-1!=(o=s.indexOf("Version"))&&(t=s.substring(o+8))):-1!=(o=s.indexOf("Firefox"))?(e="Firefox",t=s.substring(o+8)):(a=s.lastIndexOf(" ")+1)<(o=s.lastIndexOf("/"))&&(e=s.substring(a,o),t=s.substring(o+1),e.toLowerCase()==e.toUpperCase()&&(e=navigator.appName)),-1!=(i=t.indexOf(";"))&&(t=t.substring(0,i)),-1!=(i=t.indexOf(" "))&&(t=t.substring(0,i)),n=parseInt(""+t,10),isNaN(n)&&(t=""+parseFloat(navigator.appVersion),n=parseInt(navigator.appVersion,10));var r=document.createElement("div");r.innerHTML="Browser name  = "+e+"<br>Full version  = "+t+"<br>Major version = "+n+"<br>navigator.userAgent = "+navigator.userAgent+"<br>",userAgent=navigator.userAgent,document.getElementById("browserInfo").appendChild(r)}function setDeoStyles(e){if(e)for(var t=document.querySelectorAll("input[type='checkbox']"),n=0;n<t.length;n++)t[n].classList.remove("styled-checkbox");else for(t=document.getElementsByClassName("input[type='checkbox']"),n=0;n<t.length;n++)t[n].classList.add("styled-checkbox")}function parseHttpError(e,t){const n=t.status;let a=e+": ";if(401===n)storedHash?checkPass():window.location.replace(window.location.origin);else if(t.statusText&&t.statusText.length>0)systemError(a+t.statusText);else if("object"==typeof n||"object"==typeof t.response){if("object"==typeof t.response){const e=JSON.parse(t.response);if(e.message&&e.message.length>0)return void systemError(a+e.message)}else if(n.statusText&&n.statusText.length>0)return void systemError(a+n.statusText);systemError(a+typeof n=="object"?JSON.stringify(n):JSON.stringify(t.response))}else systemError(a+"Unknown error: "+n)}function logout(){var e=new XMLHttpRequest;e.open("GET","/logout",!0),e.responseType="json",e.onload=function(){200===e.status?(window.localStorage.removeItem("storedHash"),window.sessionStorage.clear(),delete_cookie("sessionID"),cookies.sessionID=void 0,window.location.replace(window.location.origin)):parseHttpError("Error logging out",e)},e.onerror=function(){parseHttpError("Error logging out",e)},e.send()}function checkPass(){var e=new XMLHttpRequest;e.open("POST","/auth",!0),e.setRequestHeader("Content-Type","application/json"),e.onreadystatechange=function(){4===e.readyState&&(200==e.status?startServerConnectionRetry():parseHttpError("Error checking pass",e))},e.onerror=function(){parseHttpError("Error checking pass",e)},storedHash?e.send('{"hashedPass":"'+storedHash+'", "remember":"'+!!storedHash+'"}'):alert("Invalid password")}function getServerSettings(e){var t=new XMLHttpRequest;t.open("GET","/settings",!0),t.responseType="json",t.onload=function(e,n){200===t.status?(remoteUserSettings=t.response,document.getElementById("xteVersion").innerText=remoteUserSettings.xteVersion,Settings.load(remoteUserSettings),setupChannelData(),setupSystemTags(),initWebSocket()):parseHttpError("Error getting server settings",t)}.bind(this),t.onerror=function(e,t){startServerConnectionRetry()},t.send()}function getMediaActions(){var e=new XMLHttpRequest;e.open("GET","/mediaActions",!0),e.responseType="json",e.onload=function(t){200===e.status?MediaActions=e.response:parseHttpError("Error getting media actions",e)}.bind(this),e.onerror=function(t){parseHttpError("Error getting media actions",e)},e.send()}function getServerChannels(){var e=new XMLHttpRequest;e.open("GET","/channels",!0),e.responseType="json",e.onload=function(t){if(200===e.status){var n=e.response;remoteUserSettings.availableChannels=n.availableChannels,remoteUserSettings.selectedChannelProfile=n.selectedChannelProfile,remoteUserSettings.allChannelProfileNames=n.allChannelProfileNames,setupChannelData(),updateChannelsUI()}else parseHttpError("Error getting channels",e)}.bind(this),e.onerror=function(t){parseHttpError("Error getting channels",e)},e.send()}function setupChannelData(){funscriptChannels=Object.keys(remoteUserSettings.availableChannels).map((function(e){return remoteUserSettings.availableChannels[e].channel})),remoteUserSettings.availableChannelsArray=Object.keys(remoteUserSettings.availableChannels).map((function(e){return remoteUserSettings.availableChannels[e]})),funscriptChannels.sort()}function setupSystemTags(){const e=remoteUserSettings.allTags,t=document.getElementById("tagFilterOptions");removeAllChildNodes(t),removeAllChildNodes(metaDataTagsNode);const n=document.createElement("div");n.classList.add("media-tag-filter-container"),t.appendChild(n),e.forEach(((e,t)=>{n.appendChild(createCheckBoxDiv(e+"TagCheckbox"+t,"TagCheckbox",e,e,onFilterByTagClicked)),metaDataTagsNode.appendChild(createCheckBoxDiv(e+"MetadataTagCheckbox"+t,"MetadataTagCheckbox",e,e,onMetadataTagCheckboxClicked))}));const a=document.getElementById("systemTagsSelect");for(;a.options.length>0;)a.options.remove(a.options.length-1);remoteUserSettings.userTags.forEach(((e,t)=>{const n=document.createElement("option");n.value=e,n.innerText=e,a.options.add(n)}));const o=document.getElementById("smartTagsSelect");for(;o.options.length>0;)o.options.remove(o.options.length-1);remoteUserSettings.smartTags.forEach(((e,t)=>{const n=document.createElement("option");n.value=e,n.innerText=e,o.options.add(n)}))}function systemTagsSelectChange(e){document.getElementById("removeTagButton").disabled=-1==e.options.selectedIndex}function smartagsSelectChange(e){document.getElementById("removeSmartTagButton").disabled=-1==e.options.selectedIndex}function addSystemTag(e){showGetTextWindow(e?"Add smart tag":"Add tag","Name",(function(t){systemTagAdded(t,e)}))}function systemTagAdded(e,t){if(!e||!e.trim().length)return void showAlertWindow("Empty","Tag cant be empty!");if(remoteUserSettings[t?"smartTags":"userTags"].findIndex((t=>t==e))>-1)return void showAlertWindow("Tag exists",`Tag '${e}' already exists!`);const n=t?"userTags":"smartTags";if(remoteUserSettings[n].findIndex((t=>t==e))>-1)return void showAlertWindow("Tag exists",`Tag '${e}' already exists in ${n}!`);const a=t?"smartTagsToAdd":"tagsToAdd";remoteUserSettings[a]||(remoteUserSettings[a]=[]),remoteUserSettings[a].push(e);const o=document.getElementById(t?"smartTagsSelect":"systemTagsSelect"),i=document.createElement("option");i.value=e,i.innerText=e,o.options.add(i),t&&mediaReloadRequiredNode.classList.remove("hidden"),closeTextWindow(),markXTPFormDirty()}function removeSystemTags(e){remoteUserSettings[e?"smartTags":"userTags"];const t=document.getElementById(e?"smartTagsSelect":"systemTagsSelect"),n=e?"smartTagsToRemove":"tagsToRemove";for(remoteUserSettings[n]||(remoteUserSettings[n]=[]);t.options.selectedIndex>-1;){const e=t.options[t.options.selectedIndex];remoteUserSettings[n].push(e.value),t.options.remove(t.options.selectedIndex)}markXTPFormDirty()}function setSelectedProfile(e){sendWebsocketMessage("changeChannelProfile",e)}function getServerSessions(){if(cookies.sessionID){var e=new XMLHttpRequest;e.open("GET","/activeSessions",!0),e.responseType="json",e.onload=function(t){if(200===e.status){var n=e.response,a=document.getElementById("sessionInfoBody");removeAllChildNodes(a),n.forEach((e=>{var t=document.createElement("tr");t.id=e.id;var n=document.createElement("td");n.innerText=e.id;var o=document.createElement("td");o.innerText=e.lastAccessed;var i=document.createElement("td");i.innerText=e.expire;var s=document.createElement("td");s.innerText=e.current?"*":"";var r=document.createElement("td"),d=document.createElement("button");d.onclick=checkSession(e.id),d.innerText="X",r.appendChild(d),t.appendChild(n),t.appendChild(o),t.appendChild(i),t.appendChild(s),t.appendChild(r),a.appendChild(t)}))}else parseHttpError("Error getting server sessions",e)}.bind(this),e.onerror=function(t,n){parseHttpError("Error getting server sessions",e)},e.send()}}filterInput.value=userFilterCriteria,setupTextToSpeech(),getServerSettings(),getMediaActions();var checkSession=function(e){return function(){e==cookies.sessionID?showAlertWindow("Logout?","Are you sure you want to delete the current session? This will log you out.",(function(){deleteSession(e)})):deleteSession(e)}};function deleteSession(e){var t=new XMLHttpRequest;t.open("POST","/expireSession?sessionID="+e,!0),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=function(){if(4===t.readyState)if(200==t.status){var n=document.getElementById(e);document.getElementById("sessionInfoBody").removeChild(n),e==cookies.sessionID&&(delete_cookie("sessionID"),logout())}else parseHttpError("Error deleting session",t)},t.onerror=function(){parseHttpError("Error deleting session",t)},t.send()}function startServerConnectionRetry(){stopServerConnectionRetry(),setMediaLoading(),setMediaLoadingStatus("Waiting for reconnect..."),++serverRetryTimeoutTries<100?serverRetryTimeout=setTimeout((()=>{getServerSettings()}),5e3):setMediaLoadingStatus("Timed out while looking for server. Please refresh the page when the server has started again.")}function stopServerConnectionRetry(){null!=serverRetryTimeout&&(clearTimeout(serverRetryTimeout),serverRetryTimeout=void 0)}function updateSettingsUI(){updateChannelsUI(),setupConnectionsTab(),document.getElementById("tabLocalTab").onclick()}function updateChannelsUI(){var e=document.getElementById("profileNamesDiv");removeAllChildNodes(e),remoteUserSettings.allChannelProfileNames.forEach((t=>{var n=document.createElement("input"),a=document.createElement("label");n.type="radio",n.id=t,n.name="motionProfileGroup",n.value=t,n.onclick=function(){setSelectedProfile(this.value)},t==remoteUserSettings.selectedChannelProfile&&(n.checked=!0),a.for=t,a.innerText=t,e.appendChild(n),e.appendChild(a)})),setupSliders(),setupMotionModifiers()}function getServerLibrary(){var e=new XMLHttpRequest;e.open("GET","/media",!0),e.responseType="json",e.onload=function(){200===e.status?(mediaListGlobal=e.response,setThumbSize(thumbSizeGlobal,!1),sort(sortByGlobal,!1),loadMedia(mediaListDisplayed=getDisplayedMediaList(showGlobal,!1)),filter()):parseHttpError("Error getting media",e)},e.onerror=function(){parseHttpError("Error getting media",e)},e.send()}function setInputConnectionStatus(e,t,n){var a="",o="";switch(t){case ConnectionStatus.Connected:a="://images/icons/check-mark-black.png",o="chartreuse";break;case ConnectionStatus.Connecting:a="://images/icons/reload.svg",o="yellow";break;case ConnectionStatus.Disconnected:a="://images/icons/x.svg",o="crimson";break;case ConnectionStatus.Error:a="://images/icons/error-black.png",o="red";break}var i=document.getElementById("deoVRStatus"),s=document.getElementById("whirligigStatus"),r=document.getElementById("xtpWebStatus"),d=document.getElementById("gamepadStatus");switch(e!=DeviceType.Gamepad&&(i.src="://images/icons/x.svg",i.style.backgroundColor="crimson",i.title="Disconnected",s.src="://images/icons/x.svg",s.style.backgroundColor="crimson",s.title="Disconnected",r.src="://images/icons/x.svg",r.style.backgroundColor="crimson",r.title="Disconnected"),e){case DeviceType.Deo:i.src=a,i.style.backgroundColor=o,i.title=n;break;case DeviceType.Whirligig:s.src=a,s.style.backgroundColor=o,s.title=n;break;case DeviceType.XTPWeb:r.src=a,r.style.backgroundColor=o,r.title=n;break;case DeviceType.Gamepad:d.src=a,d.style.backgroundColor=o,d.title=n;break}}function setDevicePauseStatus(e){for(var t=0;t<devicePauseStatusIconButtonNodes.length;t++){var n=devicePauseStatusIconButtonNodes[t],a=devicePauseStatusIconButtonImageNodes[t];n.title="TCode device pause toggle.\nDevice status: ",e?(n.title+="paused",n.classList.add("video-control--device-state-paused"),a.setAttribute("src","://images/icons/play.svg")):(n.title+="not paused",n.classList.remove("video-control--device-state-paused"),a.setAttribute("src","://images/icons/pause.svg"))}}function setOutputConnectionStatus(e,t,n){for(var a=0;a<deviceConnectionStatusRetryButtonNodes.length;a++){var o=deviceConnectionStatusRetryButtonNodes[a],i=deviceConnectionStatusRetryButtonImageNodes[a];o.title="TCode status: "+n,o.style.cursor="",o.disabled=!0;var s=document.getElementById("tcodeDeviceSettingsLink");switch(s.hidden=!0,outputConnectionStatus=t,t){case ConnectionStatus.Disconnected:o.style.backgroundColor="crimson",o.style.cursor="pointer",o.disabled=!1,i.src="://images/icons/x.svg",o.title+=": Check your devices connection and click this to retry";break;case ConnectionStatus.Connecting:o.style.backgroundColor="yellow",i.src="://images/icons/reload.svg";break;case ConnectionStatus.Connected:outputDeviceConnected=!0,o.style.backgroundColor="chartreuse",i.src="://images/icons/check-mark-black.png",remoteUserSettings.connection.output.selectedDevice==DeviceType.Network&&(s.href="http://"+remoteUserSettings.connection.output.networkAddress,s.hidden=!1);break;case ConnectionStatus.Error:o.style.backgroundColor="red",o.style.cursor="pointer",o.disabled=!1,i.src="://images/icons/error-black.png",o.title+=": Check your devices connection and click this to retry";break}}var r="",d="";switch(t){case ConnectionStatus.Connected:r="://images/icons/check-mark-black.png",d="chartreuse";break;case ConnectionStatus.Connecting:r="://images/icons/reload.svg",d="yellow";break;case ConnectionStatus.Disconnected:r="://images/icons/x.svg",d="crimson";break;case ConnectionStatus.Error:r="://images/icons/error-black.png",d="red";break}var l=document.getElementById("networkStatus"),c=document.getElementById("serialStatus");switch(l.src="://images/icons/x.svg",l.style.backgroundColor="crimson",l.title="Disconnected",c.src="://images/icons/x.svg",c.style.backgroundColor="crimson",c.title="Disconnected",e){case DeviceType.Network:l.src=r,l.style.backgroundColor=d,l.title=n;break;case DeviceType.Serial:c.src=r,c.style.backgroundColor=d,c.title=n;break}}function getMediaFunscripts(e,t){var n=funscriptChannels[currentChannelIndex],a=remoteUserSettings.availableChannels[n].trackName,o=new XMLHttpRequest,i=""===a?a:"."+a;o.open("GET",e+i+".funscript",!0),o.responseType="json",o.onload=function(){if(200===o.status){loadedFunscripts.push({channel:n,atList:[]});for(var a=loadedFunscripts.length-1,i=o.response,s=0;s<i.actions.length;s++){var r=i.actions[s],d=r.at;loadedFunscripts[a][d]=r.pos,loadedFunscripts[a].atList.push(d)}++currentChannelIndex<funscriptChannels.length?getMediaFunscripts(e,t):(currentChannelIndex=0,videoNode.play())}else parseHttpError("Error getting media funscripts",o)},o.send()}function onSaveToXTPClick(){postServerSettings()}function postServerSettings(){setSaveState(null,!0);var e=new XMLHttpRequest;e.open("POST","/settings",!0),e.setRequestHeader("Content-Type","application/json"),e.onreadystatechange=function(){4===e.readyState&&(200!==e.status?onSaveFail(e):(onSaveSuccess(),markXTPFormClean()))},e.onerror=function(){onSaveFail(e)},e.send(JSON.stringify(remoteUserSettings))}function validateMetadata(e){e.MFSScripts&&e.MFSScripts.length>100&&showAlertWindow("System error",`There is a possible issue with this items metadata.<br>\n\t\t\tDoing a metadata process by clicking one of the buttons below or<br>\n\t\t\tfrom 'Settings > System > Process metadata' should fix this issue<br>\n\t\t\tYou can also click 'Update metadata' from this media items context menu.<br>\n\t\t\tNote: you may need to resave after the item has been updated.<br><br>\n\t\t\t<button style='margin-top:8px' onclick='closeAlertWindow();sendUpdateMetadata("${e.key}");'>Process ONLY THIS items metadata</button>\n\t\t\t<button onclick='closeAlertWindow();startMetadataProcess();'>Start processing ALL metadata now</button>`)}function postMediaItemMetaData(e){validateMetadata(e);var t=new XMLHttpRequest;t.open("POST","/mediaItemMetadata",!0),t.setRequestHeader("Content-Type","application/json"),t.onreadystatechange=function(){4===t.readyState&&(200!==t.status?onSaveFail(t,metaDataSaveStateNode):(onSaveSuccess(metaDataSaveStateNode),document.getElementById("saveMediaItemMetaDataButton").disabled=!0))},t.onerror=function(){onSaveFail(t,metaDataSaveStateNode)},t.send(JSON.stringify(e))}function postMediaState(e){var t=new XMLHttpRequest;t.open("POST","/xtpweb",!0),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify(e)),t.oneload=function(){200!==t.status&&parseHttpError("Error sending media state",t)},t.onerror=function(){parseHttpError("Error sending media state",t)}}function onSaveSuccess(e){setSaveState(e,!1)}function onSaveFail(e,t){parseHttpError("Save fail",e),setSaveState(t,!1,statusTest)}function clearMediaList(){var e=document.getElementById("mediaList");return removeAllChildNodes(e),e}function loadMedia(e){var t=clearMediaList(),n=document.getElementById("noMedia");if(e&&0!=e.length){n.hidden=!0;for(var a=function(e){return function(){playVideo(e)}},o=function(e,t){return function(){e.classList.toggle("hidden");var n=e.getElementsByClassName("setThumbAtCurrent")[0],a=e.getElementsByClassName("setMoneyShotAtCurrent")[0],o=playingmediaItem&&playingmediaItem.id===t.id;isVideoShown()&&o?(n.classList.remove("disabled"),a.classList.remove("disabled"),a.title="Set moneyshot at current",n.title="Set thumb at current"):(n.classList.add("disabled"),n.title="This is not the current playing video so it cannot be set at the current position.",a.classList.add("disabled"),a.title="This is not the current playing video so it cannot be set at the current position.");var i=e.getElementsByClassName("showAlternateScripts")[0];o?selectedMediaItemAltScriptCount>0?(i.style.color="green",i.classList.remove("disabled"),i.title="Select alternate scripts if there are any."):(i.style.color="grey",i.classList.add("disabled"),i.title="No alternate scripts for current media."):(i.style.color="grey",i.classList.add("disabled"),i.title="This is not the current playing video.");var s=e.getElementsByClassName("regenerateThumb")[0];t.managedThumb&&!t.thumb.includes(".lock.")?s.classList.remove("disabled"):(s.classList.add("disabled"),s.title="This thumb file is not modifiable because it is not managed by XTP.")}},i=function(e){return function(){e.classList.add("hidden")}},s=function(e,t){return function(){openMetaDataModal(e),t.classList.add("hidden")}},r=function(e,t){return function(){sendUpdateThumb(e),t.classList.add("hidden")}},d=function(e,t){return function(){sendUpdateThumbAtPos(e),t.classList.add("hidden")}},l=function(e,t){return function(){e.metaData.moneyShotMillis=Math.round(1e3*videoNode.currentTime).toString(),postMediaItemMetaData(e.metaData),t.classList.add("hidden")}},c=function(e,t){return function(){sendUpdateMetadata(e.metaData.key),t.classList.add("hidden")}},u=function(e,t){return function(){openAlternateScriptsModal(e)}},m=0,p=0,g=0,h=0,y=0,v=0;v<e.length;v++){var b=e[v];thumbSizeGlobal||(setThumbSize(b.thumbSize,!0),setThumbSize(b.thumbSize,!1)),m||(p=(g=thumbSizeGlobal+.15*thumbSizeGlobal)+"px",h=thumbSizeGlobal+(m=.25*thumbSizeGlobal)+"px",y=.35*m+"px");var f=document.createElement("div");f.id=b.id,f.classList.add("media-item"),f.style.width=p,f.style.height=h,f.title=b.tooltip,f.setAttribute("data-display-name",b.displayName);var S=document.createElement("button");S.id=b.id+"InfoButton",S.classList.add("media-context"),S.style.width=.2*g+"px",S.style.height=.2*g+"px";var C=document.createElement("div");C.id=b.id+"ContextMenu",S.onclick=o(C,b),S.dataset.title="Media actions";var I=document.createElement("img");I.src="://images/icons/context-menu.svg",I.style.width=.1*g+"px",I.style.height=.1*g+"px",S.appendChild(I),C.classList.add("media-context-menu","hidden"),C.style.fontSize=y,(k=createContextMenuItem("Regenerate thumb",r(b,C))).classList.add("regenerateThumb","disabled"),C.appendChild(k),(k=createContextMenuItem("Set thumb at current",d(b,C))).classList.add("setThumbAtCurrent","disabled"),C.appendChild(k),(k=createContextMenuItem("Set moneyshot at current",l(b,C))).classList.add("setMoneyShotAtCurrent","disabled"),C.appendChild(k);var T=createContextMenuItem("Update metadata",c(b,C));C.appendChild(T);var k=createContextMenuItem("Edit metadata",s(b,C));C.appendChild(k),(k=createContextMenuItem("Alternate scripts",u(b))).classList.add("showAlternateScripts","disabled"),C.appendChild(k);var E=createContextMenuItem("Cancel",i(C));C.appendChild(E),f.appendChild(C),f.appendChild(S);var M=document.createElement("a");M.className+="media-link",M.onclick=a(b);var w=document.createElement("img");disableLazyLoad?(b.thumbFileExists?w.src="/thumb/"+b.relativeThumb:w.src="/thumb/"+b.thumbFileLoading,w.loading="lazy"):(b.thumbFileExists?w.dataset.src="/thumb/"+b.relativeThumb:w.dataset.src="/thumb/"+b.thumbFileLoading,w.classList.add("lazy")),w.classList.add("media-thumb-nail"),w.style.width=thumbSizeGlobal+"px",w.style.height=thumbSizeGlobal-m+"px";var x=document.createElement("div");x.id=b.id+"DisplayName",x.innerText=b.displayName,x.className+="name",x.style.width=p,x.style.height=m+"px",x.style.fontSize=y,updateScriptStatus(b,f,x),f.appendChild(M),M.appendChild(w),M.appendChild(x),f.hidden=isFiltered(userFilterCriteria,f.innerText),t.appendChild(f),playingmediaItem&&playingmediaItem.id===b.id&&setPlayingMediaItem(b),b.subtitle&&updateSubTitle(b,f,C)}disableLazyLoad||setupLazyLoad()}else mediaLoading||(n.innerHTML="No media found<br>Current filter: "+showGlobal,n.hidden=!1)}function createMediaContextNode(e,t){}function createContextMenuItem(e,t){var n=document.createElement("div");return n.classList.add("media-context-menu-item"),n.innerText=e,n.onclick=t,n}function destroyMediaContextNode(e){}function setupLazyLoad(){var e=[].slice.call(document.querySelectorAll("img.lazy"));if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype){let t=new IntersectionObserver((function(e,n){e.forEach((function(e){if(e.isIntersecting){let n=e.target;n.src=n.dataset.src,n.classList.remove("lazy"),t.unobserve(n)}}))}));e.forEach((function(e){t.observe(e)}))}}function updateItem(e,t){var n;t.findIndex((e=>e==Roles.DisplayRole))>-1&&(n=updateScriptStatus(e)),t.findIndex((e=>e==Roles.DecorationRole))>-1?n=updateSubTitle(e,n):(showChange(showGlobal),systemSuccess("Item updated!"));var a=mediaListGlobal.findIndex((t=>t.id==e.id));a>-1&&(mediaListGlobal[a]=JSON.parse(JSON.stringify(e))),selectedMediaItem.id==e.id&&(selectedMediaItem=mediaListGlobal[a]),selectedMediaItemMetaData&&selectedMediaItemMetaData.key==e.metaData.key&&(selectedMediaItemMetaData=e.metaData)}function addItem(e){mediaListGlobal.push(e),showChange(showGlobal)}function updateSubTitle(e,t,n){if(t||(t=document.getElementById(e.id)),t){if(n||(n=document.getElementById(e.id+"ContextMenu")),!n)return t;var a=mediaListGlobal.findIndex((t=>t.id===e.id)),o=document.getElementById(e.id+"InfoButton"),i=document.getElementById(e.id+"ccIconImg");i&&o.removeChild(i);var s=n.getElementsByClassName("downloadSubtitle");if(s.length&&n.removeChild(s[0]),e.subtitle){var r=document.createElement("img");r.id=e.id+"ccIconImg",r.src="://images/icons/cc.svg",widthInt=thumbSizeGlobal+.15*thumbSizeGlobal,r.style.width=.1*widthInt+"px",r.style.height=.1*widthInt+"px",r.classList.add("media-cc"),o.appendChild(r);var d="/media"+e.subtitleRelative;const t=e.subtitleRelative.substring(e.subtitleRelative.lastIndexOf("."),e.subtitleRelative.length),a=document.createElement("a");a.href=d,a.setAttribute("download",e.displayName+t),a.innerText="Download subtitle";var l=createContextMenuItem("",void 0);l.classList.add("downloadSubtitle"),l.appendChild(a),n.insertBefore(l,n.firstChild)}return mediaListGlobal[a].subtitle=e.subtitle,mediaListGlobal[a].subtitleRelative=e.subtitleRelative,t}}function updateScriptStatus(e,t,n){if(t||(t=document.getElementById(e.id)),t&&(n||(n=document.getElementById(e.id+"DisplayName")),n)){n.innerText=e.displayName,e.isMFS&&e.hasScript?t.classList.add("media-item-mfs"):e.isMFS&&!e.hasScript?(t.classList.remove("media-item-mfs"),t.classList.add("media-item-mfs-noscript")):t.classList.remove("media-item-mfs"),e.hasScript?t.classList.remove("media-item-noscript"):t.classList.add("media-item-noscript");var a=mediaListGlobal.findIndex((t=>t.id===e.id));return mediaListGlobal[a].displayName=e.displayName,mediaListGlobal[a].isMFS=e.isMFS,mediaListGlobal[a].hasScript=e.hasScript,t}}function onThumbLoadError(e,t){e.onerror=null,t<3?(e.src="://images/icons/loading.png",e.onerror=onThumbLoadError(e,2)):e.src="://images/icons/error.png"}function removeAllChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function sort(e,t){e||(e="nameAsc");var n=document.getElementById("randomizeButton");switch("random"===random||n.classList.contains("hidden")||n.classList.add("hidden"),e){case"dateDesc":mediaListGlobal.sort((function(e,t){return new Date(t.modifiedDate)-new Date(e.modifiedDate)}));break;case"dateAsc":mediaListGlobal.sort((function(e,t){return new Date(e.modifiedDate)-new Date(t.modifiedDate)}));break;case"addedDesc":mediaListGlobal.sort((function(e,t){return new Date(t.metaData.dateAdded)-new Date(e.metaData.dateAdded)}));break;case"addedAsc":mediaListGlobal.sort((function(e,t){return new Date(e.metaData.dateAdded)-new Date(t.metaData.dateAdded)}));break;case"nameAsc":mediaListGlobal.sort((function(e,t){var n=e.displayName.toUpperCase(),a=t.displayName.toUpperCase();return n<a?-1:n>a?1:void 0}));break;case"nameDesc":mediaListGlobal.sort((function(e,t){var n=e.displayName.toUpperCase(),a=t.displayName.toUpperCase();return a<n?-1:a>n?1:void 0}));break;case"random":fy(mediaListGlobal),n.classList.remove("hidden");break}return t?(window.localStorage.setItem("sortBy",JSON.stringify(e)),sortByGlobal=e):e&&(document.getElementById(e.toString()).checked=!0),mediaListGlobal}function fy(e,t,n,a){for(n=e.length;n;)t=Math.random()*n--|0,a=e[n],e[n]=e[t],e[t]=a}function getDisplayedMediaList(e,t){let n=[];switch(e){case"All":n=JSON.parse(JSON.stringify(mediaListGlobal));break;case"3DOnly":n=mediaListGlobal.filter((e=>e.type===MediaType.VR||e.metaData.tags.includes("vr")));break;case"2DAndAudioOnly":n=mediaListGlobal.filter((e=>e.type===MediaType.Audio||e.type===MediaType.Video||e.metaData.tags.includes("2d")||e.metaData.tags.includes("audio")));break}return null!=t&&(t||(document.getElementById(e.toString()).checked=!0)),n}function filter(){const e=document.getElementById("filterInput").value;userFilterCriteria=e,filterInput.enabled=!1;var t=document.getElementsByClassName("media-item");for(var n of t){const e=mediaListDisplayed.find((e=>e.id===n.id)),t=n.getAttribute("data-display-name");n.hidden=isFiltered(userFilterCriteria,t)||isTagFiltered(userTagFilterCriteria,e.metaData.tags)}filterInput.enabled=!0}function debounceFilter(){filterDebounce&&clearTimeout(filterDebounce),filterDebounce=setTimeout((function(){filter(),filterDebounce=void 0}),500)}function isFiltered(e,t){return!(!e||0==e.trim().length)&&!t.trim().toUpperCase().includes(e.trim().toUpperCase())}var onFilterByTagClicked=function(e){return function(){if(e){if(e.checked)userTagFilterCriteria.push(e.value);else{var t=userTagFilterCriteria.findIndex((t=>t==e.value));t>-1&&userTagFilterCriteria.splice(t,1)}filterByTag(userTagFilterCriteria)}}};function filterByTag(e){userTagFilterCriteria=e;var t=document.getElementsByName("TagCheckbox");t.forEach((e=>e.enabled=!1));var n=document.getElementsByClassName("media-item");for(var a of n){const e=mediaListDisplayed.find((e=>e.id===a.id));a.hidden=isTagFiltered(userTagFilterCriteria,e.metaData.tags)||isFiltered(userFilterCriteria,a.textContent)}t.forEach((e=>e.enabled=!0))}function isTagFiltered(e,t){if(e&&e.length&&t&&t.length){for(let n=0;n<e.length;n++)if(!t.includes(e[n]))return!0;return!1}return!1}function onClickLazyLoadCheckbox(e){toggleLazyLoad(e.checked,!0)}function toggleLazyLoad(e,t){t?(externalStreaming=e,window.localStorage.setItem("disableLazyLoad",JSON.stringify(e))):document.getElementById("disableLazyLoadCheckbox").checked=e,e&&stopVideo()}function onClickExternalStreamingCheckbox(e){toggleExternalStreaming(e.checked,!0)}function toggleExternalStreaming(e,t){t?(externalStreaming=e,window.localStorage.setItem("externalStreaming",JSON.stringify(e))):document.getElementById("externalStreamingCheckbox").checked=e,e&&stopVideo()}function setupTextToSpeech(){if("undefined"==typeof speechSynthesis)return speechNotInbrowser=!0,void disableTextToSpeech();void 0!==speechSynthesis.onvoiceschanged?speechSynthesis.onvoiceschanged=setupVoices:setTimeout((function(){setupVoices()}),1e3),null===(selectedVoiceIndex=JSON.parse(window.localStorage.getItem("selectedVoiceIndex")))&&(selectedVoiceIndex=0,window.localStorage.setItem("selectedVoiceIndex",JSON.stringify(selectedVoiceIndex))),null===(enableTextToSpeech=JSON.parse(window.localStorage.getItem("enableTextToSpeech")))&&(enableTextToSpeech=!0,window.localStorage.setItem("enableTextToSpeech",JSON.stringify(enableTextToSpeech))),toggleEnableTextToSpeech(enableTextToSpeech,!1),null===(speechPitch=JSON.parse(window.localStorage.getItem("speechPitch")))&&(speechPitch=1,window.localStorage.setItem("speechPitch",JSON.stringify(speechPitch))),toggleSpeechPitchChange(speechPitch,!1),null===(speechRate=JSON.parse(window.localStorage.getItem("speechRate")))&&(speechRate=1,window.localStorage.setItem("speechRate",JSON.stringify(speechRate))),null===(speechVolume=JSON.parse(window.localStorage.getItem("speechVolume")))&&(speechVolume=.5,window.localStorage.setItem("speechVolume",JSON.stringify(speechVolume))),toggleSpeechVolumeChange(speechVolume,!1)}function setupVoices(){systemVoices=speechSynthesis.getVoices();for(var e=document.getElementById("voiceSelect"),t=0;t<systemVoices.length;t++){var n=document.createElement("option");n.textContent=systemVoices[t].name+" ("+systemVoices[t].lang+")",n.value=t,systemVoices[t].default&&(n.textContent+=" — DEFAULT"),n.setAttribute("data-lang",systemVoices[t].lang),n.setAttribute("data-name",systemVoices[t].name),e.appendChild(n)}e.value=selectedVoiceIndex}function onVoiceSelect(e){selectedVoiceIndex=e,window.localStorage.setItem("selectedVoiceIndex",JSON.stringify(selectedVoiceIndex)),onTextToSpeech("Hello I am "+systemVoices[selectedVoiceIndex].name)}function onTextToSpeech(e){if(e&&enableTextToSpeech&&"undefined"!=typeof speechSynthesis&&systemVoices&&systemVoices.length>0){var t=new SpeechSynthesisUtterance;t.voice=systemVoices[selectedVoiceIndex],t.volume=speechVolume,t.rate=speechRate,t.pitch=speechPitch,t.text=e,window.speechSynthesis.speak(t)}}function onEnableTextToSpeechClick(e){toggleEnableTextToSpeech(e.checked,!0)}function toggleEnableTextToSpeech(e,t){t?(enableTextToSpeech=e,window.localStorage.setItem("enableTextToSpeech",JSON.stringify(e)),e&&onTextToSpeech("Voice enabled")):document.getElementById("enableTextToSpeech").checked=e,document.getElementsByName("voiceFormElement").forEach((t=>{t.style.display=e?"grid":"none"}))}function onSpeechPitchChange(e){toggleSpeechPitchChange(e,!0)}function toggleSpeechPitchChange(e,t){t?(speechPitch=e,window.localStorage.setItem("speechPitch",JSON.stringify(e)),onTextToSpeech("Pitch changed to "+e)):document.getElementById("speechPitch").value=e}function onSpeechRateChange(e){toggleSpeechRateChange(e,!0)}function toggleSpeechRateChange(e,t){t?(speechRate=e,window.localStorage.setItem("speechRate",JSON.stringify(e)),onTextToSpeech("Rate changed to "+e)):document.getElementById("speechRate").value=e}function onSpeechVolumeChange(e){toggleSpeechVolumeChange(e,!0)}function toggleSpeechVolumeChange(e,t){t?(speechVolume=e,window.localStorage.setItem("speechVolume",JSON.stringify(e)),onTextToSpeech("Volume changed to "+e)):document.getElementById("speechVolume").value=e}function disableTextToSpeech(e){var t=document.getElementById("textToSpeechUnavailable");t.hidden=!1,e&&(t.innerText=e);var n=document.getElementById("enableTextToSpeech");n.title="Text to speech is not available in your browser.",n.enabled=!1,n.checked=!1,toggleEnableTextToSpeech(!1,!0)}function toggleShufflePlay(){mediaListDisplayed.length&&((shufflePlayMode=!shufflePlayMode)?(document.getElementById("shuffleButton").classList.add("icon-button-down"),showVideo(),playVideo(getNextShuffleMediaItem())):(shufflePlayModePlayedIndexed={},document.getElementById("shuffleButton").classList.remove("icon-button-down")))}function getNextShuffleMediaItem(){var e=getCurrentDisplayedMediaNodes();if(e&&e.length){var t,n;Object.keys(shufflePlayModePlayedIndexed).length===e.length&&(shufflePlayModePlayedIndexed={});do{n=e[t=Math.floor(Math.random()*(e.length-1))].id}while(shufflePlayModePlayedIndexed[n]);return document.getElementById(n).scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}),shufflePlayModePlayedIndexed[n]=!0,e[t]}}function playVideo(e){if(playingmediaItem){if(playingmediaItem.id===e.id)return;clearPlayingMediaItem()}const t=mediaListGlobal.findIndex((t=>t.id==e.id));if(-1==t)return void showAlertWindow("Error","Unknown media Item. If this is an item outside the slected media libraries, try refreshing the page. If that doesnt work. Im sorry.");const n=mediaListGlobal[t];if(n.type!=MediaType.ExternalType){if(setPlayingMediaItem(n),sendMediaState(),e.subtitle){if(!externalStreaming)if(e.subtitle.endsWith("vtt")){const t=videoNode.querySelectorAll("track");let n;t.length?n=t[0]:(n=document.createElement("track"),n.default=!0,videoNode.appendChild(n)),n.src="/media"+e.subtitleRelative}else for(var a=videoNode.querySelectorAll("track"),o=0;o<a.length;o++)a[o].src=void 0}else for(a=videoNode.querySelectorAll("track"),o=0;o<a.length;o++)a[o].src=void 0;if(externalStreaming){var i="/media"+e.relativePath;window.open(i)}else isVideoShown()||showVideo(),dataLoading(),resetPlayRate(),setupVideoSource("/media"+e.relativePath),videoNode.setAttribute("title",e.name),videoMediaName.innerText=e.name,videoNode.setAttribute("poster","/thumb/"+e.relativeThumb),videoNode.load()}else showAlertWindow("Error","Cannot play external media items from this interface.<br>You can only modify media metadata.<br>Start the media item from the original location.")}function stopVideoClick(){stopVideo()}function stopVideo(){hideVideo(),videoNode.pause(),removeVideoSource(),videoNode.removeAttribute("title"),videoNode.removeAttribute("poster"),videoMediaName.innerText="",videoNode.load(),playingmediaItem&&(playingmediaItem.playing=!1,playingmediaItem.stopped=!0,sendMediaState(),clearPlayingMediaItem())}function skipVideoTo(e){videoNode&&playingmediaItem&&(videoNode.currentTime=e)}function onSkipToMoneyShotClick(){onSkipToMoneyShot()}function onSkipToMoneyShot(){if(playingmediaItem){var e=playingmediaItem.metaData.moneyShotSecs;e<1&&(e=videoNode.duration-.1*videoNode.duration),skipVideoTo(e)}}function onToggleFilterInput(e){filterInput.classList.toggle("hidden"),e.classList.toggle("icon-button-down")}function onToggleTagInput(e){document.getElementById("tagFilterOptions").classList.toggle("hidden"),e.classList.toggle("icon-button-down")}function setupAlternateScripts(e){var t=e.metaData.scripts;if(t&&t.length){var n=document.getElementById("alternate-scripts-button");n.disabled=!0;var a=document.getElementById("altScriptsGroup");removeAllChildNodes(a),selectedMediaItemAltScriptCount=0,t.forEach((e=>{if(e.containerType!=ScriptContainerType.MFS&&e.containerType!=ScriptContainerType.ZIP||e.type!=ScriptType.MAIN){e.type!=ScriptType.MAIN&&selectedMediaItemAltScriptCount++;var t=document.createElement("div"),n=document.createElement("label"),o=document.createElement("input");o.type="radio",o.name="altScriptsGroup",o.value=e,n.textContent=getScriptInfoName(e),o.id=getScriptInfoID(e),n.setAttribute("for",o.id),(!selectedMediaItemAltScript&&"Default"==e.name||selectedMediaItemAltScript&&selectedMediaItemAltScript.name==e.name)&&(o.checked=!0),o.onclick=function(e){sendSwapScript(e),selectedMediaItemAltScript="Default"==e.name?null:e}.bind(this,e),t.appendChild(o),t.appendChild(n),a.appendChild(t)}})),n.disabled=selectedMediaItemAltScriptCount<=0,n.innerText=selectedMediaItemAltScriptCount,n.style.color=selectedMediaItemAltScriptCount<=0?"grey":"green"}else userError("No scripts found in metadata. Try updating the metadata for the media item.")}function getScriptInfoName(e){return e.name+(e.containerTypeName.length?" "+e.containerTypeName:"")}function getScriptInfoID(e){return getScriptInfoName(e).replace(/^[0-9]+[\w\-\:\.]*$/,"")}function setPlayingMediaItem(e){setupAlternateScripts(playingmediaItem=e),(playingmediaItemNode=document.getElementById(e.id)).classList.add("media-item-playing")}function clearPlayingMediaItem(){playingmediaItemNode.classList.remove("media-item-playing"),playingmediaItem=null,playingmediaItemNode=null}function playNextVideoClick(){playNextVideo()}function playNextVideo(){if(0!=mediaListDisplayed.length)if(shufflePlayMode)playVideo(getNextShuffleMediaItem());else{var e=getCurrentDisplayedMediaNodes();if(!e||!e.length)return;if(playingmediaItem){var t=e.findIndex((e=>e.id===playingmediaItem.id));t++}else t=0;t<e.length?playVideo(e[t]):playVideo(e[0])}}function playPreviousVideoClick(){playPreviousVideo()}function playPreviousVideo(){if(0!=mediaListDisplayed.length){var e=getCurrentDisplayedMediaNodes();if(e&&e.length){if(playingmediaItem){var t=e.findIndex((e=>e.id===playingmediaItem.id));t--}else t=-1;playVideo(t<0?e[e.length-1]:e[t])}}}function setThumbSize(e,t){t?(window.localStorage.setItem("thumbSize",parseInt(e,10)),thumbSizeGlobal=parseInt(e,10)):e&&(document.getElementById(e.toString()).checked=!0)}function sendMediaState(){selectedInputDevice==DeviceType.XTPWeb&&postMediaState(playingmediaItem?{path:playingmediaItem.path,playing:playingmediaItem.playing,currentTime:videoNode.currentTime,duration:videoNode.duration,playbackSpeed:videoNode.speed}:{path:void 0,playing:!1,currentTime:0,duration:0,playbackSpeed:1})}function onFunscriptWorkerThreadRecieveMessage(e){var t;switch(isMediaFunscriptPlaying=!0,(t="string"==typeof e.data?JSON.parse(e.data):e.data).command){case"sendTcode":sendTcode(t.tcode);break;case"getMediaState":sendMediaState();break;case"end":funscriptSyncWorker.terminate(),funscriptSyncWorker=null;break}}function openSettings(){getServerSessions(),settingsNode.style.visibility="visible",settingsNode.style.opacity=1,document.getElementById("settingsTabs").style.display="block",speechNotInbrowser||systemVoices&&0!==systemVoices.length||disableTextToSpeech("No voices found")}function closeSettings(){settingsNode.style.visibility="hidden",settingsNode.style.opacity=0,document.getElementById("settingsTabs").style.display="none"}function openMetaDataModal(e){if(!e){if(!playingmediaItem)return;e=playingmediaItem}selectedMediaItemMetaData=e.metaData,document.getElementById("mediaOffset").value=selectedMediaItemMetaData.offset,document.getElementById("moneyShotMillis").value=selectedMediaItemMetaData.moneyShotMillis,document.getElementById("funscriptModifier").value=selectedMediaItemMetaData.funscriptModifier;document.getElementsByName("MetadataTagCheckbox").forEach((e=>{e.checked=selectedMediaItemMetaData.tags.findIndex((t=>t==e.value))>-1})),mediaItemSettingsModalNode.style.visibility="visible",mediaItemSettingsModalNode.style.opacity=1}function closeMetaDataModal(){mediaItemSettingsModalNode.style.visibility="hidden",mediaItemSettingsModalNode.style.opacity=0,document.getElementById("saveMediaItemMetaDataButton").disabled=!0}function openAlternateScriptsModal(e){if(!e){if(!playingmediaItem)return;e=playingmediaItem}var t=document.getElementById("alternateScriptsModal");t.style.visibility="visible",t.style.opacity=1}function closeAlternateScriptsModal(){var e=document.getElementById("alternateScriptsModal");e.style.visibility="hidden",e.style.opacity=0}function saveMetaData(){selectedMediaItemMetaData.offset=parseInt(document.getElementById("mediaOffset").value),selectedMediaItemMetaData.moneyShotMillis=parseInt(document.getElementById("moneyShotMillis").value),selectedMediaItemMetaData.funscriptModifier=parseInt(document.getElementById("funscriptModifier").value),postMediaItemMetaData(selectedMediaItemMetaData)}function metaDataChange(){document.getElementById("saveMediaItemMetaDataButton").disabled=!1}function addToSelectedMetaDataOffset(e){var t=document.getElementById("mediaOffset"),n=parseInt(t.value);n+=e,t.value=n,metaDataChange()}function addToSelectedMetaDataModifier(e){var t=document.getElementById("funscriptModifier"),n=parseInt(t.value);n+=e,t.value=n,metaDataChange()}function resetMoneyShot(){document.getElementById("moneyShotMillis").value=-1,metaDataChange()}var debouncer,onMetadataTagCheckboxClicked=function(e){return function(){let t=!1;if(e&&selectedMediaItemMetaData){const n=selectedMediaItemMetaData.tags.findIndex((t=>t==e.value));e.checked&&-1==n?(selectedMediaItemMetaData.tags.push(e.value),t=!0):!e.checked&&n>-1&&(selectedMediaItemMetaData.tags.splice(n,1),t=!0)}t&&metaDataChange()}};function tabClick(e,t){for(var n=document.getElementsByClassName("tab-section-tab"),a=0;a<n.length;a++){if(a!=t)n[a].style.backgroundColor="#5E6B7F"}var o=document.getElementsByClassName("tab-content");for(a=0;a<o.length;a++)if(a!=t){var i=o[a];i.style.display="none",i.style.opacity="0"}o[t].style.display="block",o[t].style.opacity="1",e.style.backgroundColor="#8DA1BF"}function getCurrentDisplayedMediaNodes(){var e=Array.from(document.querySelectorAll(".media-item:not([hidden])")).map((e=>e.id));return mediaListDisplayed.filter((t=>e.includes(t.id)))}function showChange(e){showGlobal=e||"All",window.localStorage.setItem("show",JSON.stringify(e)),loadMedia(mediaListDisplayed=getDisplayedMediaList(e,!0)),filter()}function sortChange(e){sort(e,!0),loadMedia(mediaListDisplayed=getDisplayedMediaList(showGlobal,!1)),filter()}function thumbSizeChange(e){setThumbSize(e,!0),loadMedia(mediaListDisplayed),filter()}async function setupSliders(){var e=remoteUserSettings.availableChannelsArray,t=document.getElementById("tcodeRanges");if(e&&0!=e.length){removeAllChildNodes(t);for(var n=0;n<e.length;n++){var a=e[n],o=document.createElement("div");o.classList.add("formElement");var i=document.createElement("label");i.classList.add("range-label"),i.innerText=a.friendlyName,i.for=a.channel,o.appendChild(i);var s=document.createElement("section");s.classList.add("range-slider"),s.id=a.channel,o.appendChild(s);var r=document.createElement("span");r.classList.add("range-values");var d=document.createElement("input");d.type="range",d.min=a.min,d.max=a.max-1,d.value=a.userMin;var l=document.createElement("input");l.type="range",l.min=a.min+1,l.max=a.max,l.value=a.userMax,userAgentIsDeo?(o.style.height="50px",i.style.height="50px"):(d.classList.add("range-input"),l.classList.add("range-input")),d.oninput=function(e,t,n,a){var o=parseInt(e.value),i=parseInt(t.value),s=Math.round((i+o)/2);n.innerText=o+" - "+s+" - "+i,i<o&&(t.value=o+1,remoteUserSettings.availableChannels[a.channel].userMax=t.value),remoteUserSettings.availableChannels[a.channel].userMin=o,remoteUserSettings.availableChannels[a.channel].userMid=s,sendTCode(a.channel+e.value.toString().padStart(4,"0")+"S2000");var r=debounceTracker[a.channel+"min"];r&&clearTimeout(r),debounceTracker[a.channel+"min"]=setTimeout((function(){sendTCodeRange(a.channel,parseInt(e.value),parseInt(t.value)),debounceTracker[a.channel+"min"]=void 0}),1e3)}.bind(d,d,l,r,a),l.oninput=function(e,t,n,a){var o=parseInt(e.value),i=parseInt(t.value),s=Math.round((i+o)/2);n.innerText=o+" - "+s+" - "+i,o>i&&(e.value=i-1,remoteUserSettings.availableChannels[a.channel].userMin=e.value),remoteUserSettings.availableChannels[a.channel].userMax=i,remoteUserSettings.availableChannels[a.channel].userMid=s,sendTCode(a.channel+t.value.toString().padStart(4,"0")+"S2000");var r=debounceTracker[a.channel+"max"];r&&clearTimeout(r),debounceTracker[a.channel+"max"]=setTimeout((function(){sendTCodeRange(a.channel,parseInt(e.value),parseInt(t.value)),debounceTracker[a.channel+"max"]=void 0}),1e3)}.bind(l,d,l,r,a);var c=document.createElement("button");c.classList.add("min-max-button"),c.innerText="+",c.onclick=function(e,t){const n=parseInt(e.value),a=parseInt(t.value),o=n+rangeChangeAmount;e.value=o<=a?o:a-rangeChangeAmount,e.dispatchEvent(new Event("input",{bubbles:!0}))}.bind(d,d,l,a);var u=document.createElement("button");u.classList.add("min-max-button"),u.innerText="-",u.onclick=function(e,t){const n=parseInt(e.value)-rangeChangeAmount;e.value=n>=remoteUserSettings.availableChannels[t.channel].min?n:remoteUserSettings.availableChannels[t.channel].min,e.dispatchEvent(new Event("input",{bubbles:!0}))}.bind(d,d,a);var m=document.createElement("button");m.classList.add("min-max-button"),m.innerText="+",m.onclick=function(e,t){const n=parseInt(e.value)+rangeChangeAmount;e.value=n<=remoteUserSettings.availableChannels[t.channel].max?n:remoteUserSettings.availableChannels[t.channel].max,e.dispatchEvent(new Event("input",{bubbles:!0}))}.bind(l,l,a);var p=document.createElement("button");p.classList.add("min-max-button"),p.innerText="-",p.onclick=function(e,t){const n=parseInt(e.value),a=parseInt(t.value)-rangeChangeAmount;t.value=a>=n?a:n+rangeChangeAmount,t.dispatchEvent(new Event("input",{bubbles:!0}))}.bind(d,d,l,a);var g=document.createElement("span");g.classList.add("min-max-buttons");var h=document.createElement("span");h.appendChild(u),h.appendChild(c);var y=document.createElement("span");y.appendChild(p),y.appendChild(m),g.appendChild(h),g.appendChild(r),g.appendChild(y),s.appendChild(g),s.appendChild(d),s.appendChild(l);var v=parseInt(d.value),b=parseInt(l.value),f=Math.round((b+v)/2);r.innerText=v+" - "+f+" - "+b,t.appendChild(o)}}}async function setupMotionModifiers(){var e=document.getElementById("tabFunscriptRandomMotion");removeAllChildNodes(e),(o=document.createElement("div")).classList.add("formElement");var t=document.createElement("div");t.classList.add("tab-content-header-eyebrow"),t.innerText="Add random motion to other channels",e.appendChild(t),(i=document.createElement("label")).innerText="Enabled",i.for="multiplierEnabled",(s=document.createElement("section")).classList.add("form-group-section"),s.id="multiplierEnabled",(l=document.createElement("input")).id="multiplierEnabled",l.type="checkbox",l.checked=remoteUserSettings.multiplierEnabled,l.oninput=function(e){remoteUserSettings.multiplierEnabled=e.target.checked,toggleMotionModifierState(e.target.checked),markXTPFormDirty()}.bind(l),s.appendChild(l);["Link to script","Speed"].forEach((e=>{var t=document.createElement("div");t.classList.add("form-group-control"),t.classList.add("form-group-control-header");var n=document.createElement("span");n.innerText=e,t.appendChild(n),s.appendChild(t)})),o.appendChild(i),o.appendChild(s),e.appendChild(o);for(var n=remoteUserSettings.availableChannelsArray,a=0;a<n.length;a++){var o,i,s,r=n[a],d=r.channel;(o=document.createElement("div")).classList.add("formElement"),(i=document.createElement("label")).innerText=r.friendlyName,i.for=d,o.appendChild(i),(s=document.createElement("section")).setAttribute("name","motionModifierSection"),s.classList.add("form-group-section"),s.id=d;var l,c=document.createElement("div");c.classList.add("form-group-control"),(l=document.createElement("input")).setAttribute("name","motionModifierInput"),l.type="checkbox",l.checked=r.multiplierEnabled,l.oninput=function(e,t){remoteUserSettings.availableChannels[e].multiplierEnabled=t.target.checked,markXTPFormDirty()}.bind(l,d),c.appendChild(l);var u=document.createElement("div");u.classList.add("form-group-control");var m=document.createElement("input");m.setAttribute("name","motionModifierInput"),m.type="checkbox",m.checked=r.linkToRelatedMFS,m.oninput=function(e,t){remoteUserSettings.availableChannels[e].linkToRelatedMFS=t.target.checked,markXTPFormDirty()}.bind(m,d);var p=document.createElement("select");p.setAttribute("name","motionModifierInput"),n.forEach((e=>{if(e.channel!==r.channel){var t=document.createElement("option");t.innerHTML=e.friendlyName,t.value=e.channel,p.appendChild(t)}})),p.value=r.relatedChannel,p.oninput=function(e,t){remoteUserSettings.availableChannels[e].relatedChannel=t.target.value,markXTPFormDirty()}.bind(p,d),u.appendChild(m),u.appendChild(p);var g=document.createElement("div");g.classList.add("form-group-control");var h=document.createElement("input");h.setAttribute("name","motionModifierInput"),h.type="checkbox",h.checked=r.damperEnabled,h.oninput=function(e,t){remoteUserSettings.availableChannels[e].damperEnabled=t.target.checked,markXTPFormDirty()}.bind(h,d);var y=document.createElement("input");y.setAttribute("name","motionModifierInput"),y.value=r.damperValue,y.oninput=function(e,t){var n=parseFloat(t.target.value);n&&(remoteUserSettings.availableChannels[e].damperValue=n,markXTPFormDirty())}.bind(y,d),g.appendChild(h),g.appendChild(y),s.appendChild(c),s.appendChild(u),s.appendChild(g),o.appendChild(s),e.appendChild(o)}toggleMotionModifierState(remoteUserSettings.multiplierEnabled),setUpInversionMotionModifier()}function toggleMotionModifierState(e){document.getElementsByName("motionModifierInput").forEach((t=>{t.disabled=!e}))}async function setUpInversionMotionModifier(){var e=document.getElementById("tabFunscriptInversion");removeAllChildNodes(e),(o=document.createElement("div")).classList.add("formElement");var t=document.createElement("div");t.classList.add("tab-content-header-eyebrow"),t.innerText="Invert motion of channels",e.appendChild(t);for(var n=remoteUserSettings.availableChannelsArray,a=0;a<n.length;a++){var o,i=n[a],s=i.channel;(o=document.createElement("div")).classList.add("formElement"),o.classList.add("formElement--inverted");var r=document.createElement("label");r.innerText=i.friendlyName,r.for=i.channel+"Inverted",o.appendChild(r);var d=document.createElement("section");d.setAttribute("name","motionModifierInvertedSection"),d.classList.add("form-group-section"),d.id=i.channel+"Inverted";var l=document.createElement("div");l.classList.add("form-group-control");var c=document.createElement("input");c.setAttribute("name","motionModifierInputInverted"),c.type="checkbox",c.checked=i.funscriptInverted,c.oninput=function(e,t){remoteUserSettings.availableChannels[e].funscriptInverted=t.target.checked,markXTPFormDirty()}.bind(c,s),l.appendChild(c),d.appendChild(l),o.appendChild(d),e.appendChild(o)}}function markXTPFormDirty(){xtpFormDirty=!0,document.getElementById("saveToXTPButton").disabled=!1}function markXTPFormClean(){xtpFormDirty=!1,document.getElementById("saveToXTPButton").disabled=!0}function setupConnectionsTab(){switch(selectedInputDevice=remoteUserSettings.connection.input.selectedDevice,selectedSyncConnectionGlobal&&selectedSyncConnectionGlobal!=selectedInputDevice&&(sendInputDeviceConnectionChange(selectedSyncConnectionGlobal,!0),selectedInputDevice=selectedSyncConnectionGlobal),selectedInputDevice){case DeviceType.Deo:document.getElementById("connectionDeoVR").checked=!0;break;case DeviceType.Whirligig:document.getElementById("connectionWhirligig").checked=!0;break;case DeviceType.XTPWeb:document.getElementById("connectionXTPWeb").checked=!0;break;case DeviceType.None:document.getElementById("connectionInputNone").checked=!0;break}switch(document.getElementById("deoVRAddress").value=remoteUserSettings.connection.input.deoAddress,document.getElementById("deoVRPort").value=remoteUserSettings.connection.input.deoPort,document.getElementById("connectionGamepad").checked=remoteUserSettings.connection.input.gamePadEnabled,selectedOutputDevice=remoteUserSettings.connection.output.selectedDevice,selectedOutputConnectionGlobal&&selectedOutputConnectionGlobal!=selectedOutputDevice&&(sendOutputDeviceConnectionChange(selectedOutputConnectionGlobal,!0),selectedOutputDevice=selectedOutputConnectionGlobal),selectedOutputDevice){case DeviceType.None:document.getElementById("connectionOutputNone").checked=!0;break;case DeviceType.Network:document.getElementById("connectionNetwork").checked=!0;break;case DeviceType.Serial:document.getElementById("connectionSerial").checked=!0;break}document.getElementById("networkAddress").value=remoteUserSettings.connection.output.networkAddress,document.getElementById("networkPort").value=remoteUserSettings.connection.output.networkPort,document.getElementById("serialPort").value=remoteUserSettings.connection.output.serialPort}function webSocketAddressChange(e){debouncer&&clearTimeout(debouncer),debouncer=setTimeout((function(){debouncer=null,deviceAddress=document.getElementById("webSocketAddress").value,window.localStorage.setItem("webSocketAddress",value)}),500)}function defaultLocalSettings(){showAlertWindow("Confirm","Are you sure you want to reset ALL local settings to default? Note: This only resets the settings in this browser. Your settings stored in XTP will remain.",(function(){window.localStorage.clear(),window.close(),closeAlertWindow()}))}function deleteLocalSettings(){showAlertWindow("Confirm","Are you sure you want to delete ALL settings from localStorage and close the window?",(function(){window.localStorage.clear(),window.location.reload(),closeAlertWindow()}))}function onDeoVRAddressChange(e){e.value&&0!==e.value.trim().length?(remoteUserSettings.connection.input.deoAddress=e.value.trim(),markXTPFormDirty()):userError("Invalid Deo/Heresphere network address")}function onDeoVRPortChange(e){e.value&&0!==e.value.trim().length?(remoteUserSettings.connection.input.deoPort=e.value.trim(),markXTPFormDirty()):userError("Invalid Deo/Heresphere network port")}function onNetworkAddressChange(e){e.value&&0!==e.value.trim().length?(remoteUserSettings.connection.output.networkAddress=e.value.trim(),markXTPFormDirty()):userError("Invalid network address")}function onNetworkPortChange(e){e.value&&0!==e.value.trim().length?(remoteUserSettings.connection.output.networkPort=e.value.trim(),markXTPFormDirty()):userError("Invalid network port")}function onSerialPortChange(e){remoteUserSettings.connection.output.serialPort=e.value,markXTPFormDirty()}function keyboardShortcuts(e){if(!filterDebounce){const{key:t}=e;switch(t){case"k":togglePlay(),animatePlayback(),videoNode.paused?showControls():hideControls();break;case"m":toggleMute();break;case"f":toggleFullScreen();break;case"p":togglePip();break;case"ArrowRight":playNextVideo();break;case"ArrowLeft":playPreviousVideo();break;case"+":volumeUp();break;case"-":volumeDown();break;case"a":sendSkipToNextAction();break;case"c":onSkipToMoneyShot();break;case"x":stopVideoClick();break}}}