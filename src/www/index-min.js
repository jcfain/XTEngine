var wsUri,saveStateNode,userAgent,remoteUserSettings,playingmediaItem,playingmediaItemNode,thumbsContainerNode,settingsNode,selectedSyncConnectionGlobal,videoNode,videoSourceNode,externalStreaming,resizeObserver,webSocket,deviceAddress,selectedInputDevice,deviceConnectionStatusInterval,deviceConnectionStatusRetryButtonNodes,deviceConnectionStatusRetryButtonImageNodes,serverRetryTimeout,DeviceType={Serial:0,Network:1,Deo:2,Whirligig:3,Gamepad:4,XTPWeb:5,None:6},ConnectionStatus={Connected:0,Disconnected:1,Connecting:2,Error:3},ChannelType={None:0,Range:1,Switch:2,HalfRange:3},AxisDimension={None:0,Heave:1,Surge:2,Sway:3,Pitch:4,Roll:5,Yaw:6},websocket=null,xtpConnected=!1,xtpFormDirty=!1,userAgentIsDeo=!1,userAgentIsHereSphere=!1,mediaListGlobal=[],filteredMedia=[],sortByGlobal="nameAsc",showGlobal="All",thumbSizeGlobal=0,funscriptChannels=[],currentChannelIndex=0,outputConnectionStatus=ConnectionStatus.Disconnected,serverRetryTimeoutTries=0;function loadPage(){getBrowserInformation(),userAgentIsDeo=-1!=userAgent.indexOf("Deo VR"),userAgentIsHereSphere=-1!=userAgent.indexOf("HereSphere"),setDeoStyles(userAgentIsDeo),settingsNode=document.getElementById("settingsModal"),thumbsContainerNode=document.getElementById("thumbsContainer"),sortByGlobal=JSON.parse(window.localStorage.getItem("sortBy")),showGlobal=JSON.parse(window.localStorage.getItem("show")),thumbSizeGlobal=JSON.parse(window.localStorage.getItem("thumbSize")),selectedSyncConnectionGlobal=JSON.parse(window.localStorage.getItem("selectedSyncConnection"));var e=JSON.parse(window.localStorage.getItem("volume"));externalStreaming=JSON.parse(window.localStorage.getItem("externalStreaming")),videoNode=document.getElementById("videoPlayer"),videoSourceNode=document.getElementById("videoSource"),videoNode.addEventListener("timeupdate",onVideoTimeUpdate),videoNode.addEventListener("loadeddata",onVideoLoad),videoNode.addEventListener("play",onVideoPlay),videoNode.addEventListener("playing",onVideoPlaying),videoNode.addEventListener("stalled",onVideoStall),videoNode.addEventListener("waiting",onVideoStall),videoNode.addEventListener("pause",onVideoPause),videoNode.addEventListener("volumechange",onVolumeChange),videoNode.addEventListener("ended",onVideoEnd),videoNode.volume=e||.5,saveStateNode=document.getElementById("saveState"),deviceConnectionStatusRetryButtonNodes=document.getElementsByName("deviceStatusRetryButton"),deviceConnectionStatusRetryButtonImageNodes=document.getElementsByName("connectionStatusIconImage"),toggleExternalStreaming(externalStreaming,!1),getServerSettings()}function debug(e){debugMode}function sendMessageXTP(e,t){var n;websocket&&xtpConnected&&(n=t?{command:e,message:t}:{command:e},websocket.send(JSON.stringify(n)))}function onSyncDeviceConnectionChange(e,t){selectedInputDevice=t,sendSyncDeviceConnectionChange(t,e.checked),window.localStorage.setItem("selectedSyncConnection",parseInt(t,10))}function tcodeDeviceConnectRetry(){sendMessageXTP("connectOutputDevice")}function sendTCode(e){sendMessageXTP("tcode",e)}function sendSyncDeviceConnectionChange(e,t){sendMessageXTP("connectInputDevice",{deviceType:e,enabled:t})}function restartXTP(){confirm("Are you sure you want restart XTP?")&&(sendMessageXTP("restartService"),closeSettings())}function wsCallBackFunction(e){try{var t=JSON.parse(e.data);switch(t.command){case"outputDeviceStatus":(n=t.message).deviceType;setOutputConnectionStatus(n.status,n.message);break;case"inputDeviceStatus":var n;setInputConnectionStatus((n=t.message).deviceType,n.status,n.message);break;case"connectionClosed":xtpConnected=!1,setMediaLoading(),setMediaLoadingStatus("Looks like XTP was shut down.\nWaiting for reconnect...");break;case"mediaLoaded":document.getElementById("mediaLoading").style.display="none",getServerLibrary();break;case"mediaLoading":setMediaLoading();break;case"mediaLoadingStatus":setMediaLoadingStatus(t.message);break;case"updateThumb":var i=t.message,a=document.getElementById(i.id);if(a){var o=a.getElementsByTagName("img")[0];o.src="/thumb/"+i.thumb+"?"+(new Date).getTime(),i.errorMessage&&(o.title=i.errorMessage);var r=mediaListGlobal.findIndex((e=>e.id===i.id));mediaListGlobal[r].relativeThumb="/thumb/"+i.thumb,mediaListGlobal[r].thumbFileExists=!0}break}}catch(e){}}function setMediaLoading(){clearMediaList(),document.getElementById("mediaLoading").style.display="flex",document.getElementById("noMedia").hidden=!0}function setMediaLoadingStatus(e){document.getElementById("loadingStatus").innerText=e}function onResizeVideo(){thumbsContainerNode.style.maxHeight="calc(100vh - "+(+videoNode.offsetHeight+165)+"px)"}function getBrowserInformation(){var e,t,n,i,a,o,r=navigator.userAgent;-1!=(a=r.indexOf("Opera"))?(e="Opera",t=r.substring(a+6),-1!=(a=r.indexOf("Version"))&&(t=r.substring(a+8))):-1!=(a=r.indexOf("MSIE"))?(e="Microsoft Internet Explorer",t=r.substring(a+5)):-1!=(a=r.indexOf("Chrome"))?(e="Chrome",t=r.substring(a+7)):-1!=(a=r.indexOf("Safari"))?(e="Safari",t=r.substring(a+7),-1!=(a=r.indexOf("Version"))&&(t=r.substring(a+8))):-1!=(a=r.indexOf("Firefox"))?(e="Firefox",t=r.substring(a+8)):(i=r.lastIndexOf(" ")+1)<(a=r.lastIndexOf("/"))&&(e=r.substring(i,a),t=r.substring(a+1),e.toLowerCase()==e.toUpperCase()&&(e=navigator.appName)),-1!=(o=t.indexOf(";"))&&(t=t.substring(0,o)),-1!=(o=t.indexOf(" "))&&(t=t.substring(0,o)),n=parseInt(""+t,10),isNaN(n)&&(t=""+parseFloat(navigator.appVersion),n=parseInt(navigator.appVersion,10));var s=document.createElement("div");s.innerHTML="Browser name  = "+e+"<br>Full version  = "+t+"<br>Major version = "+n+"<br>navigator.userAgent = "+navigator.userAgent+"<br>",userAgent=navigator.userAgent,document.getElementById("browserInfoTab").appendChild(s)}function setDeoStyles(e){if(e)for(var t=document.querySelectorAll("input[type='checkbox']"),n=0;n<t.length;n++)t[n].classList.remove("styled-checkbox");else for(t=document.getElementsByClassName("input[type='checkbox']"),n=0;n<t.length;n++)t[n].classList.add("styled-checkbox")}function getServerSettings(){var e=new XMLHttpRequest;e.open("GET","/settings",!0),e.responseType="json",e.onload=function(){200===e.status?(remoteUserSettings=e.response,funscriptChannels=Object.keys(remoteUserSettings.availableAxis).map((function(e){return remoteUserSettings.availableAxis[e].channel})),remoteUserSettings.availableAxisArray=Object.keys(remoteUserSettings.availableAxis).map((function(e){return remoteUserSettings.availableAxis[e]})),funscriptChannels.sort(),initWebSocket()):alert("Error getting settings")},e.send()}function initWebSocket(){try{wsUri="ws://"+window.location.hostname+":"+remoteUserSettings.webSocketServerPort,"function"==typeof MozWebSocket&&(WebSocket=MozWebSocket),websocket&&1==websocket.readyState&&websocket.close(),(websocket=new WebSocket(wsUri)).onopen=function(e){xtpConnected=!0,serverRetryTimeout&&clearTimeout(serverRetryTimeout),debug("CONNECTED"),updateSettingsUI()},websocket.onmessage=function(e){wsCallBackFunction(e),debug("MESSAGE RECIEVED: "+e.data)},websocket.onclose=function(e){debug("DISCONNECTED"),xtpConnected=!1,startServerConnectionRetry()},websocket.onerror=function(e){xtpConnected=!1,startServerConnectionRetry()}}catch(e){xtpConnected=!1,startServerConnectionRetry()}}function startServerConnectionRetry(){++serverRetryTimeoutTries<100?serverRetryTimeout=setTimeout((()=>{initWebSocket()}),5e3):setMediaLoadingStatus("Timed out while looking for server. Please refresh the page when the server started again.")}function updateSettingsUI(){setupSliders(),setupMotionModifiers(),setupConnectionsTab(),document.getElementById("tabLocalTab").onclick()}function getServerLibrary(){var e=new XMLHttpRequest;e.open("GET","/media",!0),e.responseType="json",e.onload=function(){200===e.status?(mediaListGlobal=e.response,updateMediaUI()):alert("Error getting media list: "+err)},e.onerror=function(){alert("Error getting media")},e.send()}function setInputConnectionStatus(e,t,n){var i="",a="";switch(t){case ConnectionStatus.Connected:i="://images/icons/check-mark-black.png",a="chartreuse";break;case ConnectionStatus.Connecting:i="://images/icons/reload.svg",a="yellow";break;case ConnectionStatus.Disconnected:i="://images/icons/x.svg",a="crimson";break;case ConnectionStatus.Error:i="://images/icons/error-black.png",a="red";break}var o=document.getElementById("deoVRStatus"),r=document.getElementById("whirligigStatus"),s=document.getElementById("xtpWebStatus"),d=document.getElementById("gamepadStatus");switch(e!=DeviceType.Gamepad&&(o.src="://images/icons/x.svg",o.style.backgroundColor="crimson",o.title="Disconnected",r.src="://images/icons/x.svg",r.style.backgroundColor="crimson",r.title="Disconnected",s.src="://images/icons/x.svg",s.style.backgroundColor="crimson",s.title="Disconnected"),e){case DeviceType.Deo:o.src=i,o.style.backgroundColor=a,o.title=n;break;case DeviceType.Whirligig:r.src=i,r.style.backgroundColor=a,r.title=n;break;case DeviceType.XTPWeb:s.src=i,s.style.backgroundColor=a,s.title=n;break;case DeviceType.Gamepad:d.src=i,d.style.backgroundColor=a,d.title=n;break}}function setOutputConnectionStatus(e,t){for(var n=0;n<deviceConnectionStatusRetryButtonNodes.length;n++){var i=deviceConnectionStatusRetryButtonNodes[n],a=deviceConnectionStatusRetryButtonImageNodes[n];i.title="TCode status: "+t,i.style.cursor="",i.disabled=!0;var o=document.getElementById("tcodeDeviceSettingsLink");switch(o.hidden=!0,outputConnectionStatus=e,e){case ConnectionStatus.Disconnected:i.style.backgroundColor="crimson",i.style.cursor="pointer",i.disabled=!1,a.src="://images/icons/x.svg",i.title+=": Check your devices connection and click this to retry";break;case ConnectionStatus.Connecting:i.style.backgroundColor="yellow",a.src="://images/icons/reload.svg";break;case ConnectionStatus.Connected:outputDeviceConnected=!0,i.style.backgroundColor="chartreuse",a.src="://images/icons/check-mark-black.png",remoteUserSettings.connection.output.selectedDevice==DeviceType.Network&&(o.href="http://"+remoteUserSettings.connection.networkAddress,o.hidden=!1);break;case ConnectionStatus.Error:i.style.backgroundColor="red",i.style.cursor="pointer",i.disabled=!1,a.src="://images/icons/error-black.png",i.title+=": Check your devices connection and click this to retry";break}}}function getMediaFunscripts(e,t){var n=funscriptChannels[currentChannelIndex],i=remoteUserSettings.availableAxis[n].trackName,a=new XMLHttpRequest,o=""===i?i:"."+i;a.open("GET",e+o+".funscript",!0),a.responseType="json",a.onload=function(){if(200===a.status){loadedFunscripts.push({channel:n,atList:[]});for(var i=loadedFunscripts.length-1,o=a.response,r=0;r<o.actions.length;r++){var s=o.actions[r],d=s.at;loadedFunscripts[i][d]=s.pos,loadedFunscripts[i].atList.push(d)}}++currentChannelIndex<funscriptChannels.length?getMediaFunscripts(e,t):(currentChannelIndex=0,videoNode.play())},a.send()}function postServerSettings(){var e=new XMLHttpRequest;e.open("POST","/settings",!0),e.setRequestHeader("Content-Type","application/json"),e.onreadystatechange=function(){4===e.readyState&&(200!==e.status?onSaveFail(e.statusText):(onSaveSuccess(),markXTPFormClean()))},e.onerror=function(){onSaveFail(e.statusText)},e.send(JSON.stringify(remoteUserSettings))}function postMediaState(e){var t=new XMLHttpRequest;t.open("POST","/xtpweb",!0),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify(e)),t.oneload=function(){t.status},t.onerror=function(){}}function onSaveSuccess(){saveStateNode.style.visibility="visible",saveStateNode.style.opacity="1",saveStateNode.style.color="green",saveStateNode.innerText="Save success",setTimeout((()=>{saveStateNode.style.visibility="hidden",saveStateNode.style.opacity="0"}),5e3)}function onSaveFail(e){saveStateNode.style.visibility="visible",saveStateNode.style.opacity="1",saveStateNode.style.color="red",saveStateNode.innerText="Save fail",saveStateNode.title=e}function updateMediaUI(){setThumbSize(thumbSizeGlobal,!1),sort(sortByGlobal,!1),loadMedia(filteredMedia=show(showGlobal,!1))}function clearMediaList(){var e=document.getElementById("mediaList");return removeAllChildNodes(e),e}function loadMedia(e){var t=clearMediaList(),n=document.getElementById("noMedia");if(!e||0==e.length)return n.innerHTML="No media found<br>Current filter: "+showGlobal,void(n.hidden=!1);n.hidden=!0;for(var i=function(e){return function(){playVideo(e)}},a=0,o=0,r=0,s=0,d=0;d<e.length;d++){var l=e[d];thumbSizeGlobal||(setThumbSize(l.thumbSize,!0),setThumbSize(l.thumbSize,!1)),a||(o=thumbSizeGlobal+.15*thumbSizeGlobal+"px",r=thumbSizeGlobal+(a=.25*thumbSizeGlobal)+"px",s=.35*a+"px");var c=document.createElement("div");c.id=l.id,c.className+="media-item",c.style.width=o,c.style.height=r,c.title=l.name;var m=document.createElement("a");m.className+="media-link",l.isMFS&&(c.className+=" media-item-mfs"),l.hasScript||(c.className+=" media-item-noscript"),m.onclick=i(l);var u=document.createElement("img");l.thumbFileExists?u.src="/thumb/"+l.relativeThumb:u.src="/thumb/"+l.thumbFileLoading,u.loading="lazy",u.style.width=thumbSizeGlobal+"px",u.style.height=thumbSizeGlobal-a+"px";var g=document.createElement("div");g.innerText=l.displayName,g.className+="name",g.style.width=o,g.style.height=a+"px",g.style.fontSize=s,c.appendChild(m),m.appendChild(u),m.appendChild(g),t.appendChild(c),playingmediaItem&&playingmediaItem.id===l.id&&setPlayingMediaItem(l)}}function onThumbLoadError(e,t){e.onerror=null,t<3?(e.src="://images/icons/loading.png",e.onerror=onThumbLoadError(e,2)):e.src="://images/icons/error.png"}function removeAllChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function sort(e,t){switch(e||(e="nameAsc"),e){case"dateDesc":mediaListGlobal.sort((function(e,t){return new Date(t.modifiedDate)-new Date(e.modifiedDate)}));break;case"dateAsc":mediaListGlobal.sort((function(e,t){return new Date(e.modifiedDate)-new Date(t.modifiedDate)}));break;case"nameAsc":mediaListGlobal.sort((function(e,t){var n=e.displayName.toUpperCase(),i=t.displayName.toUpperCase();return n<i?-1:n>i?1:void 0}));break;case"nameDesc":mediaListGlobal.sort((function(e,t){var n=e.displayName.toUpperCase(),i=t.displayName.toUpperCase();return i<n?-1:i>n?1:void 0}));break}t?(window.localStorage.setItem("sortBy",JSON.stringify(e)),sortByGlobal=e):e&&document.getElementById(e.toString()).click()}function show(e,t){e||(e="All");var n=[];switch(e){case"All":n=mediaListGlobal;break;case"3DOnly":n=mediaListGlobal.filter((e=>e.isStereoscopic));break;case"2DAndAudioOnly":n=mediaListGlobal.filter((e=>!e.isStereoscopic));break}return t?(window.localStorage.setItem("show",JSON.stringify(e)),showGlobal=e):e&&document.getElementById(e.toString()).click(),n}function onClickExternalStreamingCheckbox(e){toggleExternalStreaming(e.checked,!0)}function toggleExternalStreaming(e,t){t?(externalStreaming=e,window.localStorage.setItem("externalStreaming",JSON.stringify(e))):document.getElementById("externalStreamingCheckbox").checked=e,e?(videoNode.pause(),videoNode.classList.remove("video-shown"),thumbsContainerNode.style.maxHeight="",playingmediaItem&&clearPlayingMediaItem(),resizeObserver&&resizeObserver.unobserve(videoNode)):(onResizeVideo(),(resizeObserver=new ResizeObserver(onResizeVideo)).observe(videoNode))}function playVideo(e){if(externalStreaming)if(userAgentIsHereSphere){var t="/media"+e.relativePath,n=document.createElement("A");n.href=t,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}else window.open("/media"+e.relativePath);else{if(playingmediaItem){if(playingmediaItem.id===e.id)return;clearPlayingMediaItem()}setPlayingMediaItem(e),videoNode.classList.add("video-shown"),videoSourceNode.setAttribute("src","/media"+e.relativePath),videoNode.setAttribute("title",e.name),videoNode.setAttribute("poster","/thumb/"+e.relativeThumb),videoNode.load()}}function setPlayingMediaItem(e){playingmediaItem=e,(playingmediaItemNode=document.getElementById(e.id)).classList.add("media-item-playing")}function clearPlayingMediaItem(){playingmediaItemNode.classList.remove("media-item-playing"),playingmediaItem=null,playingmediaItemNode=null}loadPage(),debugMode=!0;var sendTcodeDebouncer,debouncer,timer1=0,timer2=Date.now();function onVideoTimeUpdate(e){xtpConnected&&selectedInputDevice==DeviceType.XTPWeb&&(timer2-timer1>=1e3&&(timer1=timer2,sendMediaState()),timer2=Date.now())}function onVideoLoad(e){playingmediaItem.loaded=!0}function onVideoPlay(e){playingmediaItem.playing=!0,sendMediaState()}function onVideoPause(e){playingmediaItem.playing=!1,sendMediaState()}function onVideoStall(e){playingmediaItem.playing=!1,sendMediaState()}function onVideoPlaying(e){playingmediaItem.playing=!0,sendMediaState()}function onVolumeChange(){window.localStorage.setItem("volume",videoNode.volume)}function onVideoEnd(e){var t=filteredMedia.findIndex((e=>e.path===playingmediaItem.path));++t<filteredMedia.length?playVideo(filteredMedia[t]):playVideo(filteredMedia[0])}function setThumbSize(e,t){t?(window.localStorage.setItem("thumbSize",parseInt(e,10)),thumbSizeGlobal=parseInt(e,10)):e&&document.getElementById(e.toString()).click()}function sendMediaState(){playingmediaItem&&postMediaState({path:playingmediaItem.path,playing:playingmediaItem.playing,currentTime:videoNode.currentTime,duration:videoNode.duration,playbackSpeed:videoNode.speed})}function onFunscriptWorkerThreadRecieveMessage(e){var t;switch(isMediaFunscriptPlaying=!0,(t="string"==typeof e.data?JSON.parse(e.data):e.data).command){case"sendTcode":sendTcode(t.tcode);break;case"getMediaState":sendMediaState();break;case"end":funscriptSyncWorker.terminate(),funscriptSyncWorker=null;break}}function openSettings(){settingsNode.style.visibility="visible",settingsNode.style.opacity=1,document.getElementById("settingsTabs").style.display="block"}function closeSettings(){settingsNode.style.visibility="hidden",settingsNode.style.opacity=0,document.getElementById("settingsTabs").style.display="none"}function tabClick(e,t){for(var n=document.getElementsByClassName("tab-section-tab"),i=0;i<n.length;i++){if(i!=t)n[i].style.backgroundColor="#5E6B7F"}var a=document.getElementsByClassName("tab-content");for(i=0;i<a.length;i++)if(i!=t){var o=a[i];o.style.display="none",o.style.opacity="0"}a[t].style.display="block",a[t].style.opacity="1",e.style.backgroundColor="#8DA1BF"}function showChange(e){sort(sortByGlobal,!0),loadMedia(filteredMedia=show(e,!0))}function sortChange(e){sort(e,!0),loadMedia(filteredMedia=show(showGlobal,!0))}function thumbSizeChange(e){setThumbSize(e,!0),loadMedia(filteredMedia=show(showGlobal,!0))}async function setupSliders(){for(var e=remoteUserSettings.availableAxisArray,t=document.getElementById("tabTCode"),n=0;n<e.length;n++){var i=e[n],a=document.createElement("div");a.classList.add("formElement");var o=document.createElement("label");o.classList.add("range-label"),o.innerText=i.friendlyName,o.for=i.channel,a.appendChild(o);var r=document.createElement("section");r.classList.add("range-slider"),r.id=i.channel,a.appendChild(r);var s=document.createElement("span");s.classList.add("range-values"),r.appendChild(s);var d=document.createElement("input");d.type="range",d.min=i.min,d.max=i.max-1,d.value=i.userMin;var l=document.createElement("input");l.type="range",l.min=i.min+1,l.max=i.max,l.value=i.userMax,userAgentIsDeo?(a.style.height="50px",o.style.height="50px"):(d.classList.add("range-input"),l.classList.add("range-input")),d.oninput=function(e,t,n,i){var a=parseInt(e.value),o=parseInt(t.value),r=Math.round((o+a)/2);n.innerText=a+" - "+r+" - "+o,o<a&&(t.value=a+1,remoteUserSettings.availableAxis[i.channel].userMax=t.value),remoteUserSettings.availableAxis[i.channel].userMin=a,remoteUserSettings.availableAxis[i.channel].userMid=r,sendTCode(i.channel+e.value.toString().padStart(4,"0")+"S2000"),markXTPFormDirty()}.bind(d,d,l,s,i),l.oninput=function(e,t,n,i){var a=parseInt(e.value),o=parseInt(t.value),r=Math.round((o+a)/2);n.innerText=a+" - "+r+" - "+o,a>o&&(e.value=o-1,remoteUserSettings.availableAxis[i.channel].userMin=e.value),remoteUserSettings.availableAxis[i.channel].userMax=o,remoteUserSettings.availableAxis[i.channel].userMid=r,sendTCode(i.channel+t.value.toString().padStart(4,"0")+"S2000"),markXTPFormDirty()}.bind(l,d,l,s,i),r.appendChild(d),r.appendChild(l);var c=parseInt(d.value),m=parseInt(l.value),u=Math.round((m+c)/2);s.innerText=c+" - "+u+" - "+m,t.appendChild(a)}}async function setupMotionModifiers(){var e=document.getElementById("tabFunscript");(s=document.createElement("div")).classList.add("formElement");var t=document.createElement("div");t.classList.add("tab-content-header");var n=document.createElement("div");n.innerText="Motion modifier",n.classList.add("tab-content-header-main");var i=document.createElement("div");i.classList.add("tab-content-header-eyebrow"),i.innerText="Add random motion to other channels",t.appendChild(n),t.appendChild(i),(d=document.createElement("label")).innerText="Enabled",d.for="multiplierEnabled",(l=document.createElement("section")).classList.add("form-group-section"),l.id="multiplierEnabled",(c=document.createElement("input")).id="multiplierEnabled",c.type="checkbox",c.checked=remoteUserSettings.multiplierEnabled,c.oninput=function(e){remoteUserSettings.multiplierEnabled=e.target.checked,toggleMotionModifierState(e.target.checked),markXTPFormDirty()}.bind(c),l.appendChild(c);["Modifier","Link to MFS","Speed"].forEach((e=>{var t=document.createElement("div");t.classList.add("form-group-control"),t.classList.add("form-group-control-header");var n=document.createElement("span");n.innerText=e,t.appendChild(n),l.appendChild(t)})),s.appendChild(d),s.appendChild(l),e.appendChild(t),e.appendChild(s);for(var a=remoteUserSettings.availableAxisArray,o=0;o<a.length;o++){var r=a[o];if(r.dimension!==AxisDimension.Heave){var s,d,l;(s=document.createElement("div")).classList.add("formElement"),(d=document.createElement("label")).innerText=r.friendlyName,d.for=r.channel,s.appendChild(d),(l=document.createElement("section")).setAttribute("name","motionModifierSection"),l.classList.add("form-group-section"),l.id=r.channel;var c,m=document.createElement("div");m.classList.add("form-group-control"),(c=document.createElement("input")).setAttribute("name","motionModifierInput"),c.type="checkbox",c.checked=r.multiplierEnabled,c.oninput=function(e,t){remoteUserSettings.availableAxisArray[e].multiplierEnabled=t.target.checked,markXTPFormDirty()}.bind(c,o);var u=document.createElement("input");u.setAttribute("name","motionModifierInput"),u.value=r.multiplierValue,u.oninput=function(e,t){var n=parseFloat(t.target.value);n&&(remoteUserSettings.availableAxisArray[e].multiplierValue=n,markXTPFormDirty())}.bind(u,o),m.appendChild(c),m.appendChild(u);var g=document.createElement("div");g.classList.add("form-group-control");var p=document.createElement("input");p.setAttribute("name","motionModifierInput"),p.type="checkbox",p.checked=r.linkToRelatedMFS,p.oninput=function(e,t){remoteUserSettings.availableAxisArray[e].linkToRelatedMFS=t.target.checked,markXTPFormDirty()}.bind(p,o);var v=document.createElement("select");v.setAttribute("name","motionModifierInput"),a.forEach((e=>{if(e.channel!==r.channel){var t=document.createElement("option");t.innerHTML=e.friendlyName,t.value=e.channel,v.appendChild(t)}})),v.value=r.relatedChannel,v.oninput=function(e,t){remoteUserSettings.availableAxisArray[e].relatedChannel=t.target.value,markXTPFormDirty()}.bind(v,o),g.appendChild(p),g.appendChild(v);var b=document.createElement("div");b.classList.add("form-group-control");var y=document.createElement("input");y.setAttribute("name","motionModifierInput"),y.type="checkbox",y.checked=r.damperEnabled,y.oninput=function(e,t){remoteUserSettings.availableAxisArray[e].damperEnabled=t.target.checked,markXTPFormDirty()}.bind(y,o);var h=document.createElement("input");h.setAttribute("name","motionModifierInput"),h.value=r.damperValue,h.oninput=function(e,t){var n=parseFloat(t.target.value);n&&(remoteUserSettings.availableAxisArray[e].damperValue=n,markXTPFormDirty())}.bind(h,o),b.appendChild(y),b.appendChild(h),l.appendChild(m),l.appendChild(g),l.appendChild(b),s.appendChild(l),e.appendChild(s)}}toggleMotionModifierState(remoteUserSettings.multiplierEnabled),setUpInversionMotionModifier()}function toggleMotionModifierState(e){document.getElementsByName("motionModifierInput").forEach((t=>{t.disabled=!e}))}async function setUpInversionMotionModifier(){var e=document.getElementById("tabFunscript");(o=document.createElement("div")).classList.add("formElement");var t=document.createElement("div");t.classList.add("tab-content-header");var n=document.createElement("div");n.classList.add("tab-content-header-eyebrow"),n.innerText="Invert motion of channels",t.appendChild(n),e.appendChild(t);for(var i=remoteUserSettings.availableAxisArray,a=0;a<i.length;a++){var o,r=i[a];(o=document.createElement("div")).classList.add("formElement");var s=document.createElement("label");s.innerText=r.friendlyName,s.for=r.channel+"Inverted",o.appendChild(s);var d=document.createElement("section");d.setAttribute("name","motionModifierInvertedSection"),d.classList.add("form-group-section"),d.id=r.channel+"Inverted";var l=document.createElement("div");l.classList.add("form-group-control");var c=document.createElement("input");c.setAttribute("name","motionModifierInputInverted"),c.type="checkbox",c.checked=r.inverted,c.oninput=function(e,t){remoteUserSettings.availableAxisArray[e].inverted=t.target.checked,markXTPFormDirty()}.bind(c,a),l.appendChild(c),d.appendChild(l),o.appendChild(d),e.appendChild(o)}}function markXTPFormDirty(){xtpFormDirty=!0,document.getElementById("saveToXTPButton").disabled=!1}function markXTPFormClean(){xtpFormDirty=!1,document.getElementById("saveToXTPButton").disabled=!0}function setupConnectionsTab(){switch(selectedInputDevice=remoteUserSettings.connection.input.selectedDevice,selectedSyncConnectionGlobal&&selectedSyncConnectionGlobal!=selectedInputDevice&&(sendSyncDeviceConnectionChange(selectedSyncConnectionGlobal,!0),selectedInputDevice=selectedSyncConnectionGlobal),selectedInputDevice){case DeviceType.Deo:document.getElementById("connectionDeoVR").checked=!0;break;case DeviceType.Whirligig:document.getElementById("connectionWhirligig").checked=!0;break;case DeviceType.XTPWeb:document.getElementById("connectionXTPWeb").checked=!0;break;case DeviceType.None:document.getElementById("connectionNone").checked=!0;break}document.getElementById("deoVRAddress").value=remoteUserSettings.connection.input.deoAddress,document.getElementById("deoVRPort").value=remoteUserSettings.connection.input.deoPort,document.getElementById("connectionGamepad").checked=remoteUserSettings.connection.input.gamePadEnabled}function webSocketAddressChange(e){debouncer&&clearTimeout(debouncer),debouncer=setTimeout((function(){debouncer=null,deviceAddress=document.getElementById("webSocketAddress").value,window.localStorage.setItem("webSocketAddress",value)}),500)}function defaultLocalSettings(){confirm("Are you sure you want to reset ALL local settings to default? Note: This only resets the settings in this browser. Your settings stored in XTP will remain.")&&(window.localStorage.clear(),window.location.reload())}function deleteLocalSettings(){confirm("Are you sure you want to delete ALL settings from localStorage and close the window?")&&(window.localStorage.clear(),window.close())}function onDeoVRAddressChange(e){remoteUserSettings.connection.input.deoAddress=e.value,markXTPFormDirty()}function onDeoVRPortChange(e){remoteUserSettings.connection.input.deoPort=e.value,markXTPFormDirty()}