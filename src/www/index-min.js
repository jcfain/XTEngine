const webVersion="v0.46b";var settingChangeDebounce,wsUri,userAgent,remoteUserSettings,playingmediaItem,playingmediaItemNode,webSocket,deviceAddress,selectedInputDevice,selectedOutputDevice,deviceConnectionStatusInterval,serverRetryTimeout,videoStallTimeout,userFilterCriteria,filterDebounce,DeviceType={Serial:0,Network:1,Deo:2,Whirligig:3,Gamepad:4,XTPWeb:5,None:6},ConnectionStatus={Connected:0,Disconnected:1,Connecting:2,Error:3},ChannelType={None:0,Range:1,Switch:2,HalfRange:3},AxisDimension={None:0,Heave:1,Surge:2,Sway:3,Pitch:4,Roll:5,Yaw:6},MediaType={PlaylistInternal:0,Video:1,Audio:2,FunscriptType:3,VR:4,ExternalType:5},Roles={DisplayRole:0,DecorationRole:1,EditRole:2,ToolTipRole:3,StatusTipRole:4,WhatsThisRole:5,FontRole:6,TextAlignmentRole:7,BackgroundRole:8,ForegroundRole:9},mediaLoading=!1,debounceTracker={},websocket=null,xtpConnected=!1,xtpFormDirty=!1,mediaListGlobal=[],mediaListDisplayed=[],selectedMediaItemMetaData=null,funscriptChannels=[],currentChannelIndex=0,outputConnectionStatus=ConnectionStatus.Disconnected,serverRetryTimeoutTries=0,userTagFilterCriteria=[],enableTextToSpeech=!0,systemVoices=[],speechNotInbrowser=!1,selectedVoiceIndex=0,speechPitch=5,speechRate=5,speechVolume=.5,rangeChangeAmount=100,shufflePlayMode=!1,shufflePlayModePlayedIndexed={};const tagCheckboxesName="TagCheckbox",metadataTagCheckboxesName="MetadataTagCheckbox",parseCookie=str=>str.split(";").map((v=>v.split("="))).reduce(((acc,v)=>(v&&v[0].trim().length&&(acc[decodeURIComponent(v[0].trim())]=decodeURIComponent(v[1].trim())),acc)),{});function delete_cookie(name,path,domain){get_cookie(name)&&(document.cookie=name+"="+(path?";path="+path:"")+(domain?";domain="+domain:"")+";expires=Thu, 01 Jan 1970 00:00:01 GMT")}function get_cookie(name){return document.cookie.split(";").some((c=>c.trim().startsWith(name+"=")))}document.addEventListener("keyup",keyboardShortcuts),document.addEventListener("click",destroyMediaContextNode);var cookies=parseCookie(document.cookie);cookies.sessionID||(document.getElementById("logoutSection").style.display="none",document.getElementById("logoutSectionSpacing").style.display="none",document.getElementById("sessionInfoTable").hidden=!0),getBrowserInformation();var userAgentIsDeo=-1!=userAgent.indexOf("Deo VR"),userAgentIsHereSphere=-1!=userAgent.indexOf("HereSphere"),userAgentIsMobile=-1!=userAgent.indexOf("Mobile");setDeoStyles(userAgentIsDeo);var settingsNode=document.getElementById("settingsModal"),mediaItemSettingsModalNode=document.getElementById("mediaItemSettingsModal"),thumbsContainerNode=document.getElementById("thumbsContainer"),videoMediaName=document.getElementById("videoMediaName");const storedHash=window.localStorage.getItem("storedHash");var sortByGlobal=JSON.parse(window.localStorage.getItem("sortBy")),showGlobal=JSON.parse(window.localStorage.getItem("show"));null==showGlobal&&(window.localStorage.setItem("show",JSON.stringify("All")),showGlobal="All");var thumbSizeGlobal=JSON.parse(window.localStorage.getItem("thumbSize")),selectedSyncConnectionGlobal=JSON.parse(window.localStorage.getItem("selectedSyncConnection")),selectedOutputConnectionGlobal=JSON.parse(window.localStorage.getItem("selectedOutputConnection")),disableLazyLoad=JSON.parse(window.localStorage.getItem("disableLazyLoad"));toggleLazyLoad(disableLazyLoad,!1);var externalStreaming=JSON.parse(window.localStorage.getItem("externalStreaming"));toggleExternalStreaming(externalStreaming,!1);const skipToMoneyShotButton=document.getElementById("money-shot"),skipToNextActionButton=document.getElementById("next-action"),exitVideoButton=document.getElementById("exit-action");skipToMoneyShotButton.addEventListener("click",sendSkipToMoneyShot),skipToMoneyShotButton.addEventListener("click",onSkipToMoneyShotClick),skipToNextActionButton.addEventListener("click",sendSkipToNextActionClick),exitVideoButton.addEventListener("click",stopVideoClick),videoNode.addEventListener("loadeddata",onVideoLoad),videoNode.addEventListener("play",onVideoPlay),videoNode.addEventListener("playing",onVideoPlaying),videoNode.addEventListener("stalled",onVideoStall),videoNode.addEventListener("waiting",onVideoStall),videoNode.addEventListener("pause",onVideoPause),videoNode.addEventListener("volumechange",onVolumeChange),videoNode.addEventListener("ended",onVideoEnd),videoNode.addEventListener("timeupdate",onVideoTimeUpdate);const playNextButton=document.getElementById("play-next");playNextButton.addEventListener("click",playNextVideoClick);const playPreviousButton=document.getElementById("play-previous");playPreviousButton.addEventListener("click",playPreviousVideoClick);const xtpWebVersionNode=document.getElementById("webVersion");xtpWebVersionNode.innerText="v0.46b";var saveStateNode=document.getElementById("saveState"),mediaReloadRequiredNode=document.getElementById("mediaReloadRequired"),metaDataSaveStateNode=document.getElementById("metaDataSaveState"),deviceConnectionStatusRetryButtonNodes=document.getElementsByName("deviceStatusRetryButton"),deviceConnectionStatusRetryButtonImageNodes=document.getElementsByName("connectionStatusIconImage"),progressNode=document.getElementById("statusOutput"),progressLabelNode=document.getElementById("statusOutputLabel");function debug(message){debugMode&&console.log(message)}function error(message){console.error(message)}function sendWebsocketMessage(command,message){var obj;websocket&&xtpConnected&&(obj=message?{command:command,message:message}:{command:command},websocket.send(JSON.stringify(obj)))}function onInputDeviceConnectionChange(input,device){selectedInputDevice=device,sendInputDeviceConnectionChange(device,input.checked),window.localStorage.setItem("selectedSyncConnection",parseInt(device,10)),sendMediaState()}function onOutputDeviceConnectionChange(input,device){selectedOutputDevice=device,sendOutputDeviceConnectionChange(device,input.checked),window.localStorage.setItem("selectedOutputConnection",parseInt(device,10)),sendMediaState()}function startMetadataProcess(){showAlertWindow("Process metadata","This will set metadata using the algrorith on first scan.<br>Adding smart tags and mfs tags based on the scan.<br>It will not change any user tags set by you.",sendMetadataProcess)}function startMetadataCleanProcess(){showAlertWindow("Clean metadata","This will compare the metadata with the currently loaded libraries<br>and delete any that do not exist any more.<br><u><b>DO NOT RUN</b></u> unless you have all your media currently loaded!",sendMetadataCleanProcess)}function startThumbCleanupProcess(){showAlertWindow("Clean thumbs","This will go through the thumbs and remove any thumbs where the media<br>do not exist or they not have an image in the media directory.",sendCleanupThumbsProcess)}function sendMetadataProcess(){sendWebsocketMessage("startMetadataProcess"),closeAlertWindow()}function sendMetadataCleanProcess(){sendWebsocketMessage("cleanupMetadata"),closeAlertWindow()}function sendCleanupThumbsProcess(){sendWebsocketMessage("cleanupThumbs"),closeAlertWindow()}function tcodeDeviceConnectRetry(){sendWebsocketMessage("connectOutputDevice",{deviceName:remoteUserSettings.connection.output.selectedDevice})}function sendTCode(tcode){sendWebsocketMessage("tcode",tcode)}function sendTCodeRange(channelName,min,max){sendWebsocketMessage("setChannelRange",{channelName:channelName,min:min,max:max})}function sendInputDeviceConnectionChange(device,checked){sendWebsocketMessage("connectInputDevice",{deviceName:device,enabled:checked})}function sendOutputDeviceConnectionChange(device,checked){sendWebsocketMessage("connectOutputDevice",{deviceName:device,enabled:checked})}function sendSkipToNextActionClick(){controlsVisible&&sendSkipToNextAction()}function sendSkipToNextAction(){sendWebsocketMessage("skipToNextAction")}function sendSkipToMoneyShot(){sendWebsocketMessage("skipToMoneyShot")}function sendUpdateThumb(item){sendWebsocketMessage("saveSingleThumb",{itemID:item.id,pos:0})}function sendUpdateThumbAtPos(item){var pos=videoNode.currentTime;sendWebsocketMessage("saveSingleThumb",{itemID:item.id,pos:pos})}function sendUpdateMoneyShotAtPos(item){var pos=videoNode.currentTime;sendWebsocketMessage("setMoneyShot",{itemID:item.id,pos:pos})}function settingChange(key,value){settingChangeDebounce&&clearTimeout(settingChangeDebounce),settingChangeDebounce=setTimeout((function(){sendWebsocketMessage("settingChange",{key:key,value:value}),markXTPFormDirty()}),500)}function setSaveState(node,saving,error){node||(node=saveStateNode),node.innerText=saving?"Saving settings...":"Save success!",error?(node.style.visibility="visible",node.style.opacity="1",node.style.color="red",node.innerText="Save fail",node.title=error):(saving?node.style.color="white":(node.style.color="green",setTimeout((()=>{node.style.visibility="hidden",node.style.opacity="0"}),5e3)),node.style.visibility="visible",node.style.opacity="1")}function restartXTP(){showAlertWindow("Confirm","Are you sure you want restart XTP? \n\t\t"+(remoteUserSettings.hasLaunchPass?"\n\t\t\t<br><br>PLEASE NOTE: XTP is protected by a launch password.\n\t\t\t<br>You will need to go to the pc and enter the password manually for now.":""),(function(){sendWebsocketMessage("restartService"),closeAlertWindow(),closeSettings()}))}function refreshXTPLibrary(){sendWebsocketMessage("reloadLibrary"),mediaReloadRequiredNode.classList.add("hidden")}function initWebSocket(){try{debug("Connecting to web socket uri: "+(wsUri="ws://"+window.location.hostname+":"+remoteUserSettings.webSocketServerPort)),"function"==typeof MozWebSocket&&(WebSocket=MozWebSocket),websocket&&1==websocket.readyState&&websocket.close(),(websocket=new WebSocket(wsUri)).onopen=function(evt){xtpConnected=!0,stopServerConnectionRetry(),serverRetryTimeoutTries=0,debug("CONNECTED"),updateSettingsUI(),sendMediaState()},websocket.onmessage=function(evt){wsCallBackFunction(evt),debug("MESSAGE RECIEVED: "+evt.data)},websocket.onclose=function(evt){debug("DISCONNECTED"),xtpConnected=!1,startServerConnectionRetry()},websocket.onerror=function(evt){console.log("ERROR: "+evt.data+", Address: "+wsUri),xtpConnected=!1,startServerConnectionRetry()}}catch(exception){console.log("ERROR: "+exception+", Address: "+wsUri),xtpConnected=!1,startServerConnectionRetry()}}function wsCallBackFunction(evt){try{var data=JSON.parse(evt.data);switch(data.command){case"stopAllMedia":stopVideo();break;case"outputDeviceStatus":setOutputConnectionStatus((status=data.message).deviceName,status.status,status.message);break;case"inputDeviceStatus":var status;setInputConnectionStatus((status=data.message).deviceName,status.status,status.message);break;case"mediaLoaded":document.getElementById("mediaLoading").style.display="none",mediaLoading=!1,getServerLibrary();break;case"mediaLoading":setMediaLoading();break;case"mediaLoadingStatus":setMediaLoadingStatus(data.message);break;case"updateThumb":var message=data.message,mediaElement=document.getElementById(message.id);if(mediaElement){var imageElement=mediaElement.getElementsByClassName("media-thumb-nail")[0],src="/thumb/"+message.thumb+"?"+(new Date).getTime();imageElement.src.length>0?imageElement.src=src:imageElement.dataset.src=src,message.errorMessage&&(imageElement.title=message.errorMessage);var index=mediaListGlobal.findIndex((x=>x.id===message.id));mediaListGlobal[index].relativeThumb="/thumb/"+message.thumb,mediaListGlobal[index].thumbFileExists=!0}break;case"updateItem":updateItem(libraryItem=(message=data.message).item,message.roles);break;case"addItem":var libraryItem=(message=data.message).item;message.roles;addItem(libraryItem);break;case"textToSpeech":onTextToSpeech(message=data.message);break;case"skipToNextAction":skipVideoTo(message=data.message);break;case"skipToMoneyShot":onSkipToMoneyShot();break;case"logout":logout();break;case"channelProfileChanged":getServerChannels();break;case"statusOutput":message=(messageObj=data.message).message;var percentage=messageObj.percentage;setStatusOutput(message,percentage);break;case"tagsUpdate":var messageObj,smartTags=(messageObj=data.message).smartTags,userTags=messageObj.userTags;remoteUserSettings.allTags=[],remoteUserSettings.allTags.push(...userTags,...smartTags),remoteUserSettings.userTags=[],remoteUserSettings.userTags.push(...userTags),remoteUserSettings.smartTags=[],remoteUserSettings.smartTags.push(...smartTags),setupSystemTags();break}}catch(e){error("string"==typeof e?e:e.toString())}}function setStatusOutput(message,percentage){message||progressNode.classList.contains("hidden-visibility")?message&&progressNode.classList.contains("hidden-visibility")&&(progressNode.classList.remove("hidden-visibility"),progressLabelNode.classList.remove("hidden-visibility")):(progressNode.classList.add("hidden-visibility"),progressLabelNode.classList.add("hidden-visibility")),progressLabelNode.innerText=(message||"")+(percentage>-1?": "+percentage+"%":""),progressNode.value=percentage>-1?percentage:0}function setMediaLoading(){mediaLoading=!0,clearMediaList(),document.getElementById("mediaLoading").style.display="flex",document.getElementById("noMedia").hidden=!0}function setMediaLoadingStatus(status){document.getElementById("loadingStatus").innerText=status}function onResizeVideo(){}function getBrowserInformation(){var browserName,fullVersion,majorVersion,nameOffset,verOffset,ix,nAgt=navigator.userAgent;-1!=(verOffset=nAgt.indexOf("Opera"))?(browserName="Opera",fullVersion=nAgt.substring(verOffset+6),-1!=(verOffset=nAgt.indexOf("Version"))&&(fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("MSIE"))?(browserName="Microsoft Internet Explorer",fullVersion=nAgt.substring(verOffset+5)):-1!=(verOffset=nAgt.indexOf("Chrome"))?(browserName="Chrome",fullVersion=nAgt.substring(verOffset+7)):-1!=(verOffset=nAgt.indexOf("Safari"))?(browserName="Safari",fullVersion=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(fullVersion=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("Firefox"))?(browserName="Firefox",fullVersion=nAgt.substring(verOffset+8)):(nameOffset=nAgt.lastIndexOf(" ")+1)<(verOffset=nAgt.lastIndexOf("/"))&&(browserName=nAgt.substring(nameOffset,verOffset),fullVersion=nAgt.substring(verOffset+1),browserName.toLowerCase()==browserName.toUpperCase()&&(browserName=navigator.appName)),-1!=(ix=fullVersion.indexOf(";"))&&(fullVersion=fullVersion.substring(0,ix)),-1!=(ix=fullVersion.indexOf(" "))&&(fullVersion=fullVersion.substring(0,ix)),majorVersion=parseInt(""+fullVersion,10),isNaN(majorVersion)&&(fullVersion=""+parseFloat(navigator.appVersion),majorVersion=parseInt(navigator.appVersion,10));var divnode=document.createElement("div");divnode.innerHTML="Browser name  = "+browserName+"<br>Full version  = "+fullVersion+"<br>Major version = "+majorVersion+"<br>navigator.userAgent = "+navigator.userAgent+"<br>",userAgent=navigator.userAgent,document.getElementById("browserInfo").appendChild(divnode)}function setDeoStyles(isDeo){if(isDeo)for(var checkboxes=document.querySelectorAll("input[type='checkbox']"),i=0;i<checkboxes.length;i++)checkboxes[i].classList.remove("styled-checkbox");else for(checkboxes=document.getElementsByClassName("input[type='checkbox']"),i=0;i<checkboxes.length;i++)checkboxes[i].classList.add("styled-checkbox")}function logout(){var xhr=new XMLHttpRequest;xhr.open("GET","/logout",!0),xhr.responseType="json",xhr.onload=function(){200===xhr.status?(window.localStorage.removeItem("storedHash"),window.sessionStorage.clear(),delete_cookie("sessionID"),cookies.sessionID=void 0,window.location.replace(window.location.origin)):systemError("Error logging out: "+err)},xhr.onerror=function(){systemError("Error logging out")},xhr.send()}function checkPass(){var xhr=new XMLHttpRequest;xhr.open("POST","/auth",!0),xhr.setRequestHeader("Content-Type","application/json"),xhr.onreadystatechange=function(){4===xhr.readyState&&(200==xhr.status&&startServerConnectionRetry())},xhr.onerror=function(){onSaveFail(xhr)},storedHash?xhr.send('{"hashedPass":"'+storedHash+'", "remember":"'+!!storedHash+'"}'):alert("Invalid password")}function getServerSettings(retry){var xhr=new XMLHttpRequest;xhr.open("GET","/settings",!0),xhr.responseType="json",xhr.onload=function(evnt,retry){var status=xhr.status;200===status?(remoteUserSettings=xhr.response,document.getElementById("xteVersion").innerText=remoteUserSettings.xteVersion,document.getElementById("scheduleLibraryLoadEnabled").checked=remoteUserSettings.scheduleLibraryLoadEnabled,document.getElementById("scheduleLibraryLoadTime").value=remoteUserSettings.scheduleLibraryLoadTime,document.getElementById("scheduleLibraryLoadFullProcess").checked=remoteUserSettings.scheduleLibraryLoadFullProcess,setupChannelData(),setupSystemTags(),initWebSocket()):401==status?storedHash?checkPass():window.location.replace(window.location.origin):startServerConnectionRetry()}.bind(this),xhr.onerror=function(evnt,retry){startServerConnectionRetry()},xhr.send()}function getServerChannels(){var xhr=new XMLHttpRequest;xhr.open("GET","/channels",!0),xhr.responseType="json",xhr.onload=function(evnt){if(200===xhr.status){var response=xhr.response;remoteUserSettings.availableChannels=response.availableChannels,remoteUserSettings.selectedChannelProfile=response.selectedChannelProfile,remoteUserSettings.allChannelProfileNames=response.allChannelProfileNames,setupChannelData(),updateChannelsUI()}else systemError("Error getting channels: "+xhr.responseText)}.bind(this),xhr.onerror=function(evnt){systemError("Error getting channels: "+xhr.responseText)},xhr.send()}function setupChannelData(){funscriptChannels=Object.keys(remoteUserSettings.availableChannels).map((function(k){return remoteUserSettings.availableChannels[k].channel})),remoteUserSettings.availableChannelsArray=Object.keys(remoteUserSettings.availableChannels).map((function(k){return remoteUserSettings.availableChannels[k]})),funscriptChannels.sort()}function setupSystemTags(){const tags=remoteUserSettings.allTags,tagsFIlterNode=document.getElementById("tagFilterOptions"),metaDataTagsNode=document.getElementById("metaDataTags");removeAllChildNodes(tagsFIlterNode),removeAllChildNodes(metaDataTagsNode);const containter=document.createElement("div");containter.classList.add("media-tag-filter-container"),tagsFIlterNode.appendChild(containter),tags.forEach(((x,i)=>{containter.appendChild(createCheckBoxDiv(x+"TagCheckbox"+i,"TagCheckbox",x,x,onFilterByTagClicked)),metaDataTagsNode.appendChild(createCheckBoxDiv(x+"MetadataTagCheckbox"+i,"MetadataTagCheckbox",x,x,onMetadataTagCheckboxClicked))}));const userTagsSelect=document.getElementById("systemTagsSelect");for(;userTagsSelect.options.length>0;)userTagsSelect.options.remove(userTagsSelect.options.length-1);remoteUserSettings.userTags.forEach(((x,i)=>{const option=document.createElement("option");option.value=x,option.innerText=x,userTagsSelect.options.add(option)}));const smartTagsSelect=document.getElementById("smartTagsSelect");for(;smartTagsSelect.options.length>0;)smartTagsSelect.options.remove(smartTagsSelect.options.length-1);remoteUserSettings.smartTags.forEach(((x,i)=>{const option=document.createElement("option");option.value=x,option.innerText=x,smartTagsSelect.options.add(option)}))}function systemTagsSelectChange(selectElement){document.getElementById("removeTagButton").disabled=-1==selectElement.options.selectedIndex}function smartagsSelectChange(selectElement){document.getElementById("removeSmartTagButton").disabled=-1==selectElement.options.selectedIndex}function addSystemTag(smartMode){showGetTextWindow(smartMode?"Add smart tag":"Add tag","Name",(function(value){systemTagAdded(value,smartMode)}))}function systemTagAdded(name,smartMode){if(!name||!name.trim().length)return void showAlertWindow("Empty","Tag cant be empty!");if(remoteUserSettings[smartMode?"smartTags":"userTags"].findIndex((x=>x==name))>-1)return void showAlertWindow("Tag exists",`Tag '${name}' already exists!`);const otherTagName=smartMode?"userTags":"smartTags";if(remoteUserSettings[otherTagName].findIndex((x=>x==name))>-1)return void showAlertWindow("Tag exists",`Tag '${name}' already exists in ${otherTagName}!`);const settingMemberName=smartMode?"smartTagsToAdd":"tagsToAdd";remoteUserSettings[settingMemberName]||(remoteUserSettings[settingMemberName]=[]),remoteUserSettings[settingMemberName].push(name);const systemTagsSelect=document.getElementById(smartMode?"smartTagsSelect":"systemTagsSelect"),option=document.createElement("option");option.value=name,option.innerText=name,systemTagsSelect.options.add(option),smartMode&&mediaReloadRequiredNode.classList.remove("hidden"),closeTextWindow(),markXTPFormDirty()}function removeSystemTags(smartMode){remoteUserSettings[smartMode?"smartTags":"userTags"];const systemTagsSelect=document.getElementById(smartMode?"smartTagsSelect":"systemTagsSelect"),settingMemberName=smartMode?"smartTagsToRemove":"tagsToRemove";for(remoteUserSettings[settingMemberName]||(remoteUserSettings[settingMemberName]=[]);systemTagsSelect.options.selectedIndex>-1;){const opt=systemTagsSelect.options[systemTagsSelect.options.selectedIndex];remoteUserSettings[settingMemberName].push(opt.value),systemTagsSelect.options.remove(systemTagsSelect.options.selectedIndex)}markXTPFormDirty()}function setSelectedProfile(profileName){sendWebsocketMessage("changeChannelProfile",profileName)}function getServerSessions(){if(cookies.sessionID){var xhr=new XMLHttpRequest;xhr.open("GET","/activeSessions",!0),xhr.responseType="json",xhr.onload=function(evnt){var status=xhr.status;if(200===status){var activeSessions=xhr.response,tBody=document.getElementById("sessionInfoBody");removeAllChildNodes(tBody),activeSessions.forEach((element=>{var row=document.createElement("tr");row.id=element.id;var cellSessionID=document.createElement("td");cellSessionID.innerText=element.id;var cellCreate=document.createElement("td");cellCreate.innerText=element.lastAccessed;var cellExpire=document.createElement("td");cellExpire.innerText=element.expire;var cellCurrent=document.createElement("td");cellCurrent.innerText=element.current?"*":"";var cellDelete=document.createElement("td"),btnDelete=document.createElement("button");btnDelete.onclick=checkSession(element.id),btnDelete.innerText="X",cellDelete.appendChild(btnDelete),row.appendChild(cellSessionID),row.appendChild(cellCreate),row.appendChild(cellExpire),row.appendChild(cellCurrent),row.appendChild(cellDelete),tBody.appendChild(row)}))}else showAlertWindow(status.statusText)}.bind(this),xhr.onerror=function(evnt,retry){onSaveFail(xhr)},xhr.send()}}setupTextToSpeech(),getServerSettings(),debugMode=!0;var checkSession=function(sessionID){return function(){sessionID==cookies.sessionID?showAlertWindow("Logout?","Are you sure you want to delete the current session? This will log you out.",(function(){deleteSession(sessionID)})):deleteSession(sessionID)}};function deleteSession(sessionID){var xhr=new XMLHttpRequest;xhr.open("POST","/expireSession?sessionID="+sessionID,!0),xhr.setRequestHeader("Content-Type","application/json"),xhr.onreadystatechange=function(){if(4===xhr.readyState&&200==xhr.status){var sessionNode=document.getElementById(sessionID);document.getElementById("sessionInfoBody").removeChild(sessionNode),sessionID==cookies.sessionID&&(delete_cookie("sessionID"),logout())}},xhr.onerror=function(){onSaveFail(xhr)},xhr.send()}function startServerConnectionRetry(){stopServerConnectionRetry(),setMediaLoading(),setMediaLoadingStatus("Waiting for reconnect..."),++serverRetryTimeoutTries<100?serverRetryTimeout=setTimeout((()=>{getServerSettings()}),5e3):setMediaLoadingStatus("Timed out while looking for server. Please refresh the page when the server has started again.")}function stopServerConnectionRetry(){null!=serverRetryTimeout&&(clearTimeout(serverRetryTimeout),serverRetryTimeout=void 0)}function updateSettingsUI(){updateChannelsUI(),setupConnectionsTab(),document.getElementById("tabLocalTab").onclick()}function updateChannelsUI(){var profileNamesDiv=document.getElementById("profileNamesDiv");removeAllChildNodes(profileNamesDiv),remoteUserSettings.allChannelProfileNames.forEach((x=>{var radio=document.createElement("input"),label=document.createElement("label");radio.type="radio",radio.id=x,radio.name="motionProfileGroup",radio.value=x,radio.onclick=function(){setSelectedProfile(this.value)},x==remoteUserSettings.selectedChannelProfile&&(radio.checked=!0),label.for=x,label.innerText=x,profileNamesDiv.appendChild(radio),profileNamesDiv.appendChild(label)})),setupSliders(),setupMotionModifiers()}function getServerLibrary(){var xhr=new XMLHttpRequest;xhr.open("GET","/media",!0),xhr.responseType="json",xhr.onload=function(){200===xhr.status?(mediaListGlobal=xhr.response,setThumbSize(thumbSizeGlobal,!1),sort(sortByGlobal,!1),loadMedia(mediaListDisplayed=getDisplayedMediaList(showGlobal,!1)),filter()):systemError("Error getting media list: "+err)},xhr.onerror=function(){systemError("Error getting media")},xhr.send()}function setInputConnectionStatus(deviceName,status,message){var statusImage="",statusColor="";switch(status){case ConnectionStatus.Connected:statusImage="://images/icons/check-mark-black.png",statusColor="chartreuse";break;case ConnectionStatus.Connecting:statusImage="://images/icons/reload.svg",statusColor="yellow";break;case ConnectionStatus.Disconnected:statusImage="://images/icons/x.svg",statusColor="crimson";break;case ConnectionStatus.Error:statusImage="://images/icons/error-black.png",statusColor="red";break}var deoVRStatusImage=document.getElementById("deoVRStatus"),whirligigStatusImage=document.getElementById("whirligigStatus"),xtpWebStatusImage=document.getElementById("xtpWebStatus"),gamepadStatusImage=document.getElementById("gamepadStatus");switch(deviceName!=DeviceType.Gamepad&&(deoVRStatusImage.src="://images/icons/x.svg",deoVRStatusImage.style.backgroundColor="crimson",deoVRStatusImage.title="Disconnected",whirligigStatusImage.src="://images/icons/x.svg",whirligigStatusImage.style.backgroundColor="crimson",whirligigStatusImage.title="Disconnected",xtpWebStatusImage.src="://images/icons/x.svg",xtpWebStatusImage.style.backgroundColor="crimson",xtpWebStatusImage.title="Disconnected"),deviceName){case DeviceType.Deo:deoVRStatusImage.src=statusImage,deoVRStatusImage.style.backgroundColor=statusColor,deoVRStatusImage.title=message;break;case DeviceType.Whirligig:whirligigStatusImage.src=statusImage,whirligigStatusImage.style.backgroundColor=statusColor,whirligigStatusImage.title=message;break;case DeviceType.XTPWeb:xtpWebStatusImage.src=statusImage,xtpWebStatusImage.style.backgroundColor=statusColor,xtpWebStatusImage.title=message;break;case DeviceType.Gamepad:gamepadStatusImage.src=statusImage,gamepadStatusImage.style.backgroundColor=statusColor,gamepadStatusImage.title=message;break}}function setOutputConnectionStatus(deviceName,status,message){for(var i=0;i<deviceConnectionStatusRetryButtonNodes.length;i++){var deviceConnectionStatusRetryButtonNode=deviceConnectionStatusRetryButtonNodes[i],deviceConnectionStatusRetryButtonImageNode=deviceConnectionStatusRetryButtonImageNodes[i];deviceConnectionStatusRetryButtonNode.title="TCode status: "+message,deviceConnectionStatusRetryButtonNode.style.cursor="",deviceConnectionStatusRetryButtonNode.disabled=!0;var tcodeDeviceSettingsLink=document.getElementById("tcodeDeviceSettingsLink");switch(tcodeDeviceSettingsLink.hidden=!0,outputConnectionStatus=status,status){case ConnectionStatus.Disconnected:deviceConnectionStatusRetryButtonNode.style.backgroundColor="crimson",deviceConnectionStatusRetryButtonNode.style.cursor="pointer",deviceConnectionStatusRetryButtonNode.disabled=!1,deviceConnectionStatusRetryButtonImageNode.src="://images/icons/x.svg",deviceConnectionStatusRetryButtonNode.title+=": Check your devices connection and click this to retry";break;case ConnectionStatus.Connecting:deviceConnectionStatusRetryButtonNode.style.backgroundColor="yellow",deviceConnectionStatusRetryButtonImageNode.src="://images/icons/reload.svg";break;case ConnectionStatus.Connected:outputDeviceConnected=!0,deviceConnectionStatusRetryButtonNode.style.backgroundColor="chartreuse",deviceConnectionStatusRetryButtonImageNode.src="://images/icons/check-mark-black.png",remoteUserSettings.connection.output.selectedDevice==DeviceType.Network&&(tcodeDeviceSettingsLink.href="http://"+remoteUserSettings.connection.networkAddress,tcodeDeviceSettingsLink.hidden=!1);break;case ConnectionStatus.Error:deviceConnectionStatusRetryButtonNode.style.backgroundColor="red",deviceConnectionStatusRetryButtonNode.style.cursor="pointer",deviceConnectionStatusRetryButtonNode.disabled=!1,deviceConnectionStatusRetryButtonImageNode.src="://images/icons/error-black.png",deviceConnectionStatusRetryButtonNode.title+=": Check your devices connection and click this to retry";break}}var statusImage="",statusColor="";switch(status){case ConnectionStatus.Connected:statusImage="://images/icons/check-mark-black.png",statusColor="chartreuse";break;case ConnectionStatus.Connecting:statusImage="://images/icons/reload.svg",statusColor="yellow";break;case ConnectionStatus.Disconnected:statusImage="://images/icons/x.svg",statusColor="crimson";break;case ConnectionStatus.Error:statusImage="://images/icons/error-black.png",statusColor="red";break}var networkStatusImage=document.getElementById("networkStatus"),serialStatusImage=document.getElementById("serialStatus");switch(networkStatusImage.src="://images/icons/x.svg",networkStatusImage.style.backgroundColor="crimson",networkStatusImage.title="Disconnected",serialStatusImage.src="://images/icons/x.svg",serialStatusImage.style.backgroundColor="crimson",serialStatusImage.title="Disconnected",deviceName){case DeviceType.Network:networkStatusImage.src=statusImage,networkStatusImage.style.backgroundColor=statusColor,networkStatusImage.title=message;break;case DeviceType.Serial:serialStatusImage.src=statusImage,serialStatusImage.style.backgroundColor=statusColor,serialStatusImage.title=message;break}}function getMediaFunscripts(path,isMFS){var channel=funscriptChannels[currentChannelIndex],trackName=remoteUserSettings.availableChannels[channel].trackName,xhr=new XMLHttpRequest,channelPath=""===trackName?trackName:"."+trackName;xhr.open("GET",path+channelPath+".funscript",!0),xhr.responseType="json",xhr.onload=function(){if(200===xhr.status){loadedFunscripts.push({channel:channel,atList:[]});for(var index=loadedFunscripts.length-1,items=xhr.response,i=0;i<items.actions.length;i++){var item=items.actions[i],at=item.at;loadedFunscripts[index][at]=item.pos,loadedFunscripts[index].atList.push(at)}}++currentChannelIndex<funscriptChannels.length?getMediaFunscripts(path,isMFS):(currentChannelIndex=0,videoNode.play(),console.log("Funscripts load finish"))},xhr.send()}function onSaveToXTPClick(){postServerSettings()}function postServerSettings(){setSaveState(null,!0);var xhr=new XMLHttpRequest;xhr.open("POST","/settings",!0),xhr.setRequestHeader("Content-Type","application/json"),xhr.onreadystatechange=function(){4===xhr.readyState&&(200!==xhr.status?onSaveFail(xhr):(onSaveSuccess(),markXTPFormClean()))},xhr.onerror=function(){onSaveFail(xhr)},xhr.send(JSON.stringify(remoteUserSettings))}function postMediaItemMetaData(metaData){var xhr=new XMLHttpRequest;xhr.open("POST","/mediaItemMetadata",!0),xhr.setRequestHeader("Content-Type","application/json"),xhr.onreadystatechange=function(){4===xhr.readyState&&(200!==xhr.status?onSaveFail(xhr,metaDataSaveStateNode):(onSaveSuccess(metaDataSaveStateNode),document.getElementById("saveMediaItemMetaDataButton").disabled=!0))},xhr.onerror=function(){onSaveFail(xhr,metaDataSaveStateNode)},xhr.send(JSON.stringify(metaData))}function postMediaState(mediaState){var xhr=new XMLHttpRequest;xhr.open("POST","/xtpweb",!0),xhr.setRequestHeader("Content-Type","application/json"),xhr.send(JSON.stringify(mediaState)),xhr.oneload=function(){200!==xhr.status&&console.log("Error sending mediastate: "+xhr.statusText)},xhr.onerror=function(){console.log("Error sending mediastate: "+xhr.statusText)}}function onSaveSuccess(node){setSaveState(node,!1)}function onSaveFail(xhr,node){const statusTest=xhr.statusText?xhr.statusText:xhr.status.statusText;if(xhr.response)try{const obj=JSON.parse(xhr.response);showAlertWindow(statusTest,obj.message)}catch(e){}setSaveState(node,!1,statusTest)}function clearMediaList(){var medialistNode=document.getElementById("mediaList");return removeAllChildNodes(medialistNode),medialistNode}function loadMedia(mediaList){var medialistNode=clearMediaList(),noMediaElement=document.getElementById("noMedia");if(mediaList&&0!=mediaList.length){noMediaElement.hidden=!0;for(var createClickHandler=function(obj){return function(){playVideo(obj)}},toggleContext=function(contextMenu,mediaItem){return function(){contextMenu.classList.toggle("hidden");var thumbAtPosMenuItem=contextMenu.getElementsByClassName("setThumbAtCurrent")[0],setMoneyShotAtCurrentMenuItem=contextMenu.getElementsByClassName("setMoneyShotAtCurrent")[0];isVideoShown()&&playingmediaItem&&playingmediaItem.id===mediaItem.id?(thumbAtPosMenuItem.classList.remove("disabled"),setMoneyShotAtCurrentMenuItem.classList.remove("disabled"),setMoneyShotAtCurrentMenuItem.title="Set moneyshot at current",thumbAtPosMenuItem.title="Set thumb at current"):(thumbAtPosMenuItem.classList.add("disabled"),thumbAtPosMenuItem.title="This is not the current playing video so it cannot be set at the current position.",setMoneyShotAtCurrentMenuItem.classList.add("disabled"),setMoneyShotAtCurrentMenuItem.title="This is not the current playing video so it cannot be set at the current position.");var regenerateThumbMenuItem=contextMenu.getElementsByClassName("regenerateThumb")[0];mediaItem.managedThumb&&!mediaItem.thumb.includes(".lock.")?regenerateThumbMenuItem.classList.remove("disabled"):(regenerateThumbMenuItem.classList.add("disabled"),regenerateThumbMenuItem.title="This thumb file is not modifiable because it is not managed by XTP.")}},closeContext=function(contextMenu){return function(){contextMenu.classList.add("hidden")}},mediaSettingsClick=function(mediaItem,contextMenu){return function(){openMetaDataModal(mediaItem),contextMenu.classList.add("hidden")}},regenThumbClick=function(mediaItem,contextMenu){return function(){sendUpdateThumb(mediaItem),contextMenu.classList.add("hidden")}},regenThumbCurrentPosClick=function(mediaItem,contextMenu){return function(){sendUpdateThumbAtPos(mediaItem),contextMenu.classList.add("hidden")}},setMoneyShotCurrentPosClick=function(mediaItem,contextMenu){return function(){mediaItem.metaData.moneyShotMillis=Math.round(1e3*videoNode.currentTime).toString(),postMediaItemMetaData(mediaItem.metaData),contextMenu.classList.add("hidden")}},textHeight=0,width=0,widthInt=0,height=0,fontSize=0,i=0;i<mediaList.length;i++){var obj=mediaList[i];thumbSizeGlobal||(setThumbSize(obj.thumbSize,!0),setThumbSize(obj.thumbSize,!1)),textHeight||(width=(widthInt=thumbSizeGlobal+.15*thumbSizeGlobal)+"px",height=thumbSizeGlobal+(textHeight=.25*thumbSizeGlobal)+"px",fontSize=.35*textHeight+"px");var divnode=document.createElement("div");divnode.id=obj.id,divnode.className+="media-item",divnode.style.width=width,divnode.style.height=height,divnode.title=obj.tooltip;var info=document.createElement("button");info.id=obj.id+"InfoButton",info.classList.add("media-context"),info.style.width=.2*widthInt+"px",info.style.height=.2*widthInt+"px";var contextMenu=document.createElement("div");contextMenu.id=obj.id+"ContextMenu",info.onclick=toggleContext(contextMenu,obj),info.dataset.title="Media actions";var icon=document.createElement("img");icon.src="://images/icons/context-menu.svg",icon.style.width=.1*widthInt+"px",icon.style.height=.1*widthInt+"px",info.appendChild(icon),contextMenu.classList.add("media-context-menu","hidden"),contextMenu.style.fontSize=fontSize,(contextMenuItem=createContextMenuItem("Regenerate thumb",regenThumbClick(obj,contextMenu))).classList.add("regenerateThumb","disabled"),contextMenu.appendChild(contextMenuItem),(contextMenuItem=createContextMenuItem("Set thumb at current",regenThumbCurrentPosClick(obj,contextMenu))).classList.add("setThumbAtCurrent","disabled"),contextMenu.appendChild(contextMenuItem),(contextMenuItem=createContextMenuItem("Set moneyshot at current",setMoneyShotCurrentPosClick(obj,contextMenu))).classList.add("setMoneyShotAtCurrent","disabled"),contextMenu.appendChild(contextMenuItem);var contextMenuItem=createContextMenuItem("Settings",mediaSettingsClick(obj,contextMenu));contextMenu.appendChild(contextMenuItem);var contextCancelMenuItem=createContextMenuItem("Cancel",closeContext(contextMenu));contextMenu.appendChild(contextCancelMenuItem),divnode.appendChild(contextMenu),divnode.appendChild(info);var anode=document.createElement("a");anode.className+="media-link",anode.onclick=createClickHandler(obj);var image=document.createElement("img");disableLazyLoad?(obj.thumbFileExists?image.src="/thumb/"+obj.relativeThumb:image.src="/thumb/"+obj.thumbFileLoading,image.loading="lazy"):(obj.thumbFileExists?image.dataset.src="/thumb/"+obj.relativeThumb:image.dataset.src="/thumb/"+obj.thumbFileLoading,image.classList.add("lazy")),image.classList.add("media-thumb-nail"),image.style.width=thumbSizeGlobal+"px",image.style.height=thumbSizeGlobal-textHeight+"px";var namenode=document.createElement("div");namenode.id=obj.id+"DisplayName",namenode.innerText=obj.displayName,namenode.className+="name",namenode.style.width=width,namenode.style.height=textHeight+"px",namenode.style.fontSize=fontSize,updateScriptStatus(obj,divnode,namenode),divnode.appendChild(anode),anode.appendChild(image),anode.appendChild(namenode),divnode.hidden=isFiltered(userFilterCriteria,divnode.innerText),medialistNode.appendChild(divnode),playingmediaItem&&playingmediaItem.id===obj.id&&setPlayingMediaItem(obj),obj.subtitle&&updateSubTitle(obj,divnode,contextMenu)}disableLazyLoad||setupLazyLoad()}else mediaLoading||(noMediaElement.innerHTML="No media found<br>Current filter: "+showGlobal,noMediaElement.hidden=!1)}function createMediaContextNode(parent,mediaItem){}function createContextMenuItem(innerText,onclick){var contextMenuItem=document.createElement("div");return contextMenuItem.classList.add("media-context-menu-item"),contextMenuItem.innerText=innerText,contextMenuItem.onclick=onclick,contextMenuItem}function destroyMediaContextNode(event){}function setupLazyLoad(){var lazyImages=[].slice.call(document.querySelectorAll("img.lazy"));if("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype){let lazyImageObserver=new IntersectionObserver((function(entries,observer){entries.forEach((function(entry){if(entry.isIntersecting){let lazyImage=entry.target;lazyImage.src=lazyImage.dataset.src,lazyImage.classList.remove("lazy"),lazyImageObserver.unobserve(lazyImage)}}))}));lazyImages.forEach((function(lazyImage){lazyImageObserver.observe(lazyImage)}))}}function updateItem(libraryItem,roles){var mediaNode;roles.findIndex((x=>x==Roles.DisplayRole))>-1&&(mediaNode=updateScriptStatus(libraryItem)),roles.findIndex((x=>x==Roles.DecorationRole))>-1&&(mediaNode=updateSubTitle(libraryItem,mediaNode))}function addItem(libraryItem){mediaListGlobal.push(libraryItem),showChange(showGlobal)}function updateSubTitle(libraryItem,mediaNode,contextMenu){if(mediaNode||(mediaNode=document.getElementById(libraryItem.id)),mediaNode){if(contextMenu||(contextMenu=document.getElementById(libraryItem.id+"ContextMenu")),!contextMenu)return mediaNode;var index=mediaListGlobal.findIndex((x=>x.id===libraryItem.id)),contextButton=document.getElementById(libraryItem.id+"InfoButton"),ccIcon=document.getElementById(libraryItem.id+"ccIconImg");ccIcon&&contextButton.removeChild(ccIcon);var contextMenuItems=contextMenu.getElementsByClassName("downloadSubtitle");if(contextMenuItems.length&&contextMenu.removeChild(contextMenuItems[0]),libraryItem.subtitle){var icon=document.createElement("img");icon.id=libraryItem.id+"ccIconImg",icon.src="://images/icons/cc.svg",widthInt=thumbSizeGlobal+.15*thumbSizeGlobal,icon.style.width=.1*widthInt+"px",icon.style.height=.1*widthInt+"px",icon.classList.add("media-cc"),contextButton.appendChild(icon);var subtitle_path="/media"+libraryItem.subtitleRelative;const ext=libraryItem.subtitleRelative.substring(libraryItem.subtitleRelative.lastIndexOf("."),libraryItem.subtitleRelative.length),link=document.createElement("a");link.href=subtitle_path,link.setAttribute("download",libraryItem.displayName+ext),link.innerText="Download subtitle";var contextSubtitleMenuItem=createContextMenuItem("",void 0);contextSubtitleMenuItem.classList.add("downloadSubtitle"),contextSubtitleMenuItem.appendChild(link),contextMenu.insertBefore(contextSubtitleMenuItem,contextMenu.firstChild)}return mediaListGlobal[index].subtitle=libraryItem.subtitle,mediaListGlobal[index].subtitleRelative=libraryItem.subtitleRelative,mediaNode}}function updateScriptStatus(libraryItem,mediaNode,displayNameNode){if(mediaNode||(mediaNode=document.getElementById(libraryItem.id)),mediaNode&&(displayNameNode||(displayNameNode=document.getElementById(libraryItem.id+"DisplayName")),displayNameNode)){displayNameNode.innerText=libraryItem.displayName,libraryItem.isMFS&&libraryItem.hasScript?mediaNode.classList.add("media-item-mfs"):libraryItem.isMFS&&!libraryItem.hasScript?(mediaNode.classList.remove("media-item-mfs"),mediaNode.classList.add("media-item-mfs-noscript")):mediaNode.classList.remove("media-item-mfs"),libraryItem.hasScript?mediaNode.classList.remove("media-item-noscript"):mediaNode.classList.add("media-item-noscript");var index=mediaListGlobal.findIndex((x=>x.id===libraryItem.id));return mediaListGlobal[index].displayName=libraryItem.displayName,mediaListGlobal[index].isMFS=libraryItem.isMFS,mediaListGlobal[index].hasScript=libraryItem.hasScript,mediaNode}}function onThumbLoadError(imageElement,tries){imageElement.onerror=null,tries<3?(imageElement.src="://images/icons/loading.png",imageElement.onerror=onThumbLoadError(imageElement,2)):imageElement.src="://images/icons/error.png"}function removeAllChildNodes(parent){for(;parent.firstChild;)parent.removeChild(parent.firstChild)}function sort(value,userClick){value||(value="nameAsc");var randomButton=document.getElementById("randomizeButton");switch("random"===random||randomButton.classList.contains("hidden")||randomButton.classList.add("hidden"),value){case"dateDesc":mediaListGlobal.sort((function(a,b){return new Date(b.modifiedDate)-new Date(a.modifiedDate)}));break;case"dateAsc":mediaListGlobal.sort((function(a,b){return new Date(a.modifiedDate)-new Date(b.modifiedDate)}));break;case"nameAsc":mediaListGlobal.sort((function(a,b){var nameA=a.displayName.toUpperCase(),nameB=b.displayName.toUpperCase();return nameA<nameB?-1:nameA>nameB?1:void 0}));break;case"nameDesc":mediaListGlobal.sort((function(a,b){var nameA=a.displayName.toUpperCase(),nameB=b.displayName.toUpperCase();return nameB<nameA?-1:nameB>nameA?1:void 0}));break;case"random":fy(mediaListGlobal),randomButton.classList.remove("hidden");break}return userClick?(window.localStorage.setItem("sortBy",JSON.stringify(value)),sortByGlobal=value):value&&(document.getElementById(value.toString()).checked=!0),mediaListGlobal}function fy(a,b,c,d){for(c=a.length;c;)b=Math.random()*c--|0,d=a[c],a[c]=a[b],a[b]=d}function getDisplayedMediaList(showValue,userClick){let filteredMediaScoped=[];switch(showValue){case"All":filteredMediaScoped=JSON.parse(JSON.stringify(mediaListGlobal));break;case"3DOnly":filteredMediaScoped=mediaListGlobal.filter((x=>x.type===MediaType.VR||x.metaData.tags.includes("vr")));break;case"2DAndAudioOnly":filteredMediaScoped=mediaListGlobal.filter((x=>x.type===MediaType.Audio||x.type===MediaType.Video||x.metaData.tags.includes("2d")||x.metaData.tags.includes("audio")));break}return null!=userClick&&(userClick||(document.getElementById(showValue.toString()).checked=!0)),filteredMediaScoped}function filter(criteria){userFilterCriteria=criteria;var filterInput=document.getElementById("filterInput");filterInput.enabled=!1;var mediaItems=document.getElementsByClassName("media-item");for(var item of mediaItems){const libraryItem=mediaListDisplayed.find((x=>x.id===item.id));item.hidden=isFiltered(userFilterCriteria,item.textContent)||isTagFiltered(userTagFilterCriteria,libraryItem.metaData.tags)}filterInput.enabled=!0}function debounceFilter(criteria){filterDebounce&&clearTimeout(filterDebounce),filterDebounce=setTimeout((function(){filter(criteria),filterDebounce=void 0}),1e3)}function isFiltered(criteria,textToSearch){return!(!criteria||0==criteria.trim().length)&&!textToSearch.trim().toUpperCase().includes(criteria.trim().toUpperCase())}var onFilterByTagClicked=function(tagCheckbox){return function(){if(tagCheckbox){if(tagCheckbox.checked)userTagFilterCriteria.push(tagCheckbox.value);else{var index=userTagFilterCriteria.findIndex((x=>x==tagCheckbox.value));index>-1&&userTagFilterCriteria.splice(index,1)}filterByTag(userTagFilterCriteria)}}};function filterByTag(filterCriteria){userTagFilterCriteria=filterCriteria;var tagsFilterOptions=document.getElementsByName("TagCheckbox");tagsFilterOptions.forEach((x=>x.enabled=!1));var mediaItems=document.getElementsByClassName("media-item");for(var item of mediaItems){const libraryItem=mediaListDisplayed.find((x=>x.id===item.id));item.hidden=isTagFiltered(userTagFilterCriteria,libraryItem.metaData.tags)||isFiltered(userFilterCriteria,item.textContent)}tagsFilterOptions.forEach((x=>x.enabled=!0))}function isTagFiltered(selectedTags,mediaTags){if(selectedTags&&selectedTags.length&&mediaTags&&mediaTags.length){for(let i=0;i<selectedTags.length;i++)if(!mediaTags.includes(selectedTags[i]))return!0;return!1}return!1}function onClickLazyLoadCheckbox(checkbox){toggleLazyLoad(checkbox.checked,!0)}function toggleLazyLoad(value,userClicked){userClicked?(externalStreaming=value,window.localStorage.setItem("disableLazyLoad",JSON.stringify(value))):document.getElementById("disableLazyLoadCheckbox").checked=value,value&&stopVideo()}function onClickExternalStreamingCheckbox(checkbox){toggleExternalStreaming(checkbox.checked,!0)}function toggleExternalStreaming(value,userClicked){userClicked?(externalStreaming=value,window.localStorage.setItem("externalStreaming",JSON.stringify(value))):document.getElementById("externalStreamingCheckbox").checked=value,value&&stopVideo()}function setupTextToSpeech(){if("undefined"==typeof speechSynthesis)return speechNotInbrowser=!0,void disableTextToSpeech();void 0!==speechSynthesis.onvoiceschanged?speechSynthesis.onvoiceschanged=setupVoices:setTimeout((function(){setupVoices()}),1e3),null===(selectedVoiceIndex=JSON.parse(window.localStorage.getItem("selectedVoiceIndex")))&&(selectedVoiceIndex=0,window.localStorage.setItem("selectedVoiceIndex",JSON.stringify(selectedVoiceIndex))),null===(enableTextToSpeech=JSON.parse(window.localStorage.getItem("enableTextToSpeech")))&&(enableTextToSpeech=!0,window.localStorage.setItem("enableTextToSpeech",JSON.stringify(enableTextToSpeech))),toggleEnableTextToSpeech(enableTextToSpeech,!1),null===(speechPitch=JSON.parse(window.localStorage.getItem("speechPitch")))&&(speechPitch=1,window.localStorage.setItem("speechPitch",JSON.stringify(speechPitch))),toggleSpeechPitchChange(speechPitch,!1),null===(speechRate=JSON.parse(window.localStorage.getItem("speechRate")))&&(speechRate=1,window.localStorage.setItem("speechRate",JSON.stringify(speechRate))),null===(speechVolume=JSON.parse(window.localStorage.getItem("speechVolume")))&&(speechVolume=.5,window.localStorage.setItem("speechVolume",JSON.stringify(speechVolume))),toggleSpeechVolumeChange(speechVolume,!1)}function setupVoices(){systemVoices=speechSynthesis.getVoices();for(var voiceSelect=document.getElementById("voiceSelect"),i=0;i<systemVoices.length;i++){var option=document.createElement("option");option.textContent=systemVoices[i].name+" ("+systemVoices[i].lang+")",option.value=i,systemVoices[i].default&&(option.textContent+=" — DEFAULT"),option.setAttribute("data-lang",systemVoices[i].lang),option.setAttribute("data-name",systemVoices[i].name),voiceSelect.appendChild(option)}voiceSelect.value=selectedVoiceIndex}function onVoiceSelect(index){selectedVoiceIndex=index,window.localStorage.setItem("selectedVoiceIndex",JSON.stringify(selectedVoiceIndex)),onTextToSpeech("Hello I am "+systemVoices[selectedVoiceIndex].name)}function onTextToSpeech(message){if(message&&enableTextToSpeech&&"undefined"!=typeof speechSynthesis&&systemVoices&&systemVoices.length>0){var msg=new SpeechSynthesisUtterance;msg.voice=systemVoices[selectedVoiceIndex],msg.volume=speechVolume,msg.rate=speechRate,msg.pitch=speechPitch,msg.text=message,window.speechSynthesis.speak(msg)}}function onEnableTextToSpeechClick(checkbox){toggleEnableTextToSpeech(checkbox.checked,!0)}function toggleEnableTextToSpeech(value,userClicked){userClicked?(enableTextToSpeech=value,window.localStorage.setItem("enableTextToSpeech",JSON.stringify(value)),value&&onTextToSpeech("Voice enabled")):document.getElementById("enableTextToSpeech").checked=value,document.getElementsByName("voiceFormElement").forEach((x=>{x.style.display=value?"grid":"none"}))}function onSpeechPitchChange(value){toggleSpeechPitchChange(value,!0)}function toggleSpeechPitchChange(value,userClicked){userClicked?(speechPitch=value,window.localStorage.setItem("speechPitch",JSON.stringify(value)),onTextToSpeech("Pitch changed to "+value)):document.getElementById("speechPitch").value=value}function onSpeechRateChange(value){toggleSpeechRateChange(value,!0)}function toggleSpeechRateChange(value,userClicked){userClicked?(speechRate=value,window.localStorage.setItem("speechRate",JSON.stringify(value)),onTextToSpeech("Rate changed to "+value)):document.getElementById("speechRate").value=value}function onSpeechVolumeChange(value){toggleSpeechVolumeChange(value,!0)}function toggleSpeechVolumeChange(value,userClicked){userClicked?(speechVolume=value,window.localStorage.setItem("speechVolume",JSON.stringify(value)),onTextToSpeech("Volume changed to "+value)):document.getElementById("speechVolume").value=value}function disableTextToSpeech(message){var textToSpeechUnavailable=document.getElementById("textToSpeechUnavailable");textToSpeechUnavailable.hidden=!1,message&&(textToSpeechUnavailable.innerText=message);var enableTTSCheckbox=document.getElementById("enableTextToSpeech");enableTTSCheckbox.title="Text to speech is not available in your browser.",enableTTSCheckbox.enabled=!1,enableTTSCheckbox.checked=!1,toggleEnableTextToSpeech(!1,!0)}function toggleShufflePlay(){mediaListDisplayed.length&&((shufflePlayMode=!shufflePlayMode)?(document.getElementById("shuffleButton").classList.add("icon-button-down"),showVideo(),playVideo(getNextShuffleMediaItem())):(shufflePlayModePlayedIndexed={},document.getElementById("shuffleButton").classList.remove("icon-button-down")))}function getNextShuffleMediaItem(){var currentDisplayedMedia=getCurrentDisplayedMediaNodes();if(currentDisplayedMedia&&currentDisplayedMedia.length){var randomIndex,id;Object.keys(shufflePlayModePlayedIndexed).length===currentDisplayedMedia.length&&(shufflePlayModePlayedIndexed={});do{id=currentDisplayedMedia[randomIndex=Math.floor(Math.random()*(currentDisplayedMedia.length-1))].id}while(shufflePlayModePlayedIndexed[id]);return document.getElementById(id).scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}),shufflePlayModePlayedIndexed[id]=!0,currentDisplayedMedia[randomIndex]}}function playVideo(obj){if(playingmediaItem){if(playingmediaItem.id===obj.id)return;clearPlayingMediaItem()}const index=mediaListGlobal.findIndex((x=>x.id==obj.id));if(-1==index)return void showAlertWindow("Error","Unknown media Item. If this is an item outside the slected media libraries, try refreshing the page. If that doesnt work. Im sorry.");const selectedMediaItem=mediaListGlobal[index];if(selectedMediaItem.type!=MediaType.ExternalType){if(setPlayingMediaItem(selectedMediaItem),sendMediaState(),obj.subtitle){if(!externalStreaming)if(obj.subtitle.endsWith("vtt")){const tracks=videoNode.querySelectorAll("track");let track;tracks.length?track=tracks[0]:(track=document.createElement("track"),track.default=!0,videoNode.appendChild(track)),track.src="/media"+obj.subtitleRelative}else for(var tracks=videoNode.querySelectorAll("track"),i=0;i<tracks.length;i++)tracks[i].src=void 0}else for(tracks=videoNode.querySelectorAll("track"),i=0;i<tracks.length;i++)tracks[i].src=void 0;if(externalStreaming){var file_path="/media"+obj.relativePath;window.open(file_path)}else showVideo(),dataLoading(),videoSourceNode.setAttribute("src","/media"+obj.relativePath),videoNode.setAttribute("title",obj.name),videoMediaName.innerText=obj.name,videoNode.setAttribute("poster","/thumb/"+obj.relativeThumb),videoNode.load()}else showAlertWindow("Error","Cannot play external media items from this interface.<br>You can only modify media metadata.<br>Start the media item from the original location.")}function stopVideoClick(){controlsVisible&&stopVideo()}function stopVideo(){hideVideo(),videoNode.pause(),videoSourceNode.setAttribute("src",""),videoNode.removeAttribute("title"),videoNode.removeAttribute("poster"),videoMediaName.innerText="",videoNode.load(),playingmediaItem&&(playingmediaItem.playing=!1,playingmediaItem.stopped=!0,sendMediaState(),clearPlayingMediaItem())}function skipVideoTo(timeInMSecs){videoNode&&playingmediaItem&&(videoNode.currentTime=timeInMSecs)}function onSkipToMoneyShotClick(){controlsVisible&&onSkipToMoneyShot()}function onSkipToMoneyShot(){if(playingmediaItem){var moneyShotSecs=playingmediaItem.metaData.moneyShotSecs;moneyShotSecs<1&&(moneyShotSecs=videoNode.duration-.1*videoNode.duration),skipVideoTo(moneyShotSecs)}}function onToggleFilterInput(searchButton){document.getElementById("filterInput").classList.toggle("hidden"),searchButton.classList.toggle("icon-button-down")}function onToggleTagInput(tagButton){document.getElementById("tagFilterOptions").classList.toggle("hidden"),tagButton.classList.toggle("icon-button-down")}function setPlayingMediaItem(obj){playingmediaItem=obj,(playingmediaItemNode=document.getElementById(obj.id)).classList.add("media-item-playing")}function clearPlayingMediaItem(){playingmediaItemNode.classList.remove("media-item-playing"),playingmediaItem=null,playingmediaItemNode=null}var timer1=0,timer2=Date.now();function onVideoTimeUpdate(event){xtpConnected&&selectedInputDevice==DeviceType.XTPWeb&&(timer2-timer1>=1e3&&(timer1=timer2,sendMediaState()),timer2=Date.now())}function onVideoLoading(event){debug("Data loading"),videoStallTimeout&&clearTimeout(videoStallTimeout),dataLoading(),playingmediaItem&&(playingmediaItem.loaded=!1),videoStallTimeout=setTimeout((()=>{dataLoaded(),videoStallTimeout=void 0}),2e4)}function onVideoLoad(event){debug("Data loaded"),debug("Duration: "+videoNode.duration),playingmediaItem&&(playingmediaItem.loaded=!0)}function onVideoPlay(event){debug("Video play"),playingmediaItem&&(playingmediaItem.playing=!0),sendMediaState()}function onVideoPause(event){debug("Video pause"),playingmediaItem&&(playingmediaItem.playing=!1),sendMediaState()}function onVideoStall(event){debug("Video stall"),dataLoading(),playingmediaItem&&(playingmediaItem.playing=!1),sendMediaState(),videoStallTimeout&&clearTimeout(videoStallTimeout),videoStallTimeout=setTimeout((()=>{dataLoaded(),videoStallTimeout=void 0}),2e4)}function onVideoPlaying(event){debug("Video playing"),videoStallTimeout&&clearTimeout(videoStallTimeout),playingmediaItem&&(playingmediaItem.playing=!0),sendMediaState()}function onVolumeChange(){window.localStorage.setItem("volume",videoNode.volume)}function onVideoEnd(event){playNextVideo()}function playNextVideoClick(){controlsVisible&&playNextVideo()}function playNextVideo(){if(0!=mediaListDisplayed.length)if(shufflePlayMode)playVideo(getNextShuffleMediaItem());else{var currentDisplayedMedia=getCurrentDisplayedMediaNodes();if(!currentDisplayedMedia||!currentDisplayedMedia.length)return;if(playingmediaItem){var playingIndex=currentDisplayedMedia.findIndex((x=>x.id===playingmediaItem.id));playingIndex++}else playingIndex=0;playingIndex<currentDisplayedMedia.length?playVideo(currentDisplayedMedia[playingIndex]):playVideo(currentDisplayedMedia[0])}}function playPreviousVideoClick(){controlsVisible&&playPreviousVideo()}function playPreviousVideo(){if(0!=mediaListDisplayed.length){var currentDisplayedMedia=getCurrentDisplayedMediaNodes();if(currentDisplayedMedia&&currentDisplayedMedia.length){if(playingmediaItem){var playingIndex=currentDisplayedMedia.findIndex((x=>x.id===playingmediaItem.id));playingIndex--}else playingIndex=-1;playVideo(playingIndex<0?currentDisplayedMedia[currentDisplayedMedia.length-1]:currentDisplayedMedia[playingIndex])}}}function setThumbSize(value,userClick){userClick?(window.localStorage.setItem("thumbSize",parseInt(value,10)),thumbSizeGlobal=parseInt(value,10)):value&&(document.getElementById(value.toString()).checked=!0)}function sendMediaState(){selectedInputDevice==DeviceType.XTPWeb&&postMediaState(playingmediaItem?{path:playingmediaItem.path,playing:playingmediaItem.playing,currentTime:videoNode.currentTime,duration:videoNode.duration,playbackSpeed:videoNode.speed}:{path:void 0,playing:!1,currentTime:0,duration:0,playbackSpeed:1})}function onFunscriptWorkerThreadRecieveMessage(e){var data;switch(isMediaFunscriptPlaying=!0,(data="string"==typeof e.data?JSON.parse(e.data):e.data).command){case"sendTcode":sendTcode(data.tcode);break;case"getMediaState":sendMediaState();break;case"end":funscriptSyncWorker.terminate(),funscriptSyncWorker=null;break}}function openSettings(){getServerSessions(),settingsNode.style.visibility="visible",settingsNode.style.opacity=1,document.getElementById("settingsTabs").style.display="block",speechNotInbrowser||systemVoices&&0!==systemVoices.length||disableTextToSpeech("No voices found")}function closeSettings(){settingsNode.style.visibility="hidden",settingsNode.style.opacity=0,document.getElementById("settingsTabs").style.display="none"}function openMetaDataModal(mediaItem){selectedMediaItemMetaData=mediaItem.metaData,document.getElementById("mediaOffset").value=selectedMediaItemMetaData.offset,document.getElementById("moneyShotMillis").value=selectedMediaItemMetaData.moneyShotMillis;document.getElementsByName("MetadataTagCheckbox").forEach((x=>{x.checked=selectedMediaItemMetaData.tags.findIndex((y=>y==x.value))>-1})),mediaItemSettingsModalNode.style.visibility="visible",mediaItemSettingsModalNode.style.opacity=1}function closeMetaDataModal(){mediaItemSettingsModalNode.style.visibility="hidden",mediaItemSettingsModalNode.style.opacity=0,document.getElementById("saveMediaItemMetaDataButton").disabled=!0}function saveMetaData(){selectedMediaItemMetaData.offset=parseInt(document.getElementById("mediaOffset").value),selectedMediaItemMetaData.moneyShotMillis=parseInt(document.getElementById("moneyShotMillis").value),postMediaItemMetaData(selectedMediaItemMetaData)}function metaDataChange(){document.getElementById("saveMediaItemMetaDataButton").disabled=!1}function addToSelectedMetaData(amount){var mediaOffsetNode=document.getElementById("mediaOffset"),value=parseInt(mediaOffsetNode.value);value+=amount,mediaOffsetNode.value=value,metaDataChange()}function resetMoneyShot(){document.getElementById("moneyShotMillis").value=-1,metaDataChange()}var debouncer,onMetadataTagCheckboxClicked=function(tagCheckbox){return function(){let tagsChanged=!1;if(tagCheckbox&&selectedMediaItemMetaData){const index=selectedMediaItemMetaData.tags.findIndex((x=>x==tagCheckbox.value));tagCheckbox.checked&&-1==index?(selectedMediaItemMetaData.tags.push(tagCheckbox.value),tagsChanged=!0):!tagCheckbox.checked&&index>-1&&(selectedMediaItemMetaData.tags.splice(index,1),tagsChanged=!0)}tagsChanged&&metaDataChange()}};function tabClick(tab,tabNumber){for(var allTabs=document.getElementsByClassName("tab-section-tab"),i=0;i<allTabs.length;i++){if(i!=tabNumber)allTabs[i].style.backgroundColor="#5E6B7F"}var allContent=document.getElementsByClassName("tab-content");for(i=0;i<allContent.length;i++)if(i!=tabNumber){var content=allContent[i];content.style.display="none",content.style.opacity="0"}allContent[tabNumber].style.display="block",allContent[tabNumber].style.opacity="1",tab.style.backgroundColor="#8DA1BF"}function getCurrentDisplayedMediaNodes(){var displayedElementIDs=Array.from(document.querySelectorAll(".media-item:not([hidden])")).map((x=>x.id));return mediaListDisplayed.filter((x=>displayedElementIDs.includes(x.id)))}function showChange(value){showGlobal=value||"All",window.localStorage.setItem("show",JSON.stringify(value)),loadMedia(mediaListDisplayed=getDisplayedMediaList(value,!0)),filter()}function sortChange(value){sort(value,!0),loadMedia(mediaListDisplayed=getDisplayedMediaList(showGlobal,!1)),filter()}function thumbSizeChange(value){setThumbSize(value,!0),loadMedia(mediaListDisplayed),filter()}async function setupSliders(){var availableChannels=remoteUserSettings.availableChannelsArray,tcodeRanges=document.getElementById("tcodeRanges");if(availableChannels&&0!=availableChannels.length){removeAllChildNodes(tcodeRanges);for(var i=0;i<availableChannels.length;i++){var channel=availableChannels[i],formElementNode=document.createElement("div");formElementNode.classList.add("formElement");var labelNode=document.createElement("label");labelNode.classList.add("range-label"),labelNode.innerText=channel.friendlyName,labelNode.for=channel.channel,formElementNode.appendChild(labelNode);var sectionNode=document.createElement("section");sectionNode.classList.add("range-slider"),sectionNode.id=channel.channel,formElementNode.appendChild(sectionNode);var rangeValuesNode=document.createElement("span");rangeValuesNode.classList.add("range-values");var input1Node=document.createElement("input");input1Node.type="range",input1Node.min=channel.min,input1Node.max=channel.max-1,input1Node.value=channel.userMin;var input2Node=document.createElement("input");input2Node.type="range",input2Node.min=channel.min+1,input2Node.max=channel.max,input2Node.value=channel.userMax,userAgentIsDeo?(formElementNode.style.height="50px",labelNode.style.height="50px"):(input1Node.classList.add("range-input"),input2Node.classList.add("range-input")),input1Node.oninput=function(input1Node,input2Node,rangeValuesNode,channel){var slide1=parseInt(input1Node.value),slide2=parseInt(input2Node.value),slideMid=Math.round((slide2+slide1)/2);rangeValuesNode.innerText=slide1+" - "+slideMid+" - "+slide2,slide2<slide1&&(input2Node.value=slide1+1,remoteUserSettings.availableChannels[channel.channel].userMax=input2Node.value),remoteUserSettings.availableChannels[channel.channel].userMin=slide1,remoteUserSettings.availableChannels[channel.channel].userMid=slideMid,sendTCode(channel.channel+input1Node.value.toString().padStart(4,"0")+"S2000");var debouncerOBJ=debounceTracker[channel.channel+"min"];debouncerOBJ&&clearTimeout(debouncerOBJ),debounceTracker[channel.channel+"min"]=setTimeout((function(){sendTCodeRange(channel.channel,parseInt(input1Node.value),parseInt(input2Node.value)),debounceTracker[channel.channel+"min"]=void 0}),1e3)}.bind(input1Node,input1Node,input2Node,rangeValuesNode,channel),input2Node.oninput=function(input1Node,input2Node,rangeValuesNode,channel){var slide1=parseInt(input1Node.value),slide2=parseInt(input2Node.value),slideMid=Math.round((slide2+slide1)/2);rangeValuesNode.innerText=slide1+" - "+slideMid+" - "+slide2,slide1>slide2&&(input1Node.value=slide2-1,remoteUserSettings.availableChannels[channel.channel].userMin=input1Node.value),remoteUserSettings.availableChannels[channel.channel].userMax=slide2,remoteUserSettings.availableChannels[channel.channel].userMid=slideMid,sendTCode(channel.channel+input2Node.value.toString().padStart(4,"0")+"S2000");var debouncerOBJ=debounceTracker[channel.channel+"max"];debouncerOBJ&&clearTimeout(debouncerOBJ),debounceTracker[channel.channel+"max"]=setTimeout((function(){sendTCodeRange(channel.channel,parseInt(input1Node.value),parseInt(input2Node.value)),debounceTracker[channel.channel+"max"]=void 0}),1e3)}.bind(input2Node,input1Node,input2Node,rangeValuesNode,channel);var minIncrementButton=document.createElement("button");minIncrementButton.classList.add("min-max-button"),minIncrementButton.innerText="+",minIncrementButton.onclick=function(input1Node,input2Node){const minValue=parseInt(input1Node.value),maxValue=parseInt(input2Node.value),newValue=minValue+rangeChangeAmount;input1Node.value=newValue<=maxValue?newValue:maxValue-rangeChangeAmount,input1Node.dispatchEvent(new Event("input",{bubbles:!0}))}.bind(input1Node,input1Node,input2Node,channel);var minDecrementButton=document.createElement("button");minDecrementButton.classList.add("min-max-button"),minDecrementButton.innerText="-",minDecrementButton.onclick=function(input1Node,channel){const newValue=parseInt(input1Node.value)-rangeChangeAmount;input1Node.value=newValue>=remoteUserSettings.availableChannels[channel.channel].min?newValue:remoteUserSettings.availableChannels[channel.channel].min,input1Node.dispatchEvent(new Event("input",{bubbles:!0}))}.bind(input1Node,input1Node,channel);var maxIncrementButton=document.createElement("button");maxIncrementButton.classList.add("min-max-button"),maxIncrementButton.innerText="+",maxIncrementButton.onclick=function(input2Node,channel){const newValue=parseInt(input2Node.value)+rangeChangeAmount;input2Node.value=newValue<=remoteUserSettings.availableChannels[channel.channel].max?newValue:remoteUserSettings.availableChannels[channel.channel].max,input2Node.dispatchEvent(new Event("input",{bubbles:!0}))}.bind(input2Node,input2Node,channel);var maxDecrementButton=document.createElement("button");maxDecrementButton.classList.add("min-max-button"),maxDecrementButton.innerText="-",maxDecrementButton.onclick=function(input1Node,input2Node){const minValue=parseInt(input1Node.value),newValue=parseInt(input2Node.value)-rangeChangeAmount;input2Node.value=newValue>=minValue?newValue:minValue+rangeChangeAmount,input2Node.dispatchEvent(new Event("input",{bubbles:!0}))}.bind(input1Node,input1Node,input2Node,channel);var minmaxButtonSpanRow=document.createElement("span");minmaxButtonSpanRow.classList.add("min-max-buttons");var minButtonSpan=document.createElement("span");minButtonSpan.appendChild(minDecrementButton),minButtonSpan.appendChild(minIncrementButton);var maxButtonSpan=document.createElement("span");maxButtonSpan.appendChild(maxDecrementButton),maxButtonSpan.appendChild(maxIncrementButton),minmaxButtonSpanRow.appendChild(minButtonSpan),minmaxButtonSpanRow.appendChild(rangeValuesNode),minmaxButtonSpanRow.appendChild(maxButtonSpan),sectionNode.appendChild(minmaxButtonSpanRow),sectionNode.appendChild(input1Node),sectionNode.appendChild(input2Node);var slide1=parseInt(input1Node.value),slide2=parseInt(input2Node.value),slideMid=Math.round((slide2+slide1)/2);rangeValuesNode.innerText=slide1+" - "+slideMid+" - "+slide2,tcodeRanges.appendChild(formElementNode)}}else console.error("availableChannels was null or empty when setupSliders was called")}async function setupMotionModifiers(){var tab=document.getElementById("tabFunscript");removeAllChildNodes(tab),(formElementNode=document.createElement("div")).classList.add("formElement");var headerDivNode=document.createElement("div");headerDivNode.classList.add("tab-content-header");var headerNode=document.createElement("div");headerNode.innerText="Motion modifier",headerNode.classList.add("tab-content-header-main");var subtextNode=document.createElement("div");subtextNode.classList.add("tab-content-header-eyebrow"),subtextNode.innerText="Add random motion to other channels",headerDivNode.appendChild(headerNode),headerDivNode.appendChild(subtextNode),(labelNode=document.createElement("label")).innerText="Enabled",labelNode.for="multiplierEnabled",(sectionNode=document.createElement("section")).classList.add("form-group-section"),sectionNode.id="multiplierEnabled",(multiplierEnabledNode=document.createElement("input")).id="multiplierEnabled",multiplierEnabledNode.type="checkbox",multiplierEnabledNode.checked=remoteUserSettings.multiplierEnabled,multiplierEnabledNode.oninput=function(event){remoteUserSettings.multiplierEnabled=event.target.checked,toggleMotionModifierState(event.target.checked),markXTPFormDirty()}.bind(multiplierEnabledNode),sectionNode.appendChild(multiplierEnabledNode);["Link to script","Speed"].forEach((element=>{var gridHeaderNode=document.createElement("div");gridHeaderNode.classList.add("form-group-control"),gridHeaderNode.classList.add("form-group-control-header");var gridHeaderContentNode=document.createElement("span");gridHeaderContentNode.innerText=element,gridHeaderNode.appendChild(gridHeaderContentNode),sectionNode.appendChild(gridHeaderNode)})),formElementNode.appendChild(labelNode),formElementNode.appendChild(sectionNode),tab.appendChild(headerDivNode),tab.appendChild(formElementNode);for(var availableChannels=remoteUserSettings.availableChannelsArray,i=0;i<availableChannels.length;i++){var formElementNode,labelNode,sectionNode,channel=availableChannels[i],channelName=channel.channel;(formElementNode=document.createElement("div")).classList.add("formElement"),(labelNode=document.createElement("label")).innerText=channel.friendlyName,labelNode.for=channelName,formElementNode.appendChild(labelNode),(sectionNode=document.createElement("section")).setAttribute("name","motionModifierSection"),sectionNode.classList.add("form-group-section"),sectionNode.id=channelName;var multiplierEnabledNode,enabledValueNode=document.createElement("div");enabledValueNode.classList.add("form-group-control"),(multiplierEnabledNode=document.createElement("input")).setAttribute("name","motionModifierInput"),multiplierEnabledNode.type="checkbox",multiplierEnabledNode.checked=channel.multiplierEnabled,multiplierEnabledNode.oninput=function(channelName,event){remoteUserSettings.availableChannels[channelName].multiplierEnabled=event.target.checked,markXTPFormDirty()}.bind(multiplierEnabledNode,channelName),enabledValueNode.appendChild(multiplierEnabledNode);var linkedEnabledValueNode=document.createElement("div");linkedEnabledValueNode.classList.add("form-group-control");var linkToRelatedMFSNode=document.createElement("input");linkToRelatedMFSNode.setAttribute("name","motionModifierInput"),linkToRelatedMFSNode.type="checkbox",linkToRelatedMFSNode.checked=channel.linkToRelatedMFS,linkToRelatedMFSNode.oninput=function(channelName,event){remoteUserSettings.availableChannels[channelName].linkToRelatedMFS=event.target.checked,markXTPFormDirty()}.bind(linkToRelatedMFSNode,channelName);var relatedChannelNode=document.createElement("select");relatedChannelNode.setAttribute("name","motionModifierInput"),availableChannels.forEach((element=>{if(element.channel!==channel.channel){var relatedChannelOptionNode=document.createElement("option");relatedChannelOptionNode.innerHTML=element.friendlyName,relatedChannelOptionNode.value=element.channel,relatedChannelNode.appendChild(relatedChannelOptionNode)}})),relatedChannelNode.value=channel.relatedChannel,relatedChannelNode.oninput=function(channelName,event){remoteUserSettings.availableChannels[channelName].relatedChannel=event.target.value,markXTPFormDirty()}.bind(relatedChannelNode,channelName),linkedEnabledValueNode.appendChild(linkToRelatedMFSNode),linkedEnabledValueNode.appendChild(relatedChannelNode);var damperEnabledValueNode=document.createElement("div");damperEnabledValueNode.classList.add("form-group-control");var damperEnabledNode=document.createElement("input");damperEnabledNode.setAttribute("name","motionModifierInput"),damperEnabledNode.type="checkbox",damperEnabledNode.checked=channel.damperEnabled,damperEnabledNode.oninput=function(channelName,event){remoteUserSettings.availableChannels[channelName].damperEnabled=event.target.checked,markXTPFormDirty()}.bind(damperEnabledNode,channelName);var damperValueNode=document.createElement("input");damperValueNode.setAttribute("name","motionModifierInput"),damperValueNode.value=channel.damperValue,damperValueNode.oninput=function(channelName,event){var value=parseFloat(event.target.value);value&&(remoteUserSettings.availableChannels[channelName].damperValue=value,markXTPFormDirty())}.bind(damperValueNode,channelName),damperEnabledValueNode.appendChild(damperEnabledNode),damperEnabledValueNode.appendChild(damperValueNode),sectionNode.appendChild(enabledValueNode),sectionNode.appendChild(linkedEnabledValueNode),sectionNode.appendChild(damperEnabledValueNode),formElementNode.appendChild(sectionNode),tab.appendChild(formElementNode)}toggleMotionModifierState(remoteUserSettings.multiplierEnabled),setUpInversionMotionModifier()}function toggleMotionModifierState(enabled){document.getElementsByName("motionModifierInput").forEach((element=>{element.disabled=!enabled}))}async function setUpInversionMotionModifier(){var tab=document.getElementById("tabFunscript");(formElementNode=document.createElement("div")).classList.add("formElement");var headerDivNode=document.createElement("div");headerDivNode.classList.add("tab-content-header");var subtextNode=document.createElement("div");subtextNode.classList.add("tab-content-header-eyebrow"),subtextNode.innerText="Invert motion of channels",headerDivNode.appendChild(subtextNode),tab.appendChild(headerDivNode);for(var availableChannels=remoteUserSettings.availableChannelsArray,i=0;i<availableChannels.length;i++){var formElementNode,channel=availableChannels[i],channelName=channel.channel;(formElementNode=document.createElement("div")).classList.add("formElement");var labelNode=document.createElement("label");labelNode.innerText=channel.friendlyName,labelNode.for=channel.channel+"Inverted",formElementNode.appendChild(labelNode);var sectionNode=document.createElement("section");sectionNode.setAttribute("name","motionModifierInvertedSection"),sectionNode.classList.add("form-group-section"),sectionNode.id=channel.channel+"Inverted";var enabledValueNode=document.createElement("div");enabledValueNode.classList.add("form-group-control");var invertedEnabledNode=document.createElement("input");invertedEnabledNode.setAttribute("name","motionModifierInputInverted"),invertedEnabledNode.type="checkbox",invertedEnabledNode.checked=channel.inverted,invertedEnabledNode.oninput=function(channelName,event){remoteUserSettings.availableChannels[channelName].inverted=event.target.checked,markXTPFormDirty()}.bind(invertedEnabledNode,channelName),enabledValueNode.appendChild(invertedEnabledNode),sectionNode.appendChild(enabledValueNode),formElementNode.appendChild(sectionNode),tab.appendChild(formElementNode)}}function markXTPFormDirty(){xtpFormDirty=!0,document.getElementById("saveToXTPButton").disabled=!1}function markXTPFormClean(){xtpFormDirty=!1,document.getElementById("saveToXTPButton").disabled=!0}function setupConnectionsTab(){switch(selectedInputDevice=remoteUserSettings.connection.input.selectedDevice,selectedSyncConnectionGlobal&&selectedSyncConnectionGlobal!=selectedInputDevice&&(sendInputDeviceConnectionChange(selectedSyncConnectionGlobal,!0),selectedInputDevice=selectedSyncConnectionGlobal),selectedInputDevice){case DeviceType.Deo:document.getElementById("connectionDeoVR").checked=!0;break;case DeviceType.Whirligig:document.getElementById("connectionWhirligig").checked=!0;break;case DeviceType.XTPWeb:document.getElementById("connectionXTPWeb").checked=!0;break;case DeviceType.None:document.getElementById("connectionInputNone").checked=!0;break}switch(document.getElementById("deoVRAddress").value=remoteUserSettings.connection.input.deoAddress,document.getElementById("deoVRPort").value=remoteUserSettings.connection.input.deoPort,document.getElementById("connectionGamepad").checked=remoteUserSettings.connection.input.gamePadEnabled,selectedOutputDevice=remoteUserSettings.connection.output.selectedDevice,selectedOutputConnectionGlobal&&selectedOutputConnectionGlobal!=selectedOutputDevice&&(sendOutputDeviceConnectionChange(selectedOutputConnectionGlobal,!0),selectedOutputDevice=selectedOutputConnectionGlobal),selectedOutputDevice){case DeviceType.None:document.getElementById("connectionOutputNone").checked=!0;break;case DeviceType.Network:document.getElementById("connectionNetwork").checked=!0;break;case DeviceType.Serial:document.getElementById("connectionSerial").checked=!0;break}document.getElementById("networkAddress").value=remoteUserSettings.connection.output.networkAddress,document.getElementById("networkPort").value=remoteUserSettings.connection.output.networkPort,document.getElementById("serialPort").value=remoteUserSettings.connection.output.serialPort}function webSocketAddressChange(e){debouncer&&clearTimeout(debouncer),debouncer=setTimeout((function(){debouncer=null,deviceAddress=document.getElementById("webSocketAddress").value,window.localStorage.setItem("webSocketAddress",value)}),500)}function defaultLocalSettings(){showAlertWindow("Confirm","Are you sure you want to reset ALL local settings to default? Note: This only resets the settings in this browser. Your settings stored in XTP will remain.",(function(){window.localStorage.clear(),window.close(),closeAlertWindow()}))}function deleteLocalSettings(){showAlertWindow("Confirm","Are you sure you want to delete ALL settings from localStorage and close the window?",(function(){window.localStorage.clear(),window.location.reload(),closeAlertWindow()}))}function onDeoVRAddressChange(input){input.value&&0!==input.value.trim().length?(remoteUserSettings.connection.input.deoAddress=input.value.trim(),markXTPFormDirty()):userError("Invalid Deo/Heresphere network address")}function onDeoVRPortChange(input){input.value&&0!==input.value.trim().length?(remoteUserSettings.connection.input.deoPort=input.value.trim(),markXTPFormDirty()):userError("Invalid Deo/Heresphere network port")}function onNetworkAddressChange(input){input.value&&0!==input.value.trim().length?(remoteUserSettings.connection.output.networkAddress=input.value.trim(),markXTPFormDirty()):userError("Invalid network address")}function onNetworkPortChange(input){input.value&&0!==input.value.trim().length?(remoteUserSettings.connection.output.networkPort=input.value.trim(),markXTPFormDirty()):userError("Invalid network port")}function onSerialPortChange(input){remoteUserSettings.connection.output.serialPort=input.value,markXTPFormDirty()}function keyboardShortcuts(event){if(!filterDebounce){const{key:key}=event;switch(key){case"k":togglePlay(),animatePlayback(),videoNode.paused?showControls():hideControls();break;case"m":toggleMute();break;case"f":toggleFullScreen();break;case"p":togglePip();break;case"ArrowRight":playNextVideo();break;case"ArrowLeft":playPreviousVideo();break;case"+":volumeUp();break;case"-":volumeDown();break;case"a":sendSkipToNextAction();break;case"c":onSkipToMoneyShot();break;case"x":stopVideoClick();break}}}