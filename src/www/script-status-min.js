const scriptStatusElement=document.getElementById("scriptStatusModal"),scriptStatusContainerElements=document.getElementsByName("scriptStatusContainer"),scriptStatusModalButton=document.getElementById("scriptStatusModalButton"),noScriptInputEmlements=document.getElementsByName("noScriptInput"),scriptStatusPlayerContainer=document.getElementById("scriptStatusPlayerContainer"),scriptStatusPlayerButton=document.getElementById("scriptStatusPlayerButton");let lerpInterval,currentChannels={},isShown=!1,isModalShown=!1,isPlayerShown=!1,isScriptStatusPaused=!1;function toggleScriptStatusPlayer(){scriptStatusPlayerContainer.classList.toggle("hidden"),scriptStatusPlayerButton.classList.toggle("icon-button-down"),updateShown(),isPlayerShown=!scriptStatusPlayerContainer.classList.contains("hidden"),isPlayerShown?showControls(!0):(disableForceControlsVisible(),hideControlsAfterTimeout())}function toggleScriptStatusModal(){scriptStatusElement.classList.toggle("hidden"),scriptStatusModalButton.classList.toggle("icon-button-down"),updateShown(),isModalShown=!scriptStatusElement.classList.contains("hidden")}function updateShown(){isShown=!scriptStatusElement.classList.contains("hidden")||!scriptStatusPlayerContainer.classList.contains("hidden")}function setPauseScriptStatus(isPaused){isScriptStatusPaused=isPaused}function setupchannel(channel){if(currentChannels[channel])return void currentChannels[channel].animations.forEach((element=>{element.show()}));let userChannel=remoteUserSettings.availableChannelsArray.find((x=>x.channel==channel));currentChannels[channel]={},currentChannels[channel].animations=[];for(let i=0;i<scriptStatusContainerElements.length;i++){const element=scriptStatusContainerElements[i];let channelAnimation=new ChannelAnimation;element.appendChild(channelAnimation.create(userChannel)),currentChannels[channel].animations.push(channelAnimation)}}function setChannelStatus(channel,value,time,timeType){if(isShown){for(let index=0;index<noScriptInputEmlements.length;index++){const noScriptInputEmlement=noScriptInputEmlements[index];noScriptInputEmlement.classList.contains("hidden")||noScriptInputEmlement.classList.add("hidden")}setupchannel(channel),debug(`${channel} enter setChannelStatus value: ${value} time: ${time} timeType: ${timeType}`);for(let i=0;i<currentChannels[channel].animations.length;i++){let channelsAnimation=currentChannels[channel].animations[i];channelsAnimation.timeout&&clearTimeout(channelsAnimation.timeout),channelsAnimation.setChannelStatus(value,time,timeType),channelsAnimation.timeout=setTimeout((function(){for(let i=0;i<currentChannels[channel].animations.length;i++)if(channelsAnimation.hide(),Object.keys(currentChannels).every((x=>currentChannels[x].animations.every((y=>y.hidden)))))for(let index=0;index<noScriptInputEmlements.length;index++){noScriptInputEmlements[index].classList.remove("hidden")}}),1e4)}}}class ChannelAnimation{hidden=!1;timeout=void 0;parent;label;progress;channel;targetValue=0;targetValue=0;targetTime=0;startValue=0;startTime=0;elapsedMillis=0;lastAnimation;constructor(){}create(userChannel){this.channel=userChannel,this.parent=document.createElement("div"),this.parent.id=userChannel.channel+"ParentElement",this.parent.classList.add("script-status-div"),this.progress=document.createElement("progress");const channelColor=getChannelColor(userChannel.channel);this.progress.style.setProperty("color",channelColor),this.progress.style.setProperty("--scrollbar-background",channelColor),this.progress.classList.add("script-status-progress"),this.label=document.createElement("label"),this.label.classList.add("script-status-label"),this.label.innerText=userChannel.friendlyName;let valueId=userChannel.channel+"ValueElement";return this.label.setAttribute("for",valueId),this.progress.id=valueId,this.progress.min=0,this.progress.max=100,this.progress.classList.add("pregress-status"),this.parent.appendChild(this.label),this.parent.appendChild(this.progress),this.parent}setChannelStatus(value,time,timeType){this.lastAnimation&&(cancelAnimationFrame(this.lastAnimation),debug(`${this.channel.channel} cancelAnimationFrame`),this.lastAnimation=void 0),this.startValue=this.progress.value,this.startTime=0,this.targetValue=value,this.targetTime=time,this.progress.value!=value&&(debug(`${this.channel.channel} setChannelStatus startValue: ${this.startValue} targetValue: ${this.targetValue} targetTime: ${this.targetTime}`),this.label.innerText=`${this.channel.friendlyName}: ${this.targetValue} ${isScriptStatusPaused?": paused":""}`,this.lastAnimation=requestAnimationFrame(this.animate.bind(this)))}hide(){this.parent.classList.add("hidden"),this.hidden=!0}show(){this.hidden||this.parent.classList.remove("hidden"),this.hidden=!1}animate(timeStamp){if(this.startTime&&!isScriptStatusPaused||(this.startTime=timeStamp),isScriptStatusPaused)this.label.innerText=`${this.channel.friendlyName}: ${this.targetValue} ${isScriptStatusPaused?": paused":""}`;else{this.elapsedMillis=timeStamp-this.startTime;let downStroke=this.startValue>this.targetValue,timeScale=downStroke?scale(this.elapsedMillis,this.targetTime,0,0,1):scale(this.elapsedMillis,0,this.targetTime,0,1);if(isNaN(timeScale))return;if(this.progress.value=downStroke?lerp(this.targetValue,this.startValue,timeScale):lerp(this.startValue,this.targetValue,timeScale),debug(`${this.channel.channel} ${downStroke?"DownStroke":"UpStroke"} targetValue: ${round(this.targetValue,2)} targetTime: ${round(this.targetTime,2)} elapsedMillis: ${round(this.elapsedMillis,2)} timescale: ${round(timeScale,2)} progressValue: ${round(this.progress.value,2)}`),this.progress.value==this.targetValue)return debug(`${this.channel.channel} Target value reached: ${this.targetValue}`),void debug(`${this.channel.channel} progressValue: ${this.progress.value}`);if(this.elapsedMillis>=this.targetTime)return debug(`${this.channel.channel} Target time reached: ${this.targetTime}`),void debug(`${this.channel.channel} elapsedMillis: ${this.elapsedMillis}`)}requestAnimationFrame(this.animate.bind(this))}linear(time,start,end,duration){return(end-start)*time/duration+start}}