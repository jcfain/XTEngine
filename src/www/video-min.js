var volume=JSON.parse(window.localStorage.getItem("volume"));const videoNode=document.getElementById("videoPlayer");var controlsHideDebounce;videoNode.addEventListener("loadeddata",onVideoLoad),videoNode.addEventListener("play",onVideoPlay),videoNode.addEventListener("playing",onVideoPlaying),videoNode.addEventListener("stalled",onVideoStall),videoNode.addEventListener("waiting",onVideoStall),videoNode.addEventListener("pause",onVideoPause),videoNode.addEventListener("volumechange",onVolumeChange),videoNode.addEventListener("ended",onVideoEnd),videoNode.addEventListener("timeupdate",onVideoTimeUpdate);var controlsEnableDebounce,controlsVisible=!1,forceControlsVisible=!1,mouseOverVideo=!1,isFullScreen=!1,isLandScape=!1,isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),isMouseOverControls=!1,isTouchingControls=!1,isUsingTouch=!1,isUsingMouse=!1,isUsingPen=!1,isVideoHidden=!0;const videoControls=document.getElementsByName("video-controls"),topControls=document.getElementById("top-controls"),bottomControls=document.getElementById("bottom-controls"),playButton=document.getElementById("play"),playIcon=document.getElementById("playIcon"),pauseIcon=document.getElementById("pauseIcon"),timeElapsed=document.getElementById("time-elapsed"),duration=document.getElementById("duration"),progressBar=document.getElementById("progress-bar"),seek=document.getElementById("seek"),seekTooltip=document.getElementById("seek-tooltip"),volumeButton=document.getElementById("volume-button"),volumeIcons=document.querySelectorAll(".volume-button use"),volumeMute=document.querySelector('use[href="#volume-mute"]'),volumeLow=document.querySelector('use[href="#volume-low"]'),volumeHigh=document.querySelector('use[href="#volume-high"]'),volumeSlider=document.getElementById("volume"),playbackAnimation=document.getElementById("playback-animation"),bodyContainer=document.getElementById("body-container"),videoContainer=document.getElementById("video-container"),fullscreenButton=document.getElementById("fullscreen-button"),fullscreenIcons=fullscreenButton.querySelectorAll("use"),loadingAnimation=document.getElementById("loading-animation"),videoWorks=!!document.createElement("video").canPlayType;if(videoWorks){videoNode.controls=!1;for(let e of videoControls)e.classList.add("hide"),e.classList.remove("hidden")}function setupVideoSource(e){removeVideoSource();let o=document.createElement("source");o.id="videoSourceNode",o.addEventListener("error",onVideoError,!0),videoNode.appendChild(o),o.src=e}function removeVideoSource(){let e=document.getElementById("videoSourceNode");e&&videoNode.removeChild(e)}function togglePlay(){videoNode.paused||videoNode.ended?videoNode.play():videoNode.pause()}function videoNodeClick(){videoNode.paused?videoNode.play():videoNode.pause()}function updatePlayButton(){videoNode.paused?(playButton.setAttribute("data-title","Play (k)"),pauseIcon.classList.add("hidden"),playIcon.classList.remove("hidden")):(playButton.setAttribute("data-title","Pause (k)"),pauseIcon.classList.remove("hidden"),playIcon.classList.add("hidden"))}function formatTime(e){if(e){const i=new Date(1e3*e);var o=Math.floor(e/3600),t=i.getMinutes(),n=i.getSeconds();return{hours:(o<10?"0":"")+o,minutes:(t<10?"0":"")+t,seconds:(n<10?"0":"")+n}}return{hours:"00",minutes:"00",seconds:"00"}}function initializeVideo(){const e=Math.round(videoNode.duration);seek.setAttribute("max",e),progressBar.setAttribute("max",e);const o=formatTime(e);duration.innerText=`${o.hours}:${o.minutes}:${o.seconds}`,duration.setAttribute("datetime",`${o.hours}h ${o.minutes}m ${o.seconds}s`)}function updateTimeElapsed(){const e=formatTime(Math.round(videoNode.currentTime));timeElapsed.innerText=`${e.hours}:${e.minutes}:${e.seconds}`,timeElapsed.setAttribute("datetime",`${e.hours}h ${e.minutes}m ${e.seconds}s`)}function updateProgress(){seek.value=Math.floor(videoNode.currentTime),progressBar.value=Math.floor(videoNode.currentTime)}function updateSeekTooltip(e){const o=Math.round(e.offsetX/e.target.clientWidth*parseInt(e.target.getAttribute("max"),10));seek.setAttribute("data-seek",o);const t=formatTime(o);seekTooltip.textContent=`${t.hours}:${t.minutes}:${t.seconds}`;const n=videoNode.getBoundingClientRect();seekTooltip.style.left=e.pageX-n.left+"px"}function skipAhead(e){const o=e.target.dataset.seek?e.target.dataset.seek:e.target.value;videoNode.currentTime=o,progressBar.value=o,seek.value=o}function updateVolume(){videoNode.muted&&(videoNode.muted=!1),videoNode.volume=volumeSlider.value}function updateVolumeClick(){updateVolume()}function volumeUp(){var e=parseFloat(volumeSlider.value)+.05;e<=volumeSlider.max&&(volumeSlider.value=e,updateVolume(),updateVolumeIcon())}function volumeDown(){var e=parseFloat(volumeSlider.value)-.05;e>=volumeSlider.min&&(volumeSlider.value=e,updateVolume(),updateVolumeIcon())}function setPlayRate(e){videoNode.playbackRate=e,sendWebsocketMessage("setPlaybackRate",e)}function resetPlayRate(){videoNode.playbackRate=1,document.getElementById("playbackRateInput").value=1}function updateVolumeIcon(){volumeIcons.forEach((e=>{e.classList.add("hidden")})),volumeButton.setAttribute("data-title","Mute (m)"),videoNode.muted||0===videoNode.volume?(volumeMute.classList.remove("hidden"),volumeButton.setAttribute("data-title","Unmute (m)")):videoNode.volume>0&&videoNode.volume<=.5?volumeLow.classList.remove("hidden"):volumeHigh.classList.remove("hidden")}function toggleMute(){videoNode.muted=!videoNode.muted,videoNode.muted?(volumeSlider.setAttribute("data-volume",volumeSlider.value),volumeSlider.value=0):volumeSlider.value=volumeSlider.dataset.volume}function toggleMuteClick(){toggleMute()}function animatePlayback(){playbackAnimation.animate([{opacity:1,transform:"scale(1)"},{opacity:0,transform:"scale(1.3)"}],{duration:500})}function animatePlaybackVideoNodeClick(){animatePlayback()}function toggleFullScreenClick(){toggleFullScreen()}function toggleFullScreen(){isVideoShown()&&(showEmbedded()||showFullScreen())}function showEmbedded(){return document.fullscreenElement?(isFullScreen&&document.exitFullscreen(),!0):document.webkitFullscreenElement?(isFullScreen&&document.webkitExitFullscreen(),!0):!!document.mozFullscreenElement&&(isFullScreen&&document.mozExitFullscreen(),!0)}function showFullScreen(){isVideoShown()&&(videoContainer.requestFullscreen?isFullScreen||videoContainer.requestFullscreen():videoContainer.webkitRequestFullscreen?isFullScreen||videoContainer.webkitRequestFullscreen():videoContainer.mozRequestFullScreen&&(isFullScreen||videoContainer.mozRequestFullScreen()))}function fullscreenChange(){fullscreenIcons.forEach((e=>e.classList.toggle("hidden"))),document.fullscreenElement?(fullscreenButton.setAttribute("data-title","Exit full screen (f)"),videoNode.classList.remove("video","video-shown-embeded"),isFullScreen=!0):(fullscreenButton.setAttribute("data-title","Full screen (f)"),isVideoHidden||videoNode.classList.add("video-shown-embeded"),videoNode.classList.add("video"),isFullScreen=!1),setVideoFixedIfLowHeight()}async function togglePip(){}function disableForceControlsVisible(){forceControlsVisible=!1}function hideControlsEvent(){forceControlsVisible||videoNode.paused||isMouseOverControls&&isUsingMouse||isTouchingControls&&isUsingTouch||isMouseOverControls&&!isMobile||isTouchingControls&&isMobile||hideControls()}function hideControls(e){if("boolean"!=typeof e||e||(forceControlsVisible=e),!forceControlsVisible){for(let e of videoControls)e.classList.add("hide","disable");controlsVisible=!1}}function showControls(e=!1){"boolean"!=typeof e||forceControlsVisible||(forceControlsVisible=e),controlsEnableDebounce||(controlsEnableDebounce=setTimeout((function(){for(let e of videoControls)e.classList.remove("disable");controlsEnableDebounce=void 0,controlsVisible=!0}),100));for(let e of videoControls)e.classList.remove("hide");controlsHideDebounce&&clearTimeout(controlsHideDebounce),forceControlsVisible||hideControlsAfterTimeout()}function hideControlsAfterTimeout(){controlsHideDebounce=setTimeout((function(){hideControlsEvent()}),3e3)}function showControlsIfMouseInVideo(e){mouseOverVideo&&showControls()}function mouseEnterVideo(){mouseOverVideo=!0}function mouseLeaveVideo(){mouseOverVideo=!1}function showVideo(){videoNode.classList.add("video-shown","video-shown-embeded"),setVideoFixedIfLowHeight(),isVideoHidden=!1}function hideVideo(){isVideoHidden=!0,dataLoaded(),hideControls(!0),isFullScreen&&showEmbedded(),videoNode.classList.remove("video-shown","video-shown-embeded")}function isVideoShown(){return videoNode.classList.contains("video-shown")}function dataLoaded(){loadingAnimation.classList.add("hidden")}function dataLoading(){isVideoShown()&&loadingAnimation.classList.remove("hidden")}function checkOrientation(){screen.orientation?isLandScape=screen.orientation.type.includes("landscape"):window.orientation&&(isLandScape=90==Math.abs(window.orientation))}function setVideoFixedIfLowHeight(){document.documentElement.clientHeight<600&&!isFullScreen&&isVideoShown()?videoContainer.classList.add("video-container-fixed"):videoContainer.classList.remove("video-container-fixed")}function setPointerType(e){switch(e.pointerType){case"mouse":isUsingMouse=!0;break;case"pen":isUsingPen=!0;break;case"touch":isUsingTouch=!0;break;default:}}function controlPointerEventEnd(e){controlsHideDebounce&&clearTimeout(controlsHideDebounce),hideControlsAfterTimeout()}playButton.addEventListener("click",togglePlay),videoNode.addEventListener("play",updatePlayButton),videoNode.addEventListener("playing",dataLoaded),videoNode.addEventListener("loadeddata",hideControls),videoNode.addEventListener("loadeddata",dataLoaded),videoNode.addEventListener("pause",updatePlayButton),videoNode.addEventListener("loadedmetadata",initializeVideo),videoNode.addEventListener("timeupdate",updateTimeElapsed),videoNode.addEventListener("timeupdate",updateProgress),videoNode.addEventListener("volumechange",updateVolumeIcon),isMobile||(videoNode.addEventListener("click",videoNodeClick),videoNode.addEventListener("click",animatePlaybackVideoNodeClick)),videoContainer.addEventListener("mouseenter",showControls),videoContainer.addEventListener("mouseleave",hideControlsEvent),videoContainer.addEventListener("mouseenter",mouseEnterVideo),videoContainer.addEventListener("mouseleave",mouseLeaveVideo),videoContainer.addEventListener("mousemove",showControlsIfMouseInVideo),topControls.addEventListener("mouseenter",(function(e){controlsVisible&&(isMouseOverControls=!0)})),bottomControls.addEventListener("mouseenter",(function(e){controlsVisible&&(isMouseOverControls=!0)})),topControls.addEventListener("mouseleave",(function(e){isMouseOverControls=!1,controlPointerEventEnd(e)})),bottomControls.addEventListener("mouseleave",(function(e){isMouseOverControls=!1,controlPointerEventEnd(e)})),topControls.addEventListener("touchstart",(function(e){controlsVisible&&(isTouchingControls=!0)})),bottomControls.addEventListener("touchstart",(function(e){controlsVisible&&(isTouchingControls=!0)})),topControls.addEventListener("touchend",(function(e){isTouchingControls=!1,controlPointerEventEnd(e)})),bottomControls.addEventListener("touchend",(function(e){isTouchingControls=!1,controlPointerEventEnd(e)})),topControls.addEventListener("pointerdown",setPointerType,!1),bottomControls.addEventListener("pointerdown",setPointerType,!1),seek.addEventListener("mousemove",updateSeekTooltip),seek.addEventListener("input",skipAhead),volumeSlider.addEventListener("input",updateVolumeClick),volumeButton.addEventListener("click",toggleMuteClick),fullscreenButton.addEventListener("click",toggleFullScreenClick),videoContainer.addEventListener("fullscreenchange",fullscreenChange),videoContainer.addEventListener("mozfullscreenchange",fullscreenChange),videoContainer.addEventListener("webkitfullscreenchange",fullscreenChange),videoContainer.addEventListener("msfullscreenchange",fullscreenChange),window.addEventListener("resize",(function(e){checkOrientation(),setVideoFixedIfLowHeight()}));var timer1=0,timer2=Date.now();function onVideoTimeUpdate(e){xtpConnected&&selectedInputDevice==DeviceType.XTPWeb&&(timer2-timer1>=1e3&&(timer1=timer2,sendMediaState()),timer2=Date.now())}function onVideoError(e){videoSourceNode.src&&videoSourceNode.src.length>0&&(systemError("There was an error loading media"),videoSourceNode.src=void 0)}function onVideoLoading(e){debug("Data loading"),videoStallTimeout&&clearTimeout(videoStallTimeout),dataLoading(),playingmediaItem&&(playingmediaItem.loaded=!1),videoStallTimeout=setTimeout((()=>{dataLoaded(),videoStallTimeout=void 0}),2e4)}function onVideoLoad(e){debug("Video loaded"),debug("Duration: "+videoNode.duration),playingmediaItem&&(playingmediaItem.loaded=!0)}function onVideoPlay(e){debug("Video play"),playingmediaItem&&(playingmediaItem.playing=!0),sendMediaState()}function onVideoPause(e){debug("Video pause"),playingmediaItem&&(playingmediaItem.playing=!1),sendMediaState()}function onVideoStall(e){debug("Video stall"),dataLoading(),playingmediaItem&&(playingmediaItem.playing=!1),sendMediaState(),videoStallTimeout&&clearTimeout(videoStallTimeout),videoStallTimeout=setTimeout((()=>{debug("Video stall timeout"),playNextVideo(),dataLoaded(),videoStallTimeout=void 0}),1e4)}function onVideoPlaying(e){debug("Video playing"),videoStallTimeout&&clearTimeout(videoStallTimeout),playingmediaItem&&(playingmediaItem.playing=!0),sendMediaState()}function onVolumeChange(){window.localStorage.setItem("volume",videoNode.volume)}function onVideoEnd(e){debug("Video ended"),playNextVideo()}videoNode.volume=volume||.5,volumeSlider.value=videoNode.volume,updateVolumeIcon();